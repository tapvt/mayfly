<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../../../doc/otp_doc.css" type="text/css">
<title>Erlang -- ERTS Release Notes</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../../doc/js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../../doc/js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../../../doc/erlang-logo.png"><br><small><a href="users_guide.html">User's Guide</a><br><a href="index.html">Reference Manual</a><br><a href="release_notes.html">Release Notes</a><br><a href="../pdf/erts-5.9.pdf">PDF</a><br><a href="../../../doc/index.html">Top</a></small><p><strong>Erlang Run-Time System Application (ERTS)</strong><br><strong>Release Notes</strong><br><small>Version 5.9</small></p>
<br><a href="javascript:openAllFlips()">Expand All</a><br><a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Chapters</strong></small></p>
<ul class="flipMenu" imagepath="../../../doc/js/flipmenu"><li id="loadscrollpos" title="ERTS Release Notes" expanded="true">ERTS Release Notes<ul>
<li><a href="notes.html">
              Top of chapter
            </a></li>
<li title="Erts 5.9"><a href="notes.html#id59560">Erts 5.9</a></li>
<li title="Erts 5.8.5"><a href="notes.html#id67296">Erts 5.8.5</a></li>
<li title="Erts 5.8.4"><a href="notes.html#id65167">Erts 5.8.4</a></li>
<li title="Erts 5.8.3.2"><a href="notes.html#id127268">Erts 5.8.3.2</a></li>
<li title="Erts 5.8.3.1"><a href="notes.html#id127305">Erts 5.8.3.1</a></li>
<li title="Erts 5.8.3"><a href="notes.html#id127366">Erts 5.8.3</a></li>
<li title="Erts 5.8.2"><a href="notes.html#id127781">Erts 5.8.2</a></li>
<li title="Erts 5.8.1.2"><a href="notes.html#id128266">Erts 5.8.1.2</a></li>
<li title="Erts 5.8.1.1"><a href="notes.html#id128336">Erts 5.8.1.1</a></li>
<li title="Erts 5.8.1"><a href="notes.html#id128368">Erts 5.8.1</a></li>
<li title="Erts 5.8"><a href="notes.html#id129226">Erts 5.8</a></li>
<li title="Erts 5.7.5.2"><a href="notes.html#id130234">Erts 5.7.5.2</a></li>
<li title="Erts 5.7.5.1"><a href="notes.html#id130266">Erts 5.7.5.1</a></li>
<li title="Erts 5.7.5"><a href="notes.html#id130336">Erts 5.7.5</a></li>
<li title="Erts 5.7.4"><a href="notes.html#id98798">Erts 5.7.4</a></li>
<li title="Erts 5.7.3"><a href="notes.html#id99304">Erts 5.7.3</a></li>
<li title="Erts 5.7.2"><a href="notes.html#id99902">Erts 5.7.2</a></li>
<li title="Erts 5.7.1"><a href="notes.html#id100257">Erts 5.7.1</a></li>
<li title="Erts 5.7"><a href="notes.html#id100522">Erts 5.7</a></li>
<li title="Erts 5.6.5.1"><a href="notes.html#id101433">Erts 5.6.5.1</a></li>
<li title="Erts 5.6.5"><a href="notes.html#id101544">Erts 5.6.5</a></li>
<li title="Erts 5.6.4.2"><a href="notes.html#id101914">Erts 5.6.4.2</a></li>
<li title="Erts 5.6.4.1"><a href="notes.html#id102003">Erts 5.6.4.1</a></li>
<li title="Erts 5.6.4"><a href="notes.html#id102065">Erts 5.6.4</a></li>
<li title="Erts 5.6.3.3"><a href="notes.html#id102462">Erts 5.6.3.3</a></li>
<li title="Erts 5.6.3.2"><a href="notes.html#id102573">Erts 5.6.3.2</a></li>
<li title="Erts 5.6.3.1"><a href="notes.html#id102607">Erts 5.6.3.1</a></li>
<li title="Erts 5.6.3"><a href="notes.html#id102638">Erts 5.6.3</a></li>
<li title="Erts 5.6.2"><a href="notes.html#id103050">Erts 5.6.2</a></li>
<li title="Erts 5.6.1.1"><a href="notes.html#id103306">Erts 5.6.1.1</a></li>
<li title="Erts 5.6.1"><a href="notes.html#id103401">Erts 5.6.1</a></li>
<li title="Erts 5.6"><a href="notes.html#id103856">Erts 5.6</a></li>
<li title="Erts 5.5.5.5"><a href="notes.html#id104822">Erts 5.5.5.5</a></li>
<li title="Erts 5.5.5.4"><a href="notes.html#id104854">Erts 5.5.5.4</a></li>
<li title="Erts 5.5.5.3"><a href="notes.html#id104901">Erts 5.5.5.3</a></li>
<li title="Erts 5.5.5.2"><a href="notes.html#id104971">Erts 5.5.5.2</a></li>
<li title="Erts 5.5.5.1"><a href="notes.html#id105003">Erts 5.5.5.1</a></li>
<li title="Erts 5.5.5"><a href="notes.html#id105071">Erts 5.5.5</a></li>
<li title="Erts 5.5.4.3"><a href="notes.html#id105396">Erts 5.5.4.3</a></li>
<li title="Erts 5.5.4.2"><a href="notes.html#id105497">Erts 5.5.4.2</a></li>
<li title="Erts 5.5.4.1"><a href="notes.html#id105577">Erts 5.5.4.1</a></li>
<li title="Erts 5.5.4"><a href="notes.html#id105612">Erts 5.5.4</a></li>
<li title="Erts 5.5.3.1"><a href="notes.html#id105927">Erts 5.5.3.1</a></li>
<li title="Erts 5.5.3"><a href="notes.html#id106249">Erts 5.5.3</a></li>
<li title="Erts 5.5.2.2"><a href="notes.html#id106711">Erts 5.5.2.2</a></li>
<li title="Erts 5.5.2.1"><a href="notes.html#id106746">Erts 5.5.2.1</a></li>
<li title="Erts 5.5.2"><a href="notes.html#id106800">Erts 5.5.2</a></li>
<li title="Erts 5.5.1.1"><a href="notes.html#id107210">Erts 5.5.1.1</a></li>
<li title="Erts 5.5.1"><a href="notes.html#id107244">Erts 5.5.1</a></li>
<li title="ERTS 5.5"><a href="notes.html#id107605">ERTS 5.5</a></li>
<li title="ERTS 5.4.13"><a href="notes.html#id108128">ERTS 5.4.13</a></li>
<li title="ERTS 5.4.12"><a href="notes.html#id108346">ERTS 5.4.12</a></li>
<li title="ERTS 5.4.11"><a href="notes.html#id108457">ERTS 5.4.11</a></li>
<li title="ERTS 5.4.10"><a href="notes.html#id108609">ERTS 5.4.10</a></li>
<li title="ERTS 5.4.9.2"><a href="notes.html#id108807">ERTS 5.4.9.2</a></li>
<li title="ERTS 5.4.9.1"><a href="notes.html#id108851">ERTS 5.4.9.1</a></li>
<li title="ERTS 5.4.9"><a href="notes.html#id108888">ERTS 5.4.9</a></li>
<li title="ERTS 5.4.8"><a href="notes.html#id109055">ERTS 5.4.8</a></li>
<li title="ERTS 5.4.7"><a href="notes.html#id109254">ERTS 5.4.7</a></li>
<li title="ERTS 5.4.6"><a href="notes.html#id109343">ERTS 5.4.6</a></li>
<li title="ERTS 5.4.5"><a href="notes.html#id109502">ERTS 5.4.5</a></li>
<li title="ERTS 5.4.4"><a href="notes.html#id109660">ERTS 5.4.4</a></li>
<li title="ERTS 5.4.3"><a href="notes.html#id109882">ERTS 5.4.3</a></li>
<li title="ERTS 5.4.2.1"><a href="notes.html#id110008">ERTS 5.4.2.1</a></li>
<li title="ERTS 5.4.2"><a href="notes.html#id110045">ERTS 5.4.2</a></li>
<li title="ERTS 5.4.1"><a href="notes.html#id110108">ERTS 5.4.1</a></li>
</ul>
</li></ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>1 ERTS Release Notes</h1>
  
  <p>This document describes the changes made to the ERTS application.</p>

<h3><a name="id59560">1.1 
        Erts 5.9</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Honor option <span class="code">packet_size</span> for http packet parsing
	    by both TCP socket and <span class="code">erlang:decode_packet</span>. This
	    gives the ability to accept HTTP headers larger than the
	    default setting, but also avoid DoS attacks by accepting
	    lines only up to whatever length you wish to allow. For
	    consistency, packet type <span class="code">line</span> also honor option
	    <span class="code">packet_size</span>. (Thanks to Steve Vinoski)</p>
          <p>
	    Own Id: OTP-9389</p>
        </li>
        <li>
	    <p> A few contracts in the <span class="code">lists</span> module have been
	    corrected. </p>
          <p>
	    Own Id: OTP-9616</p>
        </li>
        <li>
          <p>
	    The Unicode noncharacter code points 16#FFFE and 16#FFFE
	    were not allowed to be encoded or decoded using the
	    <span class="code">unicode</span> module or bit syntax. That was
	    inconsistent with the other noncharacters 16#FDD0 to
	    16#FDEF that could be encoded/decoded. To resolve the
	    inconsistency, 16#FFFE and 16#FFFE can now be encoded and
	    decoded. (Thanks to Alisdair Sullivan.)</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-9624</p>
        </li>
        <li>
          <p>
	    Make epp search directory of current file first when
	    including another file This completes a partial fix in
	    R11 that only worked for include_lib(). (Thanks to
	    Richard Carlsson)</p>
          <p>
	    Own Id: OTP-9645</p>
        </li>
        <li>
          <p>
	    Fixed memory leak in
	    <span class="code">enif_inspect_io_list_as_binary</span> when applied on a
	    process independent environment.</p>
          <p>
	    Own Id: OTP-9668</p>
        </li>
        <li>
	    <p>The number of beam catches allowed in code are no
	    longer statically defined and will grow according to its
	    need.</p>
          <p>
	    Own Id: OTP-9692</p>
        </li>
        <li>
          <p>
	    Add missing parenthesis in heart doc.</p>
          <p>
	    Add missing spaces in the Reference Manual distributed
	    section.</p>
          <p>
	    In the HTML version of the doc those spaces are necessary
	    to separate those words.</p>
          <p>
	    Own Id: OTP-9693</p>
        </li>
        <li>
          <p>
	    Fixes module erlang doc style: option description (Thanks
	    to Ricardo Catalinas Jiménez)</p>
          <p>
	    Own Id: OTP-9697</p>
        </li>
        <li>
          <p>
	    Specifying a scope to binary:match/3 when using multiple
	    searchstrings resulted in faulty return values. This is
	    now corrected.</p>
          <p>
	    Own Id: OTP-9701</p>
        </li>
        <li>
          <p>
	    The runtime system crashed if more than one thread tried
	    to exit the runtime system at the same time.</p>
          <p>
	    Own Id: OTP-9705</p>
        </li>
        <li>
          <p>
	    Fix documentation for erlang:process_flag/2</p>
          <p>
	    For the subsection about process_flag(save_calls, N)
	    there's an unrelated paragraph about process priorities
	    which was copied from the preceeding subsection regarding
	    process_flag(priority, Level). (Thanks to Filipe David
	    Manana)</p>
          <p>
	    Own Id: OTP-9714</p>
        </li>
        <li>
          <p>
	    Calls to <span class="code">erlang:system_flag(schedulers_online, N)</span>
	    and/or <span class="code">erlang:system_flag(multi_scheduling,
	    block|unblock)</span> could cause internal data used by this
	    functionality to get into an inconsistent state. When
	    this happened various problems occurred. This bug was
	    quite hard to trigger, so hopefully no-one has been
	    effected by it.</p>
          <p>
	    A spinlock used by the run-queue management sometimes got
	    heavily contended. This code has now been rewritten, and
	    the spinlock has been removed.</p>
          <p>
	    Own Id: OTP-9727</p>
        </li>
        <li>
          <p>
	    Use libdlpi to get physical address (Thanks to Trond
	    Norbye)</p>
          <p>
	    Own Id: OTP-9818</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
	    <p> An option list argument can now be passed to
	    <span class="code">file:read_file_info/2, file:read_link_info/2</span> and
	    <span class="code">file:write_file_info/3</span> and set time type
	    information in the call. Valid options are <span class="code">{time,
	    local}, {time, universal}</span> and <span class="code">{time, posix}</span>.
	    In the case of <span class="code">posix</span> time no conversions are made
	    which makes the operation a bit faster. </p>
          <p>
	    Own Id: OTP-7687</p>
        </li>
        <li>
	    <p>A number of memory allocation optimizations have been
	    implemented. Most optimizations reduce contention caused
	    by synchronization between threads during allocation and
	    deallocation of memory. Most notably:</p> <ul> <li>
	    Synchronization of memory management in scheduler
	    specific allocator instances has been rewritten to use
	    lock-free synchronization. </li> <li> Synchronization
	    of memory management in scheduler specific pre-allocators
	    has been rewritten to use lock-free synchronization.
	    </li> <li> The 'mseg_alloc' memory segment allocator
	    now use scheduler specific instances instead of one
	    instance. Apart from reducing contention this also
	    ensures that memory allocators always create memory
	    segments on the local NUMA node on a NUMA system. </li>
	    </ul>
          <p>
	    Own Id: OTP-7775</p>
        </li>
        <li>
          <p>
	    The ethread atomic memory operations API used by the
	    runtime system has been extended and improved.</p>
          <p>
	    The ethread library now also performs runtime tests for
	    presence of hardware features, such as for example SSE2
	    instructions, instead of requiring this to be determined
	    at compile time.</p>
          <p>
	    All uses of the old deprecated atomic API in the runtime
	    system have been replaced with the use of the new atomic
	    API. In a lot of places this change imply a relaxation of
	    memory barriers used.</p>
          <p>
	    Own Id: OTP-9014</p>
        </li>
        <li>
	    <p>gen_sctp:open/0-2 may now return
	    {error,eprotonosupport} if SCTP is not supported</p>
	    <p>gen_sctp:peeloff/1 has been implemented and creates a
	    one-to-one socket which also are supported now</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-9239</p>
        </li>
        <li>
          <p>
	    Sendfile has been added to the file module's API.
	    sendfile/2 is used to read data from a file and send it
	    to a tcp socket using a zero copying mechanism if
	    available on that OS.</p>
          <p>
	    Thanks to Tuncer Ayaz and Steve Vinovski for original
	    implementation</p>
          <p>
	    Own Id: OTP-9240</p>
        </li>
        <li>
          <p>
	    enif_get_reverse_list function added to nif API. This
	    function should be used to reverse small lists which are
	    deep within other structures making it impractical to do
	    the reverse in Erlang.</p>
          <p>
	    Own Id: OTP-9392</p>
        </li>
        <li>
          <p>
	    The deprecated concat_binary/1 BIF has been removed. Use
	    <span class="code">list_to_binary</span> or <span class="code">iolist_to_binary/1</span>
	    instead.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-9421</p>
        </li>
        <li>
	    <p>Erlang/OTP can now be built using parallel make if you
	    limit the number of jobs, for instance using '<span class="code">make
	    -j6</span>' or '<span class="code">make -j10</span>'. '<span class="code">make -j</span>' does not
	    work at the moment because of some missing
	    dependencies.</p>
          <p>
	    Own Id: OTP-9451</p>
        </li>
        <li>
	    <p>Line number and filename information are now included
	    in exception backtraces as a fourth element in the MFA
	    tuple. The information will be pretty-printed by the
	    shell and used by <span class="code">common_test</span> to provide better
	    indication of where a test case.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-9468</p>
        </li>
        <li>
	    <p>All binary constants used to be handled as heap
	    binaries (i.e. the entire binary would be copied when
	    sent to another process). Binary constants larger than 64
	    bytes are now refc binaries (i.e. the actual data in the
	    binary will not be copied when sent to another
	    process).</p>
          <p>
	    Own Id: OTP-9486</p>
        </li>
        <li>
          <p>
	    If a float and an integer is compared, the integer is
	    only converted to a float if the float datatype can
	    contain it. Otherwise the float is converted to an
	    integer.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-9497</p>
        </li>
        <li>
          <p>
	    Add NIF function enif_is_number</p>
          <p>
	    This function allows for easily determining if a term
	    represents or not a number (integer, float, small or
	    big).(Thanks to Filipe David Manana)</p>
          <p>
	    Own Id: OTP-9629</p>
        </li>
        <li>
          <p>
	    The ERTS internal system block functionality has been
	    replaced by new functionality for blocking the system.
	    The old system block functionality had contention issues
	    and complexity issues. The new functionality piggy-backs
	    on thread progress tracking functionality needed by newly
	    introduced lock-free synchronization in the runtime
	    system. When the functionality for blocking the system
	    isn't used, there is more or less no overhead at all.
	    This since the functionality for tracking thread progress
	    is there and needed anyway.</p>
          <p>
	    Own Id: OTP-9631</p>
        </li>
        <li>
          <p>
	    An ERTS internal, generic, many to one, lock-free queue
	    for communication between threads has been introduced.
	    The many to one scenario is very common in ERTS, so it
	    can be used in a lot of places in the future. Currently
	    it is used by scheduling of certain jobs, and the async
	    thread pool, but more uses are planned for the future.</p>
          <p>
	    Drivers using the driver_async functionality are not
	    automatically locked to the system anymore, and can be
	    unloaded as any dynamically linked in driver.</p>
          <p>
	    Scheduling of ready async jobs is now also interleaved in
	    between other jobs. Previously all ready async jobs were
	    performed at once.</p>
          <p>
	    Own Id: OTP-9632</p>
        </li>
        <li>
          <p>
	    Tuple funs (a two-element tuple with a module name and a
	    function) are now officially deprecated and will be
	    removed in R16. Use '<span class="code">fun M:F/A</span>' instead. To make
	    you aware that your system uses tuple funs, the very
	    first time a tuple fun is applied, a warning will be sent
	    to the error logger.</p>
          <p>
	    Own Id: OTP-9649</p>
        </li>
        <li>
          <p>
	    Changed the internal BIF calling convention. Will make
	    simpler faster code and allow BIFs with an arbitrary
	    arity.</p>
          <p>
	    Own Id: OTP-9662</p>
        </li>
        <li>
          <p>
	    Windows native critical sections are now used internally
	    in the runtime system on Windows as mutex implementation.
	    This since they perform better under extreme contention
	    than our own implementation.</p>
          <p>
	    Own Id: OTP-9671</p>
        </li>
        <li>
          <p>
	    Convert some erl_nif macros into inline functions. Allow
	    for better compile time type checking. (Thanks to Tuncer
	    Ayaz)</p>
          <p>
	    Own Id: OTP-9675</p>
        </li>
        <li>
          <p>
	    The <span class="code">+scl</span> command line flag has been added. It can
	    be used for disabling compaction of scheduler load. For
	    more information see the <span class="code">erl(1)</span> documentation.</p>
          <p>
	    Own Id: OTP-9695</p>
        </li>
        <li>
	    <p>The build system has been updated so that Erlang/OTP
	    can be built on Mac OS X Lion systems without a GCC
	    compiler. The INSTALL guide has been updated with
	    instructions on how to install a GCC compiler and build
	    Erlang/OTP with it, in order to get a run-time system
	    with better performance.</p>
          <p>
	    Own Id: OTP-9712</p>
        </li>
        <li>
          <p>
	    When loading a module, the system use to run on a single
	    scheduler during the entire loading process. This has
	    been changed to only take down the system just before
	    inserting the loaded code into the system tables,
	    resulting in a much shorter disruption if a module is
	    loaded in a busy system. (Suggested by Bob Ippolito.)</p>
          <p>
	    Own Id: OTP-9720</p>
        </li>
        <li>
          <p>
	    Possible to run HiPE without floating point exceptions
	    (FPE). Useful on platforms that lack reliable FPE. Slower
	    float operations compared to HiPE with FPE.</p>
          <p>
	    Own Id: OTP-9724</p>
        </li>
        <li>
          <p>
	    As of ERTS version 5.9 (OTP-R15B) the runtime system will
	    by default <strong>not</strong> bind schedulers to logical
	    processors.</p>
          <p>
	    If the Erlang runtime system is the only operating system
	    process that binds threads to logical processors, this
	    improves the performance of the runtime system. However,
	    if other operating system processes (as for example
	    another Erlang runtime system) also bind threads to
	    logical processors, there might be a performance penalty
	    instead. In some cases this performance penalty might be
	    severe. Due to this, we change the default so that the
	    user must make an active decision in order to bind
	    schedulers.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-9726</p>
        </li>
        <li>
          <p>
	    The use of <span class="code">erlang:system_flag(scheduler_bind_type,
	    _)</span> and <span class="code">erlang:system_flag(cpu_topology, _)</span>
	    have been deprecated and scheduled for removal in
	    erts-5.10/OTP-R16. For more information see the
	    documentation of <span class="code">erlang:system_flag/2</span>.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-9749</p>
        </li>
        <li>
          <p>
	    An ancient workaround for a Windows bug was removed from
	    the open_port code, open_port({spawn,...}...) is now
	    faster. Thanks to Daniel Goertzen.</p>
          <p>
	    Own Id: OTP-9766</p>
        </li>
        <li>
          <p>
	    The use of deprecated 32bit time_t on 32bit Windows is
	    removed.</p>
          <p>
	    Own Id: OTP-9767</p>
        </li>
        <li>
          <p>
	    The NIF <span class="code">reload</span> mechanism is deprecated. Do not use
	    it as an upgrade method for live production systems. It
	    might be removed in future releases. It can still serve
	    as a development feature but a warning message will be
	    logged each time it is used.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-9771</p>
        </li>
        <li>
	    <p>The driver interface has been changed to enable 64-bit
	    aware drivers. Most importantly the return types for
	    ErlDrvEntry callbacks 'call' and 'control' has ben
	    enlarged which require drivers to be changed or they will
	    cause emulator crashes. See  Rewrites for
	    64-bit driver interface  in the driver manual.
	    </p>
	    <p>Due to this driver version
	    management is now mandatory. A driver that is
	    not written with version management or a driver that was
	    compiled with the wrong major version will be not be
	    loaded by the emulator.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-9795</p>
        </li>
        <li>
          <p>
	    Eliminate use of deprecated regexp module</p>
          <p>
	    Own Id: OTP-9810</p>
        </li>
      </ul>
    



<h3><a name="id67296">1.2 
        Erts 5.8.5</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Several bugs concerning constant binary constructions
	    such as &lt;&lt;0:4294967295&gt;&gt; have been corrected.
	    Depending on the actual size of the binary and the type
	    of run-time system (32-bit, halfword, 64-bit), such
	    expression could either crash the run-time system or make
	    the loader refuse loading of the module.</p>
          <p>
	    Own Id: OTP-9284</p>
        </li>
        <li>
          <p>
	    The Erlsrv utility failed to stop the erlang machine if
	    no StopAction was defined when the service was stopped.
	    This is now corrected.</p>
          <p>
	    Own Id: OTP-9344</p>
        </li>
        <li>
          <p>
	    Due to a bug in glibc the runtime system could abort
	    while trying to destroy a mutex. A fix for this was
	    introduced in R14B02. This fix did, however, not solve
	    the problem. The runtime system will now issue a warning
	    instead of aborting.</p>
          <p>
	    Own Id: OTP-9373 Aux Id: OTP-9009 </p>
        </li>
        <li>
          <p>
	    Replace atom in DRV macro in prim_file with string</p>
          <p>
	    An experimental version of Dialyzer discovered that the
	    atom that replaced the DRV macro in prim_file ends up in
	    calls to erlang:open_port({spawn, Driver}, Portopts) as
	    the Driver argument. The documentation states that this
	    call requires a string there.</p>
          <p>
	    This change is also consistent with the one introduced in
	    commit 0f03b1e9d2bef3bc830c31a369261af4c5234727 by Kostis
	    Sagonas.</p>
          <p>
	    Own Id: OTP-9377</p>
        </li>
        <li>
          <p>
	    Fix typos in the epmd documentation (Thanks to Holger
	    Weiß )</p>
          <p>
	    Own Id: OTP-9387</p>
        </li>
        <li>
          <p>
	    Fix faulty integer terms created by NIF API from 64-bit
	    integers on halfword emulator. (Thanks to Paolo Negri and
	    Paul Davis)</p>
          <p>
	    Own Id: OTP-9394</p>
        </li>
        <li>
          <p>
	    Fix <span class="code">epmd</span> crash on vxworks caused by faulty
	    argument to select() system call.</p>
          <p>
	    Own Id: OTP-9427 Aux Id: seq11855 </p>
        </li>
        <li>
          <p>
	    The ets:test_ms function could in rare cases truncate the
	    error messages. This is now corrected.</p>
          <p>
	    Own Id: OTP-9435</p>
        </li>
        <li>
          <p>
	    Fix bug related to hibernate and HiPE (clear
	    F_HIBERNATE_SCHED flag)</p>
          <p>
	    F_HIBERNATE_SCHED flag that was introduced in
	    b7ecdcd1ae9e11b8f75e must be cleared in hipe_mode_switch
	    as well. Otherwise, processes running HiPE code that
	    hibernate, wake up and then trap into a BIF will not be
	    rescheduled.(Thanks to Paul Guyot)</p>
          <p>
	    Own Id: OTP-9452</p>
        </li>
        <li>
          <p>
	    Fix bug in FreeBSD topology detection code (Thanks to
	    Paul Guyot)</p>
          <p>
	    Own Id: OTP-9453</p>
        </li>
        <li>
          <p>
	    Fix use of logical operator &amp;&amp; with constant
	    operand instead of bitwise &amp; (Thanks to Cristian
	    Greco)</p>
          <p>
	    Own Id: OTP-9454</p>
        </li>
        <li>
          <p>
	    inet: error if fd does not match socket domain</p>
          <p>
	    If an IPv4 fd is opened as an IPv6 socket, unexpected
	    behaviour can occur. For example, if an IPv4 UDP socket
	    is opened and passed into Erlang as an IPv6 socket, the
	    first 3 bytes (corresponding to 1 byte representing the
	    protocol family, 2 bytes set to the port) are stripped
	    from the payload. The cause of the UDP payload truncation
	    happens in inet_drv.c:packet_inet_input when a call to
	    inet_get_address fails silently because the family is set
	    to PF_INET6 but the buffer len is the size of an IPv4
	    struct sockaddr_in.</p>
          <p>
	    (Thanks to Andrew Tunnell-Jones for finding the bug and
	    the test case!)</p>
          <p>
	    Own Id: OTP-9455</p>
        </li>
        <li>
          <p>
	    erts: use a union to avoid strict aliasing issues</p>
          <p>
	    Use a union for pointer type conversion to avoid compiler
	    warnings about strict-aliasing violations with gcc-4.1.
	    gcc &gt;= 4.2 does not emit the warning. erts: adapt
	    matrix_nif to R14 erl_nif API changes (Thanks To Tuncer
	    Ayaz)</p>
          <p>
	    Own Id: OTP-9487</p>
        </li>
        <li>
          <p>
	    fix 64-bit issues in the garbage collection (Thanks to
	    Richard Carlsson)</p>
          <p>
	    Own Id: OTP-9488</p>
        </li>
        <li>
          <p>
	    epmd: fix compiler warnings</p>
          <p>
	    Suppress compiler warnings about ignored return values.
	    (Thanks to Michael Santos )</p>
          <p>
	    Own Id: OTP-9500</p>
        </li>
        <li>
          <p>
	    Fix non-existing function (erlang:disconnect/1) in
	    distributed reference manual (Thanks to Fabian Król)</p>
          <p>
	    Own Id: OTP-9504</p>
        </li>
        <li>
          <p>
	    Document fdatasync -lrt requirement (SunOS &lt;= 5.10)
	    (Thanks to Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-9512</p>
        </li>
        <li>
          <p>
	    Let epmd ignore empty ERL_EPMD_ADDRESS</p>
          <p>
	    If the environment variable ERL_EPMD_ADDRESS is set to
	    the empty string, empd now behaves like it does by
	    default when ERL_EPMD_ADDRESS is unset. That is, in this
	    case, epmd now listens on all available interfaces
	    instead of using only the loopback interface, which
	    happened because epmd added the loopback address to the
	    (in this case empty) list of addresses specified via
	    ERL_EPMD_ADDRESS.</p>
          <p>
	    Also, epmd now ignores ERL_EPMD_ADDRESS if it contains
	    only separator characters (comma and space).</p>
          <p>
	    The same applies to epmd's -address option.(Thanks to
	    Holger Weiß)</p>
          <p>
	    Own Id: OTP-9525</p>
        </li>
        <li>
          <p>
	    Remove dead code in erl_compile (Thanks to Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-9527</p>
        </li>
        <li>
          <p>
	    Add erlang:external_size/2 BIF</p>
          <p>
	    This BIF's second parameter is a list of options.
	    Currently the only allowed option is {minor_version,
	    Version} where version is either 0 (default) or 1.
	    (Thanks to Filipe David Manana )</p>
          <p>
	    Own Id: OTP-9528</p>
        </li>
        <li>
          <p>
	    Fix enif_compare on 64bits machines</p>
          <p>
	    In 64bits machines the Sint type has a size of 8 bytes,
	    while on 32bits machines it has a 4 bytes size.
	    enif_compare was ignoring this and therefore returning
	    incorrect values when the result of the CMP function
	    (which returns a Sint value) doesn't fit in 4 bytes.
	    (Thanks to Filipe David Manana)</p>
          <p>
	    Own Id: OTP-9533</p>
        </li>
        <li>
          <p>
	    Implement or fix -Werror option</p>
          <p>
	    If -Werror is enabled and there are warnings no output
	    file is written. Also make sure that error/warning
	    reporting is consistent. (Thanks to Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-9536</p>
        </li>
        <li>
	    <p>In some rare cases we did not have a run queue when
	    scheduling misc ops. This is now fixed.</p>
          <p>
	    Own Id: OTP-9537</p>
        </li>
        <li>
	    <p>Remove misc. compiler warnings</p>
          <p>
	    Own Id: OTP-9542</p>
        </li>
        <li>
          <p>
	    Two bugs in gen_sctp has been corrected: getopts/setopts
	    hence also send could only be called from socket owner,
	    and options 'linger', 'rcvbuf' and 'sndbuf' was read from
	    wrong protocol layer hence read wrong values by getopts.</p>
          <p>
	    Own Id: OTP-9544</p>
        </li>
        <li>
          <p>
	    Erlang/OTP can now be built on MacOS X Lion.</p>
          <p>
	    Own Id: OTP-9547</p>
        </li>
        <li>
	    <p> XML files have been corrected. </p>
          <p>
	    Own Id: OTP-9550 Aux Id: OTP-9541 </p>
        </li>
        <li>
          <p>
	    Fix potential errors inspired by running cppcheck(1)
	    (Thanks to Christian von Roques)</p>
          <p>
	    Own Id: OTP-9557</p>
        </li>
        <li>
	    <p>When auxiliary work was enqueued on a scheduler, the
	    wakeup of the scheduler in order to handle this work
	    could be lost. Wakeups in order to handle ordinary work
	    were not effected by this bug. The bug only effected
	    runtime systems with SMP support as follows:</p> <ul>
	    <li>Deallocation of some ETS data structures could be
	    delayed.</li> <li>On Linux systems not using the NPTL
	    thread library (typically ancient systems with kernel
	    versions prior to 2.6) and Windows systems, the <span class="code">{Port,
	    {exit_status, Status}}</span> message from a terminating
	    port program could be delayed. That is, it only effected
	    port programs which had been started by passing
	    <span class="code">exit_status</span> as an option to
	    <span class="code">open_port/2</span>.</li> </ul>
          <p>
	    Own Id: OTP-9567</p>
        </li>
        <li>
          <p>
	    Handle rare race in the crypto key server functionality</p>
          <p>
	    Own Id: OTP-9586</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
	    <p> Types and specifications have been added. </p>
          <p>
	    Own Id: OTP-9356</p>
        </li>
        <li>
          <p>
	    New allocator strategy "address order first fit". May
	    ease the emptying of memory carriers and thereby real
	    release of memory back to the OS.</p>
          <p>
	    Own Id: OTP-9424</p>
        </li>
        <li>
          <p>
	    The new <span class="code">erlang:check_old_code/1</span> BIF checks whether
	    a module has old code.</p>
          <p>
	    Own Id: OTP-9495</p>
        </li>
        <li>
	    <p> Update documentation and specifications of some of
	    the zlib functions. </p>
          <p>
	    Own Id: OTP-9506</p>
        </li>
        <li>
          <p>
	    Detect the available CPUs on IRIX</p>
          <p>
	    Add support for querying the number of configured and
	    online processors on SGI systems running IRIX.(Thanks to
	    Holger Weiß)</p>
          <p>
	    Own Id: OTP-9531</p>
        </li>
      </ul>
    



<h3><a name="id65167">1.3 
        Erts 5.8.4</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
	    <p>Fix binary and iolist overflow problems. Typically
	    problems arose in length calculation where the result
	    would exceed (1 bsl 32 - 1).</p>
          <p>
	    Own Id: OTP-9118</p>
        </li>
        <li>
          <p>
	    Using the old erlang shell (i.e. erl instead on werl) on
	    windows and doing several init:restart's would eventually
	    hang the VM. That is no longer the case.</p>
          <p>
	    Own Id: OTP-9139</p>
        </li>
        <li>
          <p>
	    Removed recursive C code when printing Erlang terms to
	    buffers, avoiding stack overflows that could cause VM to
	    crash.</p>
          <p>
	    Own Id: OTP-9140</p>
        </li>
        <li>
          <p>
	    The send_timeout option in gen_tcp did not work properly
	    in active mode or with {active,once} options. This is now
	    corrected.</p>
          <p>
	    Own Id: OTP-9145</p>
        </li>
        <li>
          <p>
	    Fixed various typos across the documentation (Thanks to
	    Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-9154</p>
        </li>
        <li>
	    <p>Remove duplicate stack entries which could occur after
	    calling certain BIFs.</p>
          <p>
	    Own Id: OTP-9163</p>
        </li>
        <li>
          <p>
	    A race when starting two nodes simultaneously using
	    run_erl has been removed.</p>
          <p>
	    Own Id: OTP-9164</p>
        </li>
        <li>
          <p>
	    Add documentation on .erlang processing back again
	    (Thanks to Gabor Liptak)</p>
          <p>
	    Own Id: OTP-9189</p>
        </li>
        <li>
          <p>
	    Remove gratuitous paren in driver_entry(Thanks to Tuncer
	    Ayaz)</p>
          <p>
	    Own Id: OTP-9192</p>
        </li>
        <li>
          <p>
	    Fix some wrong pointer dereferences (Thanks to Cristian
	    Greco)</p>
          <p>
	    Own Id: OTP-9194</p>
        </li>
        <li>
          <p>
	    erts: Remove unused variables (Thanks to Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-9205</p>
        </li>
        <li>
          <p>
	    The documentation for <span class="code">init:get_args/0</span> has been
	    removed. <span class="code">init:get_args/0</span> itself was deprecated in
	    R9C and removed in R12B. (Thanks to Eric Pailleau.)</p>
          <p>
	    Own Id: OTP-9209</p>
        </li>
        <li>
          <p>
	    Allow user to specify the IP address epmd binds to</p>
          <p>
	    The IP address(es) epmd binds to can now be specified by
	    the user, either via epmd's new "-address" option or (if
	    that's not used) by setting the environment variable
	    ERL_EPMD_ADDRESS. Multiple addresses may be specified
	    using a comma-separated list. If the loopback address is
	    not in this list, it will be added implicitly, so that
	    the daemon can be queried by an interactive epmd
	    process.(Thanks to Holger Weiß)</p>
          <p>
	    Own Id: OTP-9213</p>
        </li>
        <li>
          <p>
	    epmd: include host address in local access check</p>
          <p>
	    In FreeBSD jails, the source and destination address of
	    connections to localhost are changed to be the IP address
	    of the jail. Consider connections from the host's IP
	    address to itself (e.g., the source and destination
	    address match) to be local for the access control checks.
	    (Thanks to Michal Santos and Tom at diogunix.com)</p>
          <p>
	    Own Id: OTP-9214</p>
        </li>
        <li>
          <p>
	    Fix list returned by net_kernel:epmd_module</p>
          <p>
	    Function epmd_module of net_kernel returns a list instead
	    of an atom, when the epmd_module-flag is used. (Thanks to
	    Markus Knofe)</p>
          <p>
	    Own Id: OTP-9215</p>
        </li>
        <li>
          <p>
	    Fix epmd's dbg_perror() output</p>
          <p>
	    The dbg_perror() function now hands the current errno
	    value over to dbg_gen_printf(). This fixes the problem
	    that errno had been reset to zero by the time it was used
	    (to print the corresponding error message) in the
	    dbg_gen_printf() function. (Thanks to Holger Weiß)</p>
          <p>
	    Own Id: OTP-9223</p>
        </li>
        <li>
          <p>
	    heart: remove garbage appended to heart command</p>
          <p>
	    heart:get_cmd/0 is documented to return an empty string
	    if the command is cleared. get_cmd/0 returns 2 extra
	    bytes: 1 byte for the trailing null, 1 byte from the op
	    (the op is an unsigned char and 2 bytes are allocated for
	    it in the returned buffer). (Thanks to Michael Santos)</p>
          <p>
	    Own Id: OTP-9224</p>
        </li>
        <li>
          <p>
	    file: fix hang reading compressed files</p>
          <p>
	    The gzio driver goes into an infinite loop when reading
	    past the end of a compressed file. Reported-By: Alex
	    Morarash (Thanks to Michael Santos)</p>
          <p>
	    Own Id: OTP-9245</p>
        </li>
        <li>
	    <p>Eliminate alias warnings from gcc 4.5.2</p>
          <p>
	    Own Id: OTP-9250</p>
        </li>
        <li>
          <p>
	    Unsigned integer may overflow in error message (Thanks to
	    Michael Santos)</p>
          <p>
	    Own Id: OTP-9251</p>
        </li>
        <li>
          <p>
	    Driver names should be strings, not atoms</p>
          <p>
	    Own Id: OTP-9253</p>
        </li>
        <li>
          <p>
	    driver_entry: Remove gratuitous paren and fix typo
	    (Thanks to Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-9254</p>
        </li>
        <li>
          <p>
	    Fix format specifiers in erl_exit messages</p>
          <p>
	    Fix an error message by using an unsigned integer
	    specifier as seen in a tweet by @metabrew: #erlang VM
	    crashed with "no next heap size found: -2090496108,
	    offset 0", suddenly allocated all available RAM</p>
          <p>
	    Also correct mis-typed string formats in bif.c.(Thanks to
	    Michael Santos)</p>
          <p>
	    Own Id: OTP-9262</p>
        </li>
        <li>
          <p>
	    net_drv: remove unused tcp request id inet_drv: remove
	    gratuitous assignment (Thanks to Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-9263</p>
        </li>
        <li>
          <p>
	    Teach run_erl RUN_ERL_DISABLE_FLOWCNTRL for disabling
	    flow control</p>
          <p>
	    Flow control can cause unwanted behaviour of the beam
	    process, if accidentally hit Ctrl-S (instead of Ctrl-D to
	    detach) the entire beam may be blocked.</p>
          <p>
	    Fix this problem by making it possible to turn off flow
	    control by setting the environment variable
	    RUN_ERL_DISABLE_FLOWCNTRL. (Thanks to Jonas Faklkevik)</p>
          <p>
	    Own Id: OTP-9270</p>
        </li>
        <li>
	    <p>The following bugs due to missing memory barriers have
	    been fixed:</p> <ul> <li><p> ETS tables using the
	    <span class="code">write_concurrency</span> option could potentially get
	    into an internally inconsistent state. </p></li>
	    <li><p> ETS tables using the <span class="code">ordered_set</span> option
	    could potentially get into an internally inconsistent
	    state. </p></li> <li>
<p> A number of memory barriers
	    have been added when building with the
	    <span class="code">libatomic_ops</span> API (i.e. when passing
	    <span class="code">--with-libatomic_ops=PATH</span> to <span class="code">configure</span>) and
	    the tilera atomics API (i.e. when building for the tilera
	    chip). Note that these bugs were due to erroneous usage
	    of the APIs, and not in the implementations of the APIs.
	    When using these APIs the following bugs where
	    present:</p> <ul> <li><p> The BIF
	    <span class="code">erlang:ports/0</span> could return an erroneous result.
	    </p></li> <li><p> A thread blocking other threads
	    during code loading, or setup of tracing could
	    potentially read invalid data. </p></li> <li><p>
	    Fixation of ETS tables could potentially get into an
	    internally inconsistent state. </p></li> </ul>
	    </li> </ul>
          <p>
	    Own Id: OTP-9281</p>
        </li>
        <li>
          <p>
	    Fix halfword bug for ETS ordered_set when doing
	    <span class="code">select/match</span> with partly bound key.</p>
          <p>
	    Own Id: OTP-9292</p>
        </li>
        <li>
          <p>
	    Fix bug in <span class="code">code:is_module_native</span> that caused crash
	    for deleted modules.</p>
          <p>
	    Own Id: OTP-9298</p>
        </li>
        <li>
          <p>
	    Calling <span class="code">driver_async_cancel()</span> could cause a
	    scheduler thread to enter an eternal loop doing no useful
	    work. (Thanks to Anders Ramsell)</p>
          <p>
	    Own Id: OTP-9302</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    New <span class="code">enif_is_exception function</span> to allow NIFs to
	    determine whether an <span class="code">ERL_NIF_TERM</span> represents an
	    exception. (Thanks to Steve Vinoski)</p>
          <p>
	    Own Id: OTP-9150</p>
        </li>
        <li>
          <p>
	    A process being garbage collected by another process
	    could be scheduled on another scheduler. This prevented
	    this scheduler from doing any useful work until the
	    garbage collection was done. This either occurred due to
	    a explicit call to the <span class="code">garbage_collect/1</span> BIF, or
	    due to a garbage collection part of code loading. A
	    process being garbage collected like this will now not be
	    scheduled until the garbage collection has completed.</p>
          <p>
	    Own Id: OTP-9211</p>
        </li>
        <li>
          <p>
	    Remove unnecessary validation copy in
	    prim_file:drv_command/3 (Thanks to Tony Rogvall)</p>
          <p>
	    Own Id: OTP-9276</p>
        </li>
        <li>
          <p>
	    Symbolic link handling on windows have been slightly
	    updated to map error conditions more consequently and
	    correctly read directory links created outside of the
	    Erlang environment.</p>
          <p>
	    Own Id: OTP-9279</p>
        </li>
        <li>
          <p>
	    Due to standard library DLL mismatches between versions
	    of OpenSSL and Erlang/OTP, OpenSSL is now linked
	    statically to the crypto driver on Windows. This fixes
	    problems starting crypto when running Erlang as a service
	    on all Windows versions.</p>
          <p>
	    Own Id: OTP-9280</p>
        </li>
        <li>
	    <p>Halfword emulator memory handling improvements:</p>
	    <ul> <li>
<p>Much more of internal memory structures
	    have been made able to use "high" memory and are no
	    longer restricted to the 4Gb limit that still applies for
	    all process heap data.</p> </li> <li>
<p>Fixed faulty
	    values from <span class="code">erlang:memory()</span> caused by 32-bit
	    counter overflow.</p> </li> <li>
<p>New counter
	    <span class="code">low</span> in <span class="code">erlang:memory()</span> that sums up all
	    memory restricted by 4Gb limit.</p> </li> </ul>
          <p>
	    Own Id: OTP-9291 Aux Id: seq11841 </p>
        </li>
        <li>
          <p>
	    The value set in the undocumented and unsupported
	    ERL_version_FLAGS (e.g. ERL_R14B03_FLAGS) environment
	    variable can now be overridden by the command line
	    (similar to ERL_AFLAGS).</p>
          <p>
	    Own Id: OTP-9297</p>
        </li>
      </ul>
    



<h3><a name="id127268">1.4 
        Erts 5.8.3.2</a></h3>

    <h4>Known Bugs and Problems</h4>
      <ul>
        <li>
          <p>
	    Fix halfword emulator bug in <span class="code">ets:select_delete</span> for
	    <span class="code">ordered_set</span> that caused emulator to crash.</p>
          <p>
	    Own Id: OTP-9258 Aux Id: seq11836 </p>
        </li>
      </ul>
    



<h3><a name="id127305">1.5 
        Erts 5.8.3.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Ets table type ordered_set could order large integer keys
	    wrongly on pure 64bit platforms. This is now corrected.</p>
          <p>
	    Own Id: OTP-9181</p>
        </li>
        <li>
          <p>
	    The status of a process was unnecessarily set to waiting
	    before a process was enqueued in a run queue. This bug
	    was harmless up until OTP-R14B01. In OTP-R14B02
	    <span class="code">erlang:hibernate/3</span> was fixed (OTP-9125). After the
	    introduction of OTP-9125, the previously harmless process
	    status bug sometimes caused erroneous badarg exceptions
	    from <span class="code">process_info()</span>.</p>
          <p>
	    OTP-9125 also introduced a thread unsafe access to the
	    status field of a process which now also have been fixed.</p>
          <p>
	    *** INCOMPATIBILITY with noxs ***</p>
          <p>
	    Own Id: OTP-9197</p>
        </li>
      </ul>
    



<h3><a name="id127366">1.6 
        Erts 5.8.3</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    The scroll wheel now scrolls the werl window on Windows.</p>
          <p>
	    Own Id: OTP-8985</p>
        </li>
        <li>
          <p>
	    Some malformed distribution messages could cause VM to
	    crash, this is now corrected.</p>
          <p>
	    Own Id: OTP-8993</p>
        </li>
        <li>
          <p>
	    The OS function getifaddrs() can return NULL in some
	    address fields for e.g PPP and tunnel devices which
	    caused the emulator to segfault. This bug has now been
	    corrected.</p>
          <p>
	    Own Id: OTP-8996</p>
        </li>
        <li>
          <p>
	    The expression &lt;&lt;A:0&gt;&gt; would always produce
	    an empty binary, even if <span class="code">A</span> was not an integer.
	    Corrected to cause a <span class="code">badarg</span> exception if the type
	    of <span class="code">A</span> is invalid. (Thanks to Zvi.)</p>
          <p>
	    Own Id: OTP-8997</p>
        </li>
        <li>
          <p>
	    A bug that potentially could cause an emulator crash when
	    deleting an ETS-table has been fixed. A resource leak
	    when hitting the maximum amount of ETS-tables allowed has
	    also been fixed.</p>
          <p>
	    Own Id: OTP-8999</p>
        </li>
        <li>
          <p>
	    A bug in the <span class="code">exit/2</span> BIF could potentially cause an
	    emulator crash.</p>
          <p>
	    Own Id: OTP-9005</p>
        </li>
        <li>
          <p>
	    Due to a bug in glibc the runtime system could abort
	    while trying to destroy a mutex. The runtime system will
	    now issue a warning instead of aborting.</p>
          <p>
	    Own Id: OTP-9009</p>
        </li>
        <li>
          <p>
	    A bug in epmd could create strange behaviour when
	    listen() calls failed. This is now corrected thanks to
	    Steve Vinoski.</p>
          <p>
	    Own Id: OTP-9024</p>
        </li>
        <li>
	    <p>When setting file_info the win32_driver will now
	    correctly set access and modified time. Previously these
	    entities were swapped.</p>
          <p>
	    Own Id: OTP-9046</p>
        </li>
        <li>
          <p>
	    Setting scheduler bind type to <span class="code">unbound</span> failed if
	    binding of schedulers wasn't supported, or if CPU
	    topology wasn't present. This even though the
	    documentation stated that it is possible to set the bind
	    type to <span class="code">unbound</span>.</p>
          <p>
	    Own Id: OTP-9056 Aux Id: Seq11779 </p>
        </li>
        <li>
	    <p>Two problems were fixed in crash dump: The time left
	    for timers are now shown as unsigned integers and the
	    contents of ordered_set ETS tables is no longer
	    included.</p>
          <p>
	    Own Id: OTP-9057</p>
        </li>
        <li>
          <p>
	    The VM could fail to set IP_TOS and SO_PRIORITY in
	    certain situations, either because sockets were supplied
	    as open file descriptors, or because SO_PRIORITY by
	    default was set higher than the user can explicitly set
	    it to. Those situations are now handled.</p>
          <p>
	    Own Id: OTP-9069</p>
        </li>
        <li>
          <p>
	    Wx on MacOS X generated complains on stderr about certain
	    cocoa functions not beeing called from the "Main thread".
	    This is now corrected.</p>
          <p>
	    Own Id: OTP-9081</p>
        </li>
        <li>
          <p>
	    Fix a couple typos in driver_entry(3) (thanks to Tuncer
	    Ayaz).</p>
          <p>
	    Own Id: OTP-9085</p>
        </li>
        <li>
          <p>
	    Mention that "-detached" implies "-noinput"</p>
          <p>
	    Clarify that specifying "-noinput" is unnecessary if the
	    "-detached" flag is given. (thanks to Holger Weiß)</p>
          <p>
	    Own Id: OTP-9086</p>
        </li>
        <li>
          <p>
	    A potential problem (found by code inspection) when
	    calling a fun whose code was not loaded has been fixed.</p>
          <p>
	    Own Id: OTP-9095</p>
        </li>
        <li>
          <p>
	    The emulator could get into a state where it didn't check
	    for I/O.</p>
          <p>
	    Own Id: OTP-9105 Aux Id: Seq11798 </p>
        </li>
        <li>
          <p>
	    Attempting to create binaries exceeding 2Gb (using for
	    example <span class="code">term_to_binary/1</span>) would crash the emulator
	    with an attempt to allocate huge amounts of memory.
	    (Thanks to Jon Meredith.)</p>
          <p>
	    Own Id: OTP-9117</p>
        </li>
        <li>
          <p>
	    Fix erlang:hibernate/3 on HiPE enabled emulator (Thanks
	    to Paul Guyot)</p>
          <p>
	    Own Id: OTP-9125</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
	    <p>From this release, the previously experimental
	    halfword emulator is now official. It can be enabled by
	    giving the <span class="code">--enable-halfword-emulator</span> option to
	    the <span class="code">configure</span> script.</p>
	    <p>The halfword emulator is a 64-bit application, but
	    uses halfwords (32-bit words) for all data in Erlang
	    processes, therefore using less memory and being faster
	    than the standard 64-bit emulator. The total size of all
	    BEAM code and all process data for all processes is
	    limited to 4Gb, but ETS tables and off-heap binaries are
	    only limited by the amount of available memory.</p>
          <p>
	    Own Id: OTP-8941</p>
        </li>
        <li>
          <p>
	    32-bit atomic memory operations have been introduced
	    internally in the run time system, and are now used where
	    appropriate. There were previously only atomic memory
	    operations of word size available. The 32-bit atomic
	    memory operations slightly reduce memory consumption, and
	    slightly improve performance on 64-bit runtime systems.</p>
          <p>
	    Own Id: OTP-8974</p>
        </li>
        <li>
          <p>
	    Performance enhancements for looking up timer-entries and
	    removing timers from the wheel.</p>
          <p>
	    Own Id: OTP-8990</p>
        </li>
        <li>
          <p>
	    Write accesses to ETS tables have been optimized by
	    reducing the amount of atomic memory operations needed
	    during a write access.</p>
          <p>
	    Own Id: OTP-9000</p>
        </li>
        <li>
          <p>
	    Strange C coding in the VM made the -D_FORTIFY_SOURCE
	    option to gcc-4.5 react badly. The code is now cleaned up
	    so that it's accepted by gcc-4.5.</p>
          <p>
	    Own Id: OTP-9025</p>
        </li>
        <li>
          <p>
	    The memory footprint for loaded code has been somewhat
	    reduced (especially in the 64-bit BEAM machine).</p>
          <p>
	    Own Id: OTP-9030</p>
        </li>
        <li>
          <p>
	    The maximum number of allowed arguments for an Erlang
	    function has been lowered from 256 to 255, so that the
	    number of arguments can now fit in a byte.</p>
          <p>
	    Own Id: OTP-9049</p>
        </li>
        <li>
          <p>
	    Dependency generation for Makefiles has been added to the
	    compiler and erlc. See the manual pages for
	    <span class="code">compile</span> and <span class="code">erlc</span>. (Thanks to Jean-Sebastien
	    Pedron.)</p>
          <p>
	    Own Id: OTP-9065</p>
        </li>
      </ul>
    



<h3><a name="id127781">1.7 
        Erts 5.8.2</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
	    <p> Fix format_man_pages so it handles all man sections
	    and remove warnings/errors in various man pages. </p>
          <p>
	    Own Id: OTP-8600</p>
        </li>
        <li>
          <p>
	    The <span class="code">configure</span> command line argument <span class="bold_code"><a href="javascript:erlhref('../../../doc/../','doc/installation_guide','INSTALL.html#How-to-Build-and-Install-ErlangOTP_A-Closer-Look-at-the-individual-Steps_Configuring');">--enable-ethread-pre-pentium4-compatibility</a></span>
	    had no effect. This option is now also automatically
	    enabled if required on the build machine.</p>
          <p>
	    Own Id: OTP-8847</p>
        </li>
        <li>
          <p>
	    Windows 2003 and Windows XP pre SP3 would sometimes not
	    start the Erlang R14B VM at all due to a bug in the cpu
	    topology detection. The bug affects Windows only, no
	    other platform is even remotely affected. The bug is now
	    corrected.</p>
          <p>
	    Own Id: OTP-8876</p>
        </li>
        <li>
          <p>
	    The HiPE run-time in the 64-bit emulator could do a
	    64-bit write to a 32-bit struct field. It happened to be
	    harmless on Intel/AMD processors. Corrected. (Thanks to
	    Mikael Pettersson.)</p>
          <p>
	    Own Id: OTP-8877</p>
        </li>
        <li>
          <p>
	    A bug in erl_drv_tsd_get()
	    and enif_tsd_get()
	    could cause an emulator crash. These functions are
	    currently not used in OTP. That is, the crash only occur
	    on systems with user implemented NIF libraries, or
	    drivers that use one of these functions.</p>
          <p>
	    Own Id: OTP-8889</p>
        </li>
        <li>
          <p>
	    Calling <span class="code">erlang:system_info({cpu_topology,
	    CpuTopologyType})</span> with another <span class="code">CpuTopologyType</span>
	    element than one of the documented atoms <span class="code">defined</span>,
	    <span class="code">detected</span>, or <span class="code">used</span> caused an emulator crash.
	    (Thanks to Paul Guyot)</p>
          <p>
	    Own Id: OTP-8914</p>
        </li>
        <li>
          <p>
	    The ERTS internal rwlock implementation could get into an
	    inconsistent state. This bug was very seldom triggered,
	    but could be during heavy contention. The bug was
	    introduced in R14B (erts-5.8.1).</p>
          <p>
	    The bug was most likely to be triggered when using the
	    <span class="code">read_concurrency</span> option on an ETS table that was
	    frequently accessed from multiple processes doing lots of
	    writes and reads. That is, in a situation where you
	    typically don't want to use the <span class="code">read_concurrency</span>
	    option in the first place.</p>
          <p>
	    Own Id: OTP-8925 Aux Id: OTP-8544 </p>
        </li>
        <li>
          <p>
	    Tracing to port could cause an emulator crash when
	    unloading the trace driver.</p>
          <p>
	    Own Id: OTP-8932</p>
        </li>
        <li>
          <p>
	    Removed use of CancelIoEx on Windows that had been shown
	    to cause problems with some drivers.</p>
          <p>
	    Own Id: OTP-8937</p>
        </li>
        <li>
          <p>
	    The fallback implementation used when no native atomic
	    implementation was found did not compile. (Thanks to
	    Patrick Baggett, and Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-8944</p>
        </li>
        <li>
          <p>
	    Some integer values used during load balancing could
	    under rare circumstances wrap causing a load unbalance
	    between schedulers.</p>
          <p>
	    Own Id: OTP-8950</p>
        </li>
        <li>
          <p>
	    The windows VM now correctly handles appending to large
	    files (&gt; 4GB).</p>
          <p>
	    Own Id: OTP-8958</p>
        </li>
        <li>
          <p>
	    Name resolving of IPv6 addresses has been implemented for
	    Windows versions that support it. The use of ancient
	    resolver flags (AI_V4MAPPED | AI_ADDRCONFIG) to the
	    getaddrinfo() function has been removed since e.g FreeBSD
	    regard mapped IPv4 addresses to be a security problem and
	    the semantics of the address configured flag is
	    uncertain.</p>
          <p>
	    Own Id: OTP-8969</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    The help texts produced by the <span class="code">configure</span> scripts
	    in the top directory and in the erts directory have been
	    aligned and cleaned up.</p>
          <p>
	    Own Id: OTP-8859</p>
        </li>
        <li>
          <p>
	    When the runtime system had fewer schedulers than logical
	    processors, the system could get an unnecessarily large
	    amount reader groups.</p>
          <p>
	    Own Id: OTP-8861</p>
        </li>
        <li>
          <p>
	    <span class="code">run_rel</span> has been updated to support Solaris's
	    /dev/ptmx device and to load the necessary STREAMS
	    modules so that <span class="code">to_erl</span> can provide terminal echo
	    of keyboard input. (Thanks to Ryan Tilder.)</p>
          <p>
	    Own Id: OTP-8878</p>
        </li>
        <li>
          <p>
	    The Erlang VM now supports Unicode filenames. The feature
	    is turned on by default on systems where Unicode
	    filenames are mandatory (Windows and MacOSX), but can be
	    enabled on other systems with the '+fnu' emulator option.
	    Enabling the Unicode filename feature on systems where it
	    is not default is however considered experimental and not
	    to be used for production. Together with the Unicode file
	    name support, the concept of "raw filenames" is
	    introduced, which means filenames provided without
	    implicit unicode encoding translation. Raw filenames are
	    provided as binaries, not lists. For further information,
	    see stdlib users guide and the chapter about using
	    Unicode in Erlang. Also see the file module manual page.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8887</p>
        </li>
        <li>
	    <p>Buffer overflows have been prevented in <span class="code">erlc</span>,
	    <span class="code">dialyzer</span>, <span class="code">typer</span>, <span class="code">run_test</span>,
	    <span class="code">heart</span>, <span class="code">escript</span>, and <span class="code">erlexec</span>.</p>
	    (Thanks to Michael Santos.)
          <p>
	    Own Id: OTP-8892</p>
        </li>
        <li>
          <p>
	    The runtime system is now less eager to suspend processes
	    sending messages over the distribution. The default value
	    of the distribution buffer busy limit has also been
	    increased from 128 KB to 1 MB. This in order to improve
	    throughput.</p>
          <p>
	    Own Id: OTP-8901</p>
        </li>
        <li>
          <p>
	    The distribution buffer busy limit can now be configured
	    at system startup. For more information see the
	    documentation of the <span class="code">erl</span> +zdbbl command line flag.
	    (Thanks to Scott Lystig Fritchie)</p>
          <p>
	    Own Id: OTP-8912</p>
        </li>
        <li>
          <p>
	    The inet driver internal buffer stack implementation has
	    been rewritten in order to reduce lock contention.</p>
          <p>
	    Own Id: OTP-8916</p>
        </li>
        <li>
          <p>
	    New ETS option <span class="code">compressed</span>, to enable a more
	    compact storage format at the expence of heavier table
	    operations. For test and evaluation, <span class="code">erl +ec</span> can
	    be used to force compression on all ETS tables.</p>
          <p>
	    Own Id: OTP-8922 Aux Id: seq11658 </p>
        </li>
        <li>
          <p>
	    There is now a new function inet:getifaddrs/0 modeled
	    after C library function getifaddrs() on BSD and LInux
	    that reports existing interfaces and their addresses on
	    the host. This replaces the undocumented and unsupported
	    inet:getiflist/0 and inet:ifget/2.</p>
          <p>
	    Own Id: OTP-8926</p>
        </li>
        <li>
          <p>
	    Support for detection of CPU topology and binding of
	    schedulers on FreeBSD 8 have been added. (Thanks to Paul
	    Guyot)</p>
          <p>
	    Own Id: OTP-8939</p>
        </li>
        <li>
          <p>
	    Several bugs related to hibernate/3 and HiPE have been
	    corrected. (Thanks to Paul Guyot.)</p>
          <p>
	    Own Id: OTP-8952</p>
        </li>
        <li>
          <p>
	    Support for soft and hard links on Windows versions and
	    filesystems that support them is added.</p>
          <p>
	    Own Id: OTP-8955</p>
        </li>
        <li>
          <p>
	    The win32 virtual machine is now linked large address
	    aware. his allows the Erlang VM to use up to 3 gigs of
	    address space on Windows instead of the default of 2
	    gigs.</p>
          <p>
	    Own Id: OTP-8956</p>
        </li>
      </ul>
    



<h3><a name="id128266">1.8 
        Erts 5.8.1.2</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
	    <p> Fix that the documentation top index generator can
	    handle an Ericsson internal application group. </p>
          <p>
	    Own Id: OTP-8875</p>
        </li>
        <li>
	    <p>In embedded mode, on_load handlers that called
	    <span class="code">code:priv_dir/1</span> or other functions in <span class="code">code</span>
	    would hang the system. Since the <span class="code">crypto</span>
	    application now contains an on_loader handler that calls
	    <span class="code">code:priv_dir/1</span>, including the <span class="code">crypto</span>
	    application in the boot file would prevent the system
	    from starting.</p>
	    <p>Also extended the <span class="code">-init_debug</span> option to print
	    information about on_load handlers being run to
	    facilitate debugging.</p>
          <p>
	    Own Id: OTP-8902 Aux Id: seq11703 </p>
        </li>
      </ul>
    



<h3><a name="id128336">1.9 
        Erts 5.8.1.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Windows 2003 and Windows XP pre SP3 would sometimes not
	    start the Erlang R14B VM at all due to a bug in the cpu
	    topology detection. The bug affects Windows only, no
	    other platform is even remotely affected. The bug is now
	    corrected.</p>
          <p>
	    Own Id: OTP-8876</p>
        </li>
      </ul>
    



<h3><a name="id128368">1.10 
        Erts 5.8.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Very small floating point numbers generated errors when
	    converting from list to float in some versions of the VM,
	    this is now corrected so that i.e.
	    list_to_float("1.0e-324"). returns 0.0 in all versions of
	    Erlang.</p>
          <p>
	    Own Id: OTP-7178</p>
        </li>
        <li>
          <p>
	    Windows Vista and Windows 7 file system virtualization,
	    which makes "old style" windows programs execute in a
	    file system sandbox, was previously unintentionally
	    turned on for the Erlang VM. This is now corrected so
	    that i.e. writes to C:\Program Files\. without
	    administrator privileges will fail.</p>
          <p>
	    Own Id: OTP-7405</p>
        </li>
        <li>
          <p>
	    Fix faulty 64-bit integer term output from drivers. Large
	    64-bits integers did not generate correct bignums and
	    could even cause emulator crash. Only affects drivers
	    using ERL_DRV_INT64 or ERL_DRV_UINT64, introduced in
	    R13B03.</p>
          <p>
	    Own Id: OTP-8716</p>
        </li>
        <li>
          <p>
	    Fixed: inet:setopts(S, [{linger,{true,2}}]) returned
	    {error,einval} for SCTP sockets. The inet_drv had a bug
	    when checking the option size.</p>
          <p>
	    Own Id: OTP-8726 Aux Id: seq11617 </p>
        </li>
        <li>
	    <p>Fix libm linking with --as-needed flag
          <p>
	    When building with "--as-needed" linker flags on Linux
	    the build will fail. This has now been fixed.</p>
          <p>
	    (Thanks to Christian Faulhammer)</p></p>
          <p>
	    Own Id: OTP-8728</p>
        </li>
        <li>
          <p>
	    gen_udp:connect/3 was broken for SCTP enabled builds. It
	    did not detect remote end errors as it should.</p>
          <p>
	    Own Id: OTP-8729</p>
        </li>
        <li>
	    <p>Reduce the risk of integer wrapping in bin vheap size
	    counting.</p> <p>The vheap size series will now use the
	    golden ratio instead of doubling and fibonacci
	    sequences.</p>
          <p>
	    Own Id: OTP-8730</p>
        </li>
        <li>
          <p>
	    ETS ordered_set containing <span class="code">[]</span> as key could cause
	    strange thing to happen, like an infinite hanging
	    <span class="code">ets:select</span>.</p>
          <p>
	    Own Id: OTP-8732</p>
        </li>
        <li>
	    <p>reference() has been substituted for ref() in the
	    documentation.</p>
          <p>
	    Own Id: OTP-8733</p>
        </li>
        <li>
          <p>
	    When a native compiled module called a not loaded
	    non-native compiled module that had an on_load function,
	    the export entries were trashed after code loading so on
	    the next call from the native compiled module to the
	    non-native compiled the emulator crashed. This bug has
	    now been fixed.</p>
          <p>
	    Own Id: OTP-8736</p>
        </li>
        <li>
          <p>
	    HiPE-enabled Erlang VMs running on BSD systems sometimes
	    generated messages like "Yikes! erts_alloc() returned
	    misaligned address 0x8016a512c". Fixed. (Thanks to Mikael
	    Pettersson.)</p>
          <p>
	    Own Id: OTP-8769</p>
        </li>
        <li>
          <p>
	    A race condition in <span class="code">erts_poll()</span> could cause delay
	    of poll for I/O.</p>
          <p>
	    Own Id: OTP-8773</p>
        </li>
        <li>
          <p>
	    Removed some potential vulnerabilities from the Erlang
	    Port Mapper Daemon (epmd) and straightened up access
	    control. Also removed hazardous interfaces allowing
	    anyone on a machine to forcefully unregister other nodes.
	    This means that the ei_unregister/erl_unregister
	    interfaces in erl_interface is rendered not only error
	    prone and mystifying as before, but totally ineffective.
	    The old behaviour of unchecked node unregistering can be
	    restored if needed, see epmd documentation for details.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8780</p>
        </li>
        <li>
	    <p> Building in a source tree without prebuilt platform
	    independent build results failed on the SSL examples
	    when: </p> <ul>
<li> cross building. This has been
	    solved by not building the SSL examples during a cross
	    build. </li>
<li> building on Windows. </li>
</ul>
          <p>
	    Own Id: OTP-8791</p>
        </li>
        <li>
          <p>
	    inet:getsockopt for SCTP sctp_default_send_param had a
	    bug to not initialize required feilds causing random
	    answers. It is now corrected.</p>
          <p>
	    Own Id: OTP-8795 Aux Id: seq11655 </p>
        </li>
        <li>
          <p>
	    The hipe_bifs:get_hrvtime/0 BIF now always returns a real
	    value even if the "perfctr" Linux kernel extension is not
	    available. It used to return a dummy value. (Thanks to
	    Mikael Pettersson.)</p>
          <p>
	    Own Id: OTP-8798</p>
        </li>
        <li>
          <p>
	    Calling a native-code compiled module with an
	    <span class="code">on_load</span> function could cause a crash. (Thanks to
	    Mikael Pettersson.)</p>
          <p>
	    Own Id: OTP-8799</p>
        </li>
        <li>
	    <p>The emulator could crash while writing a crash dump if
	    native-compiled modules had been loaded. (Thanks to Paul
	    Guyot.)</p>
          <p>
	    Own Id: OTP-8801</p>
        </li>
        <li>
          <p>
	    The garbage collector could crash if invoked from
	    native-compiled code after a call to a BIF. (Thanks to
	    Paul Guyot.)</p>
          <p>
	    Own Id: OTP-8821</p>
        </li>
        <li>
          <p>
	    A rare memory leak in binary:matches is removed</p>
          <p>
	    Own Id: OTP-8823</p>
        </li>
        <li>
	    <p>For a socket in the HTTP packet mode, the return value
	    from <span class="code">gen_tcp:recv/2,3</span> if there is an error in the
	    header will be <span class="code">{ok,{http_error,String}}</span> instead of
	    <span class="code">{error,{http_error,String}}</span> to be consistent with
	    <span class="code">ssl:recv/2,3</span>.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8831</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    ets:select_reverse/{1,2,3} are now documented.</p>
          <p>
	    Own Id: OTP-7863</p>
        </li>
        <li>
          <p>
	    External format of integers changed to make full use of
	    all 32 bits of INTEGER_EXT. This is a compatible change
	    as old code can read full 32-bit integers but only
	    produce 28-bit integers as INTEGER_EXT.</p>
          <p>
	    Own Id: OTP-8540 Aux Id: seq11534 </p>
        </li>
        <li>
          <p>
	    Large parts of the <span class="code">ethread</span> library have been
	    rewritten. The <span class="code">ethread</span> library is an Erlang
	    runtime system internal, portable thread library used by
	    the runtime system itself.</p>
          <p>
	    Most notable improvement is a reader optimized rwlock
	    implementation which dramatically improve the performance
	    of read-lock/read-unlock operations on multi processor
	    systems by avoiding ping-ponging of the rwlock cache
	    lines. The reader optimized rwlock implementation is used
	    by miscellaneous rwlocks in the runtime system that are
	    known to be read-locked frequently, and can be enabled on
	    ETS tables by passing the <span class="bold_code"><a href="javascript:erlhref('../../../doc/../','stdlib','ets.html#new_2_read_concurrency');">{read_concurrency,
	    true}</a></span> option upon table creation. See the
	    documentation of <span class="bold_code"><a href="javascript:erlhref('../../../doc/../','stdlib','ets.html#new-2');">ets:new/2</a></span> for more
	    information. The reader optimized rwlock implementation
	    can be fine tuned when starting the runtime system. For
	    more information, see the documentation of the <span class="bold_code"><a href="javascript:erlhref('../../../doc/../','erts','erl.html#+rg');">+rg</a></span> command line argument
	    of <span class="code">erl</span>.</p>
          <p>
	    There is also a new implementation of rwlocks that is not
	    optimized for readers. Both implementations interleaves
	    readers and writers during contention as opposed to,
	    e.g., the NPTL (Linux) pthread rwlock implementation
	    which use either a reader or writer preferred strategy.
	    The reader/writer preferred strategy is problematic since
	    it starves threads doing the non-preferred operation.</p>
          <p>
	    The new rwlock implementations in general performs better
	    in ERTS than common pthread implementations. However, in
	    some extremely heavily contended cases this is not the
	    case. Such heavy contention can more or less only appear
	    on ETS tables. This when multiple processes do very large
	    amounts of write locked operations simultaneously on the
	    same table. Such use of ETS is bad regardless of rwlock
	    implementation, will never scale, and is something we
	    strongly advise against.</p>
          <p>
	    The new rwlock implementations depend on atomic
	    operations. If no native atomic implementation is found,
	    a fallback solution will be used. Using the fallback
	    implies a performance degradation. That is, it is more
	    important now than before to build OTP with a native
	    atomic implementation.</p>
          <p>
	    The <span class="code">ethread</span> library contains native atomic
	    implementations for, x86 (32 and 64 bit), powerpc (32
	    bit), sparc V9 (32 and 64 bit), and tilera (32 bit). On
	    other hardware gcc's builtin support for atomic memory
	    access will be used if such exists. If no such support is
	    found, <span class="code">configure</span> will warn about no atomic
	    implementation available.</p>
          <p>
	    The <span class="code">ethread</span> library can now also use the
	    <span class="code">libatomic_ops</span> library for atomic memory accesses.
	    This makes it possible for the Erlang runtime system to
	    utilize optimized native atomic operations on more
	    platforms than before. If <span class="code">configure</span> warns about no
	    atomic implementation available, try using the
	    <span class="code">libatomic_ops</span> library. Use the <span class="bold_code"><a href="javascript:erlhref('../../../doc/../','doc/installation_guide','INSTALL.html#How-to-Build-and-Install-ErlangOTP_A-Closer-Look-at-the-individual-Steps_Configuring');">--with-libatomic_ops=PATH</a></span>
	    <span class="code">configure</span> command line argument when specifying
	    where the <span class="code">libatomic_ops</span> installation is located.
	    The <span class="code">libatomic_ops</span> library can be downloaded from:
	    <span class="bold_code"><a href="http://www.hpl.hp.com/research/linux/atomic_ops/">http://www.hpl.hp.com/research/linux/atomic_ops/</a></span></p>
          <p>
	    The changed API of the <span class="code">ethread</span> library has also
	    caused modifications in the Erlang runtime system.
	    Preparations for the to come "delayed deallocation"
	    feature has also been done since it depends on the
	    <span class="code">ethread</span> library.</p>
          <p>
	    <strong>Note</strong>: When building for x86, the <span class="code">ethread</span>
	    library will now use instructions that first appeared on
	    the pentium 4 processor. If you want the runtime system
	    to be compatible with older processors (back to 486) you
	    need to pass the <span class="bold_code"><a href="javascript:erlhref('../../../doc/../','doc/installation_guide','INSTALL.html#How-to-Build-and-Install-ErlangOTP_A-Closer-Look-at-the-individual-Steps_Configuring');">--enable-ethread-pre-pentium4-compatibility</a></span>
	    <span class="code">configure</span> command line argument when configuring
	    the system.</p>
          <p>
	    Own Id: OTP-8544</p>
        </li>
        <li>
          <p>
	    erlang:localtime_to_universaltime({{2008, 8, 1}, {0, 0,
	    0}},true) when TZ=UTC now behaves consistently on all
	    Unix platforms.</p>
          <p>
	    The problem fixed was originally reported by Paul Guyot
	    on erlang-bugs mailing list:</p>
          <p>
	    http://www.erlang.org/pipermail/erlang-bugs/2008-November/001077.html</p>
          <p>
	    Own Id: OTP-8580</p>
        </li>
        <li>
          <p>
	    Optimization reducing memory consumption by two words per
	    ETS object.</p>
          <p>
	    Own Id: OTP-8737</p>
        </li>
        <li>
          <p>
	    Fixes for unsupported halfword-emulator</p>
          <p>
	    Own Id: OTP-8745</p>
        </li>
        <li>
          <p>
	    NIF 64-bit integer support; <span class="code">enif_get_int64</span>,
	    <span class="code">enif_get_uint64</span>, <span class="code">enif_make_int64</span>,
	    <span class="code">enif_make_uint64</span>.</p>
          <p>
	    Own Id: OTP-8746</p>
        </li>
        <li>
          <p>
	    Alignment of trailing data in messages has been adjusted.
	    This in order to be able to pass data of any type as
	    trailing data in the future.</p>
          <p>
	    Own Id: OTP-8754</p>
        </li>
        <li>
          <p>
	    The obsolete/driver.h header file has been removed. It
	    has been obsolete and deprecated since R8B. Drivers that
	    still include obsolete/driver.h must be updated to
	    include erl_driver.h.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8758</p>
        </li>
        <li>
          <p>
	    Added erlang:system_info(build_type) which makes it
	    easier to chose drivers, NIF libraries, etc based on
	    build type of the runtime system.</p>
          <p>
	    The NIF library for crypto can now be built for valgrind
	    and/or debug as separate NIF libraries that will be
	    automatically loaded if the runtime system has been built
	    with a matching build type.</p>
          <p>
	    Own Id: OTP-8760</p>
        </li>
        <li>
          <p>
	    Further lessened the memory requirements of ETS objects.</p>
          <p>
	    Own Id: OTP-8762</p>
        </li>
        <li>
	    <p>The broken elib_malloc alternate memory allocator has
	    been removed. <span class="code">erlang:system_info(elib_malloc)</span> will
	    always return <span class="code">false</span>, and in R15,
	    <span class="code">erlang:system_info(elib_malloc)</span> will fail with a
	    <span class="code">badarg</span> exception.</p>
          <p>
	    Own Id: OTP-8764</p>
        </li>
        <li>
          <p>
	    Calling <span class="code">erlang:system_info/1</span> with the new argument
	    <span class="code">update_cpu_info</span> will make the runtime system
	    reread and update the internally stored CPU information.
	    For more information see the documentation of <span class="bold_code"><a href="erlang.html#update_cpu_info">erlang:system_info(update_cpu_info)</a></span>.</p>
          <p>
	    The CPU topology is now automatically detected on Windows
	    systems with less than 33 logical processors. The runtime
	    system will now, also on Windows, by default bind
	    schedulers to logical processors using the
	    <span class="code">default_bind</span> bind type if the amount of schedulers
	    is at least equal to the amount of logical processors
	    configured, binding of schedulers is supported, and a CPU
	    topology is available at startup.</p>
          <p>
	    Own Id: OTP-8765</p>
        </li>
        <li>
          <p>
	    The SMP ERTS internal child waiter thread used on Linux
	    system with NPTL was unintentionally disabled during
	    cross compilation rewrites (OTP-8323 in R13B03). It has
	    now been re-enabled. Enabling it again gives a slight
	    performance improvement.</p>
          <p>
	    Own Id: OTP-8774</p>
        </li>
        <li>
          <p>
	    <span class="code">epmd</span> used to generate a message to the syslog when
	    it started up, which could be annoying. This has been
	    changed to only generate the message if the debug swith
	    is given. (Thanks to Michael Santos.)</p>
          <p>
	    Own Id: OTP-8775</p>
        </li>
        <li>
          <p>
	    The scheduler wakeup threshold is now possible to adjust
	    at system boot. For more information see the +swt command line argument of
	    <span class="code">erl</span>.</p>
          <p>
	    Own Id: OTP-8811</p>
        </li>
        <li>
          <p>
	    The undocumented function inet:ifget/2 has been improved
	    to return interface hardware address (MAC) on platforms
	    supporting getaddrinfo() (such as BSD unixes). Note it
	    still does not work on all platforms for example not
	    Windows nor Solaris, so the function is still
	    undocumented.</p>
          <p>
	    Buffer overflow and field init bugs for inet:ifget/2 and
	    inet:getservbyname/2 has also been fixed.</p>
          <p>
	    Thanks to Michael Santos.</p>
          <p>
	    Own Id: OTP-8816</p>
        </li>
        <li>
          <p>
	    Optimizations for MIPS when using gcc atomics. (Thanks to
	    Steve Vinoski)</p>
          <p>
	    Own Id: OTP-8834</p>
        </li>
        <li>
          <p>
	    Lock optimization in timer functionality.</p>
          <p>
	    Own Id: OTP-8835</p>
        </li>
      </ul>
    


    <h4>Known Bugs and Problems</h4>
      <ul>
        <li>
	    <p>Fix epmd and build environment to build on VxWorks</p>
          <p>
	    Own Id: OTP-8838</p>
        </li>
      </ul>
    



<h3><a name="id129226">1.11 
        Erts 5.8</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Driver threads, such as async threads, using port data locks
	    peeked at the port status field without proper locking
	    when looking up the driver queue.</p>
          <p>
	    Own Id: OTP-8475</p>
        </li>
        <li>
          <p>
	    The use of <span class="code">mmap()</span> was unnecessarily disabled when
	    cross compiling.</p>
          <p>
	    The <span class="code">configure</span> arguments <span class="code">--with-ssl</span>, and
	    <span class="code">--with-odbc</span> refused to accept libraries outside of
	    <span class="code">$erl_xcomp_sysroot</span> when cross compiling for no
	    good reason.</p>
          <p>
	    The <span class="code">configure</span> argument <span class="code">--with-odbc</span> didn't
	    handle the value <span class="code">yes</span> correct.</p>
          <p>
	    The <span class="code">configure</span> arguments <span class="code">--with-odbc</span>, and
	    <span class="code">--without-odbc</span> have also been added to the
	    configure help.</p>
          <p>
	    (Thanks to Steve Vinoski for reporting these issues)</p>
          <p>
	    Own Id: OTP-8484</p>
        </li>
        <li>
          <p>
	    A call to the BIF <span class="code">unregister(RegName)</span> when a port
	    had the name <span class="code">RegName</span> registered in the runtime
	    system without SMP support caused a runtime system crash.
	    (Thanks to Per Hedeland for the bugfix and test case.)</p>
          <p>
	    Own Id: OTP-8487</p>
        </li>
        <li>
          <p>
	    The runtime system crashed if fewer logical processors
	    were found than reported by <span class="code">sysconf(
	    SC_NPROCESSORS_CONF)</span>.</p>
          <p>
	    Own Id: OTP-8549</p>
        </li>
        <li>
          <p>
	    Fix memory management bug causing crash of non-SMP
	    emulator with async threads enabled. The bug did first
	    appear in R13B03.</p>
          <p>
	    Own Id: OTP-8591 Aux Id: seq11554 </p>
        </li>
        <li>
          <p>
	    Port locks could be prematurely destroyed.</p>
          <p>
	    Own Id: OTP-8612</p>
        </li>
        <li>
	    <p>The <span class="code">empd</span> program could loop and consume 100%
	    CPU time if an unexpected error ocurred in
	    <span class="code">listen()</span> or <span class="code">accept()</span>. Now <span class="code">epmd</span> will
	    terminate if a non-recoverable error occurs. (Thanks to
	    Michael Santos.)</p>
          <p>
	    Own Id: OTP-8618</p>
        </li>
        <li>
          <p>
	    When kernel poll has been enabled, a livelock could in
	    rare circumstances occur. Problem reported by Chetan
	    Ahuja, fix by Mikael Pettersson.</p>
          <p>
	    Own Id: OTP-8632</p>
        </li>
        <li>
          <p>
	    Windows: Closing port of program that stalled without
	    reading all data could deadlock scheduler thread.</p>
          <p>
	    Own Id: OTP-8641</p>
        </li>
        <li>
          <p>
	    On some combination of Montavista Linux on Cavium Octeon
	    processors, some socket-related system calls returned
	    other numbers than -1 for errors. This caused a core dump
	    in inet_drv.c. Now the code works around this problem.</p>
          <p>
	    Own Id: OTP-8654</p>
        </li>
        <li>
          <p>
	    Missing memory barriers in <span class="code">erts_poll()</span> could cause
	    the runtime system to hang indefinitely.</p>
          <p>
	    Own Id: OTP-8658</p>
        </li>
        <li>
          <p>
	    <span class="code">ethr_rwmutex_tryrlock()</span> acquired and refused to
	    acquire a lock with inverted logic. The lock was however
	    never acquired in a thread unsafe manner. (Thanks to JR
	    Zhang for noting this issue)</p>
          <p>
	    Own Id: OTP-8662</p>
        </li>
        <li>
          <p>
	    Extreme combinations of register/unregister in a highly
	    parallell SMP application could crash the VM. The error
	    is corrected.</p>
          <p>
	    Own Id: OTP-8663</p>
        </li>
        <li>
          <p>
	    On Windows, files are now opened with FILE_SHARE_DELETE
	    to get closer to Unix semantics.</p>
          <p>
	    Own Id: OTP-8667</p>
        </li>
        <li>
          <p>
	    <span class="code">erlang:system_info(multi_scheduling)</span> sometimes
	    erroneously returned <span class="code">enabled</span> when it should have
	    returned <span class="code">blocked</span>.</p>
          <p>
	    Own Id: OTP-8675</p>
        </li>
        <li>
          <p>
	    Fix bug causing <span class="code">erlang:decode_packet</span> and
	    <span class="code">enif_make_string</span> to generate faulty strings with
	    negative character values for ascii values larger than
	    127. (Thanks to Paul Guyot)</p>
          <p>
	    Own Id: OTP-8685</p>
        </li>
        <li>
          <p>
	    <span class="code">open_port/2</span> with the <span class="code">spawn</span> and
	    <span class="code">spawn_executable</span> options can include an
	    <span class="code">{env,Env}</span> option. In some cases unsetting
	    variables would not work on Unix (typically if more
	    variables were unset than were actually present in the
	    environment).</p>
          <p>
	    Own Id: OTP-8701</p>
        </li>
        <li>
          <p>
	    A user defined CPU topology set via a call to <span class="bold_code"><a href="erlang.html#system_flag_cpu_topology">erlang:system_flag(cpu_topology,
	    CPUTopology)</a></span> was not properly verified, and
	    could in worst case cause an emulator crash. The emulator
	    crash could only occur when a user defined CPU topology
	    already existed and was redefined.</p>
          <p>
	    Own Id: OTP-8710</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    The grammar for match specifications in ERTS users guide
	    only described the tracing dialect of match
	    specifications. An informal grammar for the ETS dialect
	    is added.</p>
          <p>
	    Own Id: OTP-8086 Aux Id: seq11333 </p>
        </li>
        <li>
          <p>
	    The module binary from EEP31 (and EEP9) is implemented.</p>
          <p>
	    Own Id: OTP-8217</p>
        </li>
        <li>
          <p>
	    New NIF API function <span class="code">enif_make_new_binary</span></p>
          <p>
	    Own Id: OTP-8474</p>
        </li>
        <li>
          <p>
	    The guard BIF <span class="code">is_boolean/1</span> (introduced in R10B)
	    has now been included in the lists of BIFs allowed in
	    guards in the Reference Manual.</p>
          <p>
	    Own Id: OTP-8477</p>
        </li>
        <li>
          <p>
	    Added function <span class="code">zip:foldl/3</span> to iterate over zip
	    archives.</p>
          <p>
	    Added functions to create and extract escripts. See
	    <span class="code">escript:create/2</span> and <span class="code">escript:extract/2</span>.</p>
          <p>
	    The undocumented function <span class="code">escript:foldl/3</span> has been
	    removed. The same functionality can be achieved with the
	    more flexible functions <span class="code">escript:extract/2</span> and
	    <span class="code">zip:foldl/3</span>.</p>
          <p>
	    Record fields has been annotated with type info. Source
	    files as been adapted to fit within 80 chars and trailing
	    whitespace has been removed.</p>
          <p>
	    Own Id: OTP-8521</p>
        </li>
        <li>
	    <p>A regular expression with many levels of parenthesis
	    could cause a buffer overflow. That has been corrected.
	    (Thanks to Michael Santos.)</p>
          <p>
	    Own Id: OTP-8539</p>
        </li>
        <li>
          <p>
	    <span class="code">erlang:decode_packet(httph_bin,..)</span> could return
	    corrupt header strings or even crash the VM. This has
	    been fixed. It only happened on 32-bit VM if the header
	    name was unknown and between 16 and 20 characters long.
	    Sockets with simular <span class="code">packet</span> option did not suffer
	    from this bug.</p>
          <p>
	    Own Id: OTP-8548</p>
        </li>
        <li>
	    <p>New NIF features:</p> <ul>
<li> Send messages from
	    a NIF, or from thread created by NIF, to any local
	    process (<span class="code">enif_send</span>) </li>
<li> Store terms
	    between NIF calls (<span class="code">enif_alloc_env</span>,
	    <span class="code">enif_make_copy</span>) </li>
<li> Create binary terms
	    with user defined memory management
	    (<span class="code">enif_make_resource_binary</span>) </li>
</ul> <p>And
	    some incompatible changes made to the API. For more
	    information see the warning text in <span class="bold_code"><a href="erl_nif.html">erl_nif(3)</a></span>.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8555</p>
        </li>
        <li>
	    <p>If the '<span class="code">fop</span>' program (needed for building PDF
	    files) cannot not be found, it is now possible to build
	    the HTML and man pages anyway (there will also be dummy
	    PDF files with no real content created). (Thanks to
	    Tuncer Ayaz.)</p>
          <p>
	    Own Id: OTP-8559</p>
        </li>
        <li>
	    <p>When defining macros the closing right parenthesis
	    before the dot is now mandatory.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8562</p>
        </li>
        <li>
	    <p>Local and imported functions now override the
	    auto-imported BIFs when the names clash. The pre R14
	    behaviour was that auto-imported BIFs would override
	    local functions. To avoid that old programs change
	    behaviour, the following will generate an error:</p>
	    <ul>
<li><p>Doing a call without explicit module name
	    to a local function having a name clashing with the name
	    of an auto-imported BIF that was present (and
	    auto-imported) before OTP R14A</p></li>
	    <li><p>Explicitly importing a function having a name
	    clashing with the name of an autoimported BIF that was
	    present (and autoimported) before OTP R14A</p></li>
	    <li><p>Using any form of the old compiler directive
	    <span class="code">nowarn_bif_clash</span></p></li> </ul> <p>If the BIF
	    was added or auto-imported in OTP R14A or later,
	    overriding it with an import or a local function will
	    only result in a warning,</p> <p>To resolve clashes, you
	    can either use the explicit module name <span class="code">erlang</span> to
	    call the BIF, or you can remove the auto-import of that
	    specific BIF by using the new compiler directive
	    <span class="code">-compile({no_auto_import,[F/A]}).</span>, which makes all
	    calls to the local or imported function without explicit
	    module name pass without warnings or errors.</p> <p>The
	    change makes it possible to add auto-imported BIFs
	    without breaking or silently changing old code in the
	    future. However some current code ingeniously utilizing
	    the old behaviour or the <span class="code">nowarn_bif_clash</span> compiler
	    directive, might need changing to be accepted by the
	    compiler.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8579</p>
        </li>
        <li>
          <p>
	    A bug in re that could cause certain regular expression
	    matches never to terminate is corrected. (Thanks to
	    Michael Santos and Gordon Guthrie.)</p>
          <p>
	    Own Id: OTP-8589</p>
        </li>
        <li>
	    <p>The erlang:open_port spawn and spawn_executable
	    directives can include an <span class="code">{env,Env}</span> directive to
	    set up environment variables for the spawned process. A
	    bug prevented applications from using <span class="code">{env,Env}</span> to
	    set an environment variable whose value ended with a
	    '<span class="code">=</span>' (equal sign) character; the trailing equal
	    sign was mistaken as an indication that an environment
	    variable was to be cleared from the environment of the
	    spawned process. (Thanks to Steve Vinoski.)</p>
          <p>
	    Own Id: OTP-8614</p>
        </li>
        <li>
	    <p><span class="code">receive</span> statements that can only read out a
	    newly created reference are now specially optimized so
	    that it will execute in constant time regardless of the
	    number of messages in the receive queue for the process.
	    That optimization will benefit calls to
	    <span class="code">gen_server:call()</span>. (See <span class="code">gen:do_call/4</span> for
	    an example of a receive statement that will be
	    optimized.)</p>
          <p>
	    Own Id: OTP-8623</p>
        </li>
        <li>
          <p>
	    The functions file:advise/4 and file:datasync/1 have been
	    added. (Thanks to Filipe David Manana.)</p>
          <p>
	    Own Id: OTP-8637</p>
        </li>
        <li>
          <p>
	    New NIF API functions: <span class="code">enif_make_atom_len</span>,
	    <span class="code">enif_make_existing_atom_len</span>,
	    <span class="code">enif_make_string_len</span>, <span class="code">enif_get_atom_length</span>,
	    <span class="code">enif_get_list_length</span>, <span class="code">enif_is_list</span>,
	    <span class="code">enif_is_tuple</span> (by Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-8640</p>
        </li>
        <li>
          <p>
	    Support for using gcc's built-in functions for atomic
	    memory access has been added. This functionallity will be
	    used if available and no other native atomic
	    implementation in ERTS is available.</p>
          <p>
	    Own Id: OTP-8659</p>
        </li>
        <li>
          <p>
	    The number of spinlocks used when implementing atomic
	    fall-backs when no native atomic implementation is
	    available has been increased from 16 to 1024.</p>
          <p>
	    Own Id: OTP-8660</p>
        </li>
        <li>
          <p>
	    Writer preferred pthread read/write locks has been
	    enabled on Linux.</p>
          <p>
	    Own Id: OTP-8661</p>
        </li>
        <li>
          <p>
	    The runtime system will by default bind schedulers to
	    logical processors using the <span class="code">default_bind</span> bind
	    type if the amount of schedulers are at least equal to
	    the amount of logical processors configured, binding of
	    schedulers is supported, and a CPU topology is available
	    at startup. </p>
          <p>
	    <strong>NOTE:</strong> If the Erlang runtime system is the only
	    operating system process that binds threads to logical
	    processors, this improves the performance of the runtime
	    system. However, if other operating system processes (as
	    for example another Erlang runtime system) also bind
	    threads to logical processors, there might be a
	    performance penalty instead. If this is the case you, are
	    are advised to unbind the schedulers using the +sbtu command line argument,
	    or by invoking <span class="bold_code"><a href="erlang.html#system_flag_scheduler_bind_type">erlang:system_flag(scheduler_bind_type,
	    unbound)</a></span>.</p>
          <p>
	    Own Id: OTP-8666</p>
        </li>
        <li>
          <p>
	    The recently added BIFs erlang:min/2, erlang:max/2 and
	    erlang:port_command/3 are now auto-imported (as they were
	    originally intended to be). Due to the recent compiler
	    change (OTP-8579), the only impact on old code defining
	    it's own min/2, max/2 or port_command/3 functions will be
	    a warning, the local functions will still be used. The
	    warning can be removed by using
	    -compile({no_auto_import,[min/2,max/2,port_command/3]}).
	    in the source file.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8669 Aux Id: OTP-8579 </p>
        </li>
        <li>
          <p>
	    There is a new option 'exclusive' to file:open/2 that
	    uses the OS O_EXCL flag where supported to open the file
	    in exclusive mode.</p>
          <p>
	    Own Id: OTP-8670</p>
        </li>
        <li>
          <p>
	    Now, binary_to_term/2 is auto-imported. This will cause a
	    compile warning if and only if a module has got a local
	    function with that name.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8671</p>
        </li>
        <li>
          <p>
	    Alignment of scheduler data and run queues were adjusted.</p>
          <p>
	    Own Id: OTP-8673</p>
        </li>
        <li>
	    <p>Call time breakpoint tracing</p> <ul>
<li>Introduce
	    a <span class="code">call_time</span> option to
	    <span class="code">erlang:trace_pattern/3</span>.This option enables call
	    time breakpoint tracing on code that is executed by
	    processes with call tracing enabled. Call time tracing
	    stores the number of calls and the time spent of each
	    function with this trace pattern enabled. The information
	    can be retrieved with <span class="code">erlang:trace_info/2</span>
</li>
	    <li>Add a scheduler array for BpData. To solve the
	    issue of multiple schedulers constantly updating the head
	    pointer to the bp data wheel, each scheduler now has its
	    own entrypoint to the wheel. This head pointer can be
	    updated without a locking being taken.</li>
</ul>
	    <p>Teach call count tracing to use atomics</p>
	    <ul>
<li>Call count previously used a global lock for
	    accessing and writing its counter in the breakpoint. This
	    is now changed to atomics instead.</li> <li>The
	    change will let call count tracing and cprof to scale
	    better when increasing the number of
	    schedulers.</li>
</ul>
          <p>
	    Own Id: OTP-8677</p>
        </li>
        <li>
	    <p><span class="code">eprof</span> has been reimplemented with support in
	    the Erlang virtual machine and is now both faster (i.e.
	    slows down the code being measured less) and scales much
	    better. In measurements we saw speed-ups compared to the
	    old eprof ranging from 6 times (for sequential code that
	    only uses one scheduler/core) up to 84 times (for
	    parallel code that uses 8 cores).</p>
	    <p>Note: The API for the <span class="code">eprof</span> has been cleaned up
	    and extended. See the documentation.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8706</p>
        </li>
      </ul>
    



<h3><a name="id130234">1.12 
        Erts 5.7.5.2</a></h3>

    <h4>Known Bugs and Problems</h4>
      <ul>
        <li>
          <p>
	    Two bugs in gen_sctp has been corrected: getopts/setopts
	    hence also send could only be called from socket owner,
	    and options 'linger', 'rcvbuf' and 'sndbuf' was read from
	    wrong protocol layer hence read wrong values by getopts.</p>
          <p>
	    Own Id: OTP-9544</p>
        </li>
      </ul>
    



<h3><a name="id130266">1.13 
        Erts 5.7.5.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
            Driver threads, such as async threads, using port data locks
            peeked at the port status field without proper locking
            when looking up the driver queue.</p>
          <p>
            Own Id: OTP-8475</p>
        </li>
        <li>
          <p>
            A call to the BIF <span class="code">unregister(RegName)</span> when a port
            had the name <span class="code">RegName</span> registered in the runtime
            system without SMP support caused a runtime system crash.
            (Thanks to Per Hedeland for the bugfix and test case.)</p>
          <p>
            Own Id: OTP-8487</p>
        </li>
        <li>
          <p>
            Fix memory management bug causing crash of non-SMP
            emulator with async threads enabled. The bug did first
            appear in R13B03.</p>
          <p>
            Own Id: OTP-8591 Aux Id: seq11554 </p>
        </li>
      </ul>
    



<h3><a name="id130336">1.14 
        Erts 5.7.5</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Fix <span class="code">binary_to_term</span> crash on compressed term with
	    corrupt size field.</p>
          <p>
	    Own Id: OTP-8336</p>
        </li>
        <li>
          <p>
	    Processes and/or ports could get stuck on a blocked
	    scheduler when <span class="code">erlang:system_flag(multi_scheduling,
	    block)</span> was used.</p>
          <p>
	    Processes and/or ports could get stuck on an offline
	    scheduler when schedulers online were reduced using
	    <span class="code">erlang:system_flag(schedulers_online,
	    SchedulersOnline)</span>.</p>
          <p>
	    Own Id: OTP-8342</p>
        </li>
        <li>
	    <p>Building on Windows will now work if the paths to
	    <span class="code">mc.exe</span> and <span class="code">rc.exe</span> contain spaces. The
	    README.win32 file has been updated with some information
	    about building using Visual Studio 2008. (Thanks to
	    Andrew Thompson.)</p>
          <p>
	    Own Id: OTP-8345</p>
        </li>
        <li>
          <p>
	    EPMD now correctly handles the extra data field which can
	    be given in the ALIVE2_REQ request and retrieved in the
	    PORT2_RESP response. (Thanks to Klas Johansson.)</p>
          <p>
	    Own Id: OTP-8361</p>
        </li>
        <li>
          <p>
	    The configure test for reliable floating point exceptions
	    has been update to work on modern versions of Mac OS X.
	    (Thanks to Trannie Carter.)</p>
          <p>
	    Own Id: OTP-8368</p>
        </li>
        <li>
          <p>
	    ERTS makefiles used to detect the use of a gcc C compiler
	    by checking if CC equaled gcc. That is, the makefiles
	    failed to detect gcc C compilers with other command line
	    names than gcc. `configure' now substitute GCC into the
	    makefiles. If CC is a gcc C compiler, GCC will have the
	    value yes. (Thanks to Jean-Sébastien Pédron)</p>
          <p>
	    Own Id: OTP-8373</p>
        </li>
        <li>
          <p>
	    ETS bug causing the <span class="code">memory</span> counter from
	    <span class="code">ets:info</span> for ordered_set's to sometimes get out of
	    synch and absurdly high.</p>
          <p>
	    Own Id: OTP-8377 Aux Id: seq11442 </p>
        </li>
        <li>
          <p>
	    Immediately repeated multi-scheduling block/unblock
	    cycles using <span class="code">erlang:system_flag(multi_scheduling,
	    block | unblock)</span> could deadlock the runtime system.</p>
          <p>
	    Own Id: OTP-8386</p>
        </li>
        <li>
	    <p>A number of bugs concerning re and unicode are
	    corrected:</p>
	    <p>re:compile no longer loses unicode option, which also
	    fixes bug in re:split.</p>
	    <p>re:replace now handles unicode charlist replacement
	    argument</p>
	    <p>re:replace now handles unicode RE charlist argument
	    correctly</p>
	    <p>re:replace now handles binary unicode output correctly
	    when nothing is replaced.</p>
	    <p>Most code, testcases and error isolation done by Rory
	    Byrne.</p>
          <p>
	    Own Id: OTP-8394</p>
        </li>
        <li>
          <p>
	    The loading of native code was not properly atomic in the
	    SMP emulator, which could cause crashes. Also a per-MFA
	    information table for the native code has now been
	    protected with a lock since it turns that it could be
	    accessed concurrently in the SMP emulator. (Thanks to
	    Mikael Pettersson.)</p>
          <p>
	    Own Id: OTP-8397</p>
        </li>
        <li>
          <p>
	    Fix processes in exiting status that are about to be
	    scheduled, to not be allowed to garbage collect.</p>
          <p>
	    Own Id: OTP-8420</p>
        </li>
        <li>
	    <p>Removed bogus "\011" character sequence in
	    documentation.</p>
          <p>
	    Own Id: OTP-8422</p>
        </li>
        <li>
          <p>
	    The resolver routines failed to look up the own node name
	    as hostname, if the OS native resolver was erroneously
	    configured, bug reported by Yogish Baliga, now fixed.</p>
          <p>
	    The resolver routines now tries to parse the hostname as
	    an IP string as most OS resolvers do, unless the native
	    resolver is used.</p>
          <p>
	    The DNS resolver inet_res and file resolver inet_hosts
	    now do not read OS configuration files until they are
	    needed. Since the native resolver is default, in most
	    cases they are never needed.</p>
          <p>
	    The DNS resolver's automatic updating of OS configuration
	    file data (/etc/resolv.conf) now uses the 'domain'
	    keyword as default search domain if there is no 'search'
	    keyword.</p>
          <p>
	    Own Id: OTP-8426 Aux Id: OTP-8381 </p>
        </li>
        <li>
          <p>
	    The re module: A regular expression with an option change
	    at the start of a pattern that had top-level alternatives
	    could cause overwriting and/or a crash. (Thanks to
	    Michael Santos.)</p>
          <p>
	    Own Id: OTP-8438</p>
        </li>
        <li>
          <p>
	    Harmless buffer overflow by one byte in asn1 and
	    ram_file_drv.</p>
          <p>
	    Own Id: OTP-8451</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    Improved GC performance after BIF/NIF call when a lot of
	    heap fragments was created. This will mainly benefit NIFs
	    that return large compound terms.</p>
          <p>
	    Own Id: OTP-8240</p>
        </li>
        <li>
	    <p>Incompatible changes in the experimental NIF
	    feature.</p> <ul>
<li> Changed the NIF function
	    prototypes in order to allow more than 3 function
	    arguments. </li>
<li> <span class="code">enif_get_data</span> renamed as
	    <span class="code">enif_priv_data</span>. </li>
<li>
	    <span class="code">enif_make_string</span> got a third argument for
	    character encoding. </li>
<li> The return value of
	    <span class="code">erlang:load_nif/2</span> on error changed. </li>
</ul>
	    <p>Read more in the documentation of <span class="code">erl_nif</span> and
	    <span class="code">erlang:load_nif/2</span></p>.
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8304</p>
        </li>
        <li>
	    <p>Cross compilation improvements and other build system
	    improvements.</p>
	    <p>Most notable:</p> <ul>
<li> Lots of cross
	    compilation improvements. The old cross compilation
	    support was more or less non-existing as well as broken.
	    Please, note that the cross compilation support should
	    still be considered as experimental. Also note that old
	    cross compilation configurations cannot be used without
	    modifications. For more information on cross compiling
	    Erlang/OTP see the <span class="code">$ERL_TOP/INSTALL-CROSS.md</span> file.
	    </li>
<li> Support for staged install using <span class="bold_code"><a href="http://www.gnu.org/prep/standards/html_node/DESTDIR.html">DESTDIR</a></span>.
	    The old broken <span class="code">INSTALL_PREFIX</span> has also been fixed.
	    For more information see the <span class="code">$ERL_TOP/INSTALL.md</span>
	    file. </li>
<li> Documentation of the <span class="code">release</span>
	    target of the top <span class="code">Makefile</span>. For more information
	    see the <span class="code">$ERL_TOP/INSTALL.md</span> file. </li>
<li>
	    <span class="code">make install</span> now by default creates relative
	    symbolic links instead of absolute ones. For more
	    information see the <span class="code">$ERL_TOP/INSTALL.md</span> file.
	    </li>
<li> <span class="code">$ERL_TOP/configure --help=recursive</span>
	    now works and prints help for all applications with
	    <span class="code">configure</span> scripts. </li>
<li> Doing <span class="code">make
	    install</span>, or <span class="code">make release</span> directly after
	    <span class="code">make all</span> no longer triggers miscellaneous
	    rebuilds. </li>
<li> Existing bootstrap system is now
	    used when doing <span class="code">make install</span>, or <span class="code">make
	    release</span> without a preceding <span class="code">make all</span>.
	    </li>
<li> The <span class="code">crypto</span> and <span class="code">ssl</span>
	    applications use the same runtime library path when
	    dynamically linking against <span class="code">libssl.so</span> and
	    <span class="code">libcrypto.so</span>. The runtime library search path has
	    also been extended. </li>
<li> The <span class="code">configure</span>
	    scripts of <span class="code">erl_interface</span> and <span class="code">odbc</span> now
	    search for thread libraries and thread library quirks the
	    same way as <span class="code">erts</span> do. </li>
<li> The
	    <span class="code">configure</span> script of the <span class="code">odbc</span> application
	    now also looks for odbc libraries in <span class="code">lib64</span> and
	    <span class="code">lib/64</span> directories when building on a 64-bit
	    system. </li>
<li> The <span class="code">config.h.in</span> file in the
	    <span class="code">erl_interface</span> application is now automatically
	    generated in instead of statically updated which reduces
	    the risk of <span class="code">configure</span> tests without any effect.
	    </li>
</ul>
	    <p>(Thanks to Henrik Riomar for suggestions and
	    testing)</p>
	    <p>(Thanks to Winston Smith for the AVR32-Linux cross
	    configuration and testing)</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-8323</p>
        </li>
        <li>
	    <p>NIF improvements:</p> <ul>
<li> Driver API for
	    multi-threading made available for NIFs. </li>
<li>
	    Support for mempory managed (garbage collected) resource
	    objects. A way to pass "pointers" to native data
	    structures between C and Erlang in a safe way.
	    </li>
<li> Support for references, floats and term
	    comparison. </li>
<li> Various new functions, like
	    <span class="code">enif_inspect_iolist_as_binary</span>,
	    <span class="code">enif_make_sub_binary</span>, <span class="code">enif_get_string</span>,
	    <span class="code">enif_get_atom</span>, <span class="code">enif_make_tuple_from_array</span>,
	    <span class="code">enif_make_list_from_array</span>,
	    <span class="code">enif_make_existing_atom</span>. </li>
</ul>
          <p>
	    Own Id: OTP-8335</p>
        </li>
        <li>
          <p>
	    Minor alignment adjustments of scheduler specific data.</p>
          <p>
	    Own Id: OTP-8341</p>
        </li>
        <li>
	    <p>The documentation is now possible to build in an open
	    source environment after a number of bugs are fixed and
	    some features are added in the documentation build
	    process. </p>
	    <p>- The arity calculation is updated.</p>
	    <p>- The module prefix used in the function names for
	    bif's are removed in the generated links so the links
	    will look like
	    "http://www.erlang.org/doc/man/erlang.html#append_element-2"
	    instead of
	    "http://www.erlang.org/doc/man/erlang.html#erlang:append_element-2".</p>
	    <p>- Enhanced the menu positioning in the html
	    documentation when a new page is loaded.</p>
	    <p>- A number of corrections in the generation of man
	    pages (thanks to Sergei Golovan)</p>
	    <p>- The legal notice is taken from the xml book file so
	    OTP's build process can be used for non OTP
	    applications.</p>
          <p>
	    Own Id: OTP-8343</p>
        </li>
        <li>
          <p>
	    There is new <span class="code">erlang:binary_to_term/2</span> BIF that
	    takes an option list. The option <span class="code">safe</span> can be used
	    to prevent creation of resources that are not garbage
	    collected (such as atoms). (Thanks to Jayson Vantuyl.)</p>
          <p>
	    Own Id: OTP-8367</p>
        </li>
        <li>
          <p>
	    The default settings for garbage collection of binaries
	    has been adjusted to be less aggressive than in R13B03.
	    It is now also possible configure the settings for binary
	    GC. See the documentation for <span class="code">spawn_opt/2-5</span>,
	    <span class="code">erlang:system_info/1</span>, <span class="code">erlang:system_flag/2</span>,
	    <span class="code">process_flag/2-3</span>, <span class="code">erlang:trace/3</span>, and the
	    documenation for <span class="code">erl</span> for the new command line
	    options <span class="code">+hms</span> and <span class="code">+hmbs</span>.</p>
          <p>
	    Own Id: OTP-8370</p>
        </li>
        <li>
          <p>
	    A bug causing memory corruption in re:run() has been
	    corrected. (Thanks to Yamashina Hio.)</p>
          <p>
	    Own Id: OTP-8375</p>
        </li>
        <li>
          <p>
	    The <span class="code">-Werror</span> option for <span class="code">erlc</span> and the
	    compiler option <span class="code">warnings_as_errors</span> will cause
	    warnings to be treated as errors. (Thanks to Christopher
	    Faulet.)</p>
          <p>
	    Own Id: OTP-8382</p>
        </li>
        <li>
          <p>
	    Explicit top directories in archive files are now
	    optional.</p>
          <p>
	    For example, if an archive (app-vsn.ez) just contains an
	    app-vsn/ebin/mod.beam file, the file info for the app-vsn
	    and app-vsn/ebin directories are faked using the file
	    info from the archive file as origin. The virtual
	    direcories can also be listed. For short, the top
	    directories are virtual if they does not exist.</p>
          <p>
	    Own Id: OTP-8387</p>
        </li>
        <li>
          <p>
	    An unnecessary lock operation in os:timestamp/0 has been
	    eliminated, making it slightly more efficient. (Thanks to
	    Jonas Falkevik and Tuncer Ayaz.)</p>
          <p>
	    Own Id: OTP-8390</p>
        </li>
        <li>
          <p>
	    There is a new <span class="code">+t</span> emulator option for changing the
	    maximum number of atoms. (Thanks to Julien Barbot.)</p>
          <p>
	    Own Id: OTP-8405</p>
        </li>
        <li>
          <p>
	    Fixed numerous compiler warnings generated by gcc 4.4.1
	    and tile-cc 2.0.1.78377 when compiling the runtime
	    system.</p>
          <p>
	    Own Id: OTP-8412</p>
        </li>
        <li>
          <p>
	    <span class="code">configure</span> learned the option
	    <span class="code">--enable-m32-build</span> to force the building of a
	    32-bit run-time on systems where the default C compiler
	    generates 64-bit executables by default.</p>
          <p>
	    Own Id: OTP-8415</p>
        </li>
        <li>
          <p>
	    HiPE now works in the 64-bit emulator on Mac OS X.
	    (Thanks to Geoff Cant.)</p>
          <p>
	    Own Id: OTP-8416</p>
        </li>
        <li>
          <p>
	    Improved handling of symbolic links to escripts</p>
          <p>
	    Own Id: OTP-8417</p>
        </li>
        <li>
          <p>
	    Add lock profiling tool.</p>
          <p>
	    The Lock profiling tool, lcnt, can make use of the
	    internal lock statistics when the runtime system is built
	    with this feature enabled.</p>
          <p>
	    This provides a mechanism to examine potential lock
	    bottlenecks within the runtime itself.</p>
          <p>
	    - Add erts_debug:lock_counters({copy_save, bool()}). This
	    option enables or disables statistics saving for
	    destroyed processes and ets-tables. Enabling this might
	    consume a lot of memory.</p>
          <p>
	    - Add id-numbering for lock classes which is otherwise
	    undefined.</p>
          <p>
	    Own Id: OTP-8424</p>
        </li>
        <li>
          <p>
	    Removed spurious options to the emulator from escript.</p>
          <p>
	    Own Id: OTP-8427</p>
        </li>
        <li>
          <p>
	    Minor documentation fixes. Mainly anchor adjustments.</p>
          <p>
	    Own Id: OTP-8457</p>
        </li>
      </ul>
    



<h3><a name="id98798">1.15 
        Erts 5.7.4</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    An insufficient stack allocation was made when reading
	    CPU information on BSD operating systems. (Thanks Michael
	    Turner and Akira Kitada)</p>
          <p>
	    Own Id: OTP-8207</p>
        </li>
        <li>
          <p>
	    A bug when supplying an argument without a dash directly
	    after the program name when starting erlang could prevent
	    distribution to start. This is now corrected.</p>
          <p>
	    Own Id: OTP-8209</p>
        </li>
        <li>
          <p>
	    A ticker process could potentially be blocked
	    indefinitely trying to send a tick to a node not
	    responding. If this happened, the connection would not be
	    brought down as it should.</p>
          <p>
	    Own Id: OTP-8218</p>
        </li>
        <li>
          <p>
	    Using certain firewalls (i.e. MS IAS Client and certain
	    versions of COMODO) could expose an undocumented
	    behaviour in the Win32 socket interface causing the name
	    resolution calls to hang infinitely. This is now worked
	    around by adding possibilities for port programs under
	    Windows to use overlapped I/O on their standard
	    input/output file handles.</p>
          <p>
	    Own Id: OTP-8230</p>
        </li>
        <li>
          <p>
	    Fixed bug on ETS tables with <span class="code">write_concurrency</span>.
	    The emulator could crash when doing a <span class="code">select</span> or
	    <span class="code">match</span> with a bound key without finding any object.</p>
          <p>
	    Own Id: OTP-8242</p>
        </li>
        <li>
	    <p>The <span class="code">information-request</span> /
	    <span class="code">information-response</span>, and
	    <span class="code">group-leader-change-request</span> /
	    <span class="code">group-leader-changed-response</span> signal pairs
	    described below did not always adhere to the signal order
	    guarantees of Erlang's signal model in the runtime system
	    with SMP support. These signals could for example
	    sometimes pass exit signals.</p>
	    <p>The following BIFs behaviors can be modeled as if an
	    asynchronous <span class="code">information-request</span> signal is sent to
	    <span class="code">Pid</span>. If <span class="code">Pid</span> is alive, it responds with an
	    asynchronous <span class="code">information-response</span> signal;
	    otherwise, the runtime system responds with a
	    <span class="code">no-such-process</span> signal. When the response is
	    received, the caller transforms it into the result of the
	    BIF.</p> <ul> <li><span class="code">is_process_alive(Pid)</span></li>
	    <li><span class="code">erlang:process_display(Pid, Type)</span></li>
	    <li><span class="code">process_info(Pid)</span></li>
	    <li><span class="code">process_info(Pid, ItemSpec)</span></li> </ul>
	    <p>When <span class="code">Pid</span> resides on the same node as the caller
	    of <span class="code">group_leader(GroupLeader, Pid)</span>, the
	    <span class="code">group_leader/2</span> BIFs behavior can be modeled as if
	    an asynchronous <span class="code">group-leader-change-request</span> signal
	    is sent to <span class="code">Pid</span>. If <span class="code">Pid</span> is alive, it
	    responds with an asynchronous
	    <span class="code">group-leader-changed-response</span> signal; otherwise,
	    the runtime system responds with a <span class="code">no-such-process</span>
	    signal. When the response is received, the caller
	    transforms it into the result of the BIF. The distributed
	    case which only consists of an asynchronous
	    <span class="code">group-leader-change-request</span> signal and no response
	    is not effected.</p>
          <p>
	    Own Id: OTP-8245</p>
        </li>
        <li>
          <p>
	    Errors in the <span class="code">system_profile</span> documentation has
	    been corrected.</p>
          <p>
	    Own Id: OTP-8257</p>
        </li>
        <li>
          <p>
	    Low watermark socket option modified high watermark
	    instead of low watermark in the inet_driver. (Thanks to
	    Feng Yu and Tuncer Ayaz)</p>
          <p>
	    Own Id: OTP-8279</p>
        </li>
        <li>
          <p>
	    A race condition could cause the runtime system with SMP
	    support to end up in a completely unresponsive state.</p>
          <p>
	    Own Id: OTP-8297</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    The use of <span class="code">pthread_cond_timedwait()</span> have been
	    completely removed from the runtime system. This since
	    its behavior is unpredictable when the system clock is
	    suddenly changed. The previous use of it was harmless.</p>
          <p>
	    Own Id: OTP-8193</p>
        </li>
        <li>
          <p>
	    The documentation is now built with open source tools
	    (xsltproc and fop) that exists on most platforms. One
	    visible change is that the frames are removed.</p>
          <p>
	    Own Id: OTP-8201</p>
        </li>
        <li>
          <p>
	    A new garbage collecting strategy for binaries which is
	    more aggressive than the previous implementation.
	    Binaries now has a virtual binary heap tied to each
	    process. When binaries are created or received to a
	    process it will check if the heap limit has been reached
	    and if a reclaim should be done. This imitates the
	    behavior of ordinary Erlang terms. The virtual heaps are
	    grown and shrunk like ordinary heaps. This will lessen
	    the memory footprint of binaries in a system.</p>
          <p>
	    Own Id: OTP-8202</p>
        </li>
        <li>
          <p>
	    The <span class="code">ErlDrvTermData</span> term types used by
	    <span class="code">driver_output_term()</span> and <span class="code">driver_send_term()</span>
	    have been extended with the term types
	    <span class="code">ERL_DRV_INT64</span>, and <span class="code">ERL_DRV_UINT64</span> for
	    passing 64-bit integers. Also the 64-bit integer data
	    types <span class="code">ErlDrvSInt64</span> and <span class="code">ErlDrvUInt64</span> have
	    been introduced.</p>
          <p>
	    For more information see the <span class="bold_code"><a href="erl_driver.html">erl_driver(3)</a></span>
	    documentation.</p>
          <p>
	    Own Id: OTP-8205</p>
        </li>
        <li>
          <p>
	    [escript] The restriction that the first line in escripts
	    must begin with <span class="code">#!</span> has been removed.</p>
          <p>
	    [escript] Some command line options to the escript
	    executable has now been documented. For example you can
	    run an escript in the debugger by just adding a command
	    line option.</p>
          <p>
	    [escript] The documentation of the escript header syntax
	    has been clarified. For example the header is optional.
	    This means that it is possible to directly "execute"
	    <span class="code">.erl</span>, <span class="code">.beam</span> and<span class="code">.zip</span> files.</p>
          <p>
	    Own Id: OTP-8215</p>
        </li>
        <li>
          <p>
	    The instruction for building OTP on Windows was outdated
	    and incomplete, the document is updated.</p>
          <p>
	    Also the otp_build script required windows drives to show
	    up in Cygwin using the /cygdrive prefix. That requirement
	    is now removed.</p>
          <p>
	    Own Id: OTP-8219</p>
        </li>
        <li>
          <p>
	    A module can have native implemented functions (NIFs)
	    that are dynamically loaded by calling
	    <span class="code">erlang:load_nif/2</span>. This is an experimental feature
	    that is not yet intended for production systems. It is
	    released with intention to get some early feedback on the
	    interfaces before they are carved in stone.</p>
          <p>
	    Own Id: OTP-8220</p>
        </li>
        <li>
          <p>
	    The <span class="code">float/1</span> BIF would always force a garbage
	    collection. The BIFs <span class="code">size/1</span>, <span class="code">byte_size/1</span>,
	    <span class="code">bit_size/1</span>, <span class="code">abs/1</span>, and <span class="code">round/1</span> would
	    force a garbage-collection if the result was not a
	    sufficiently small integer.</p>
          <p>
	    Own Id: OTP-8221</p>
        </li>
        <li>
          <p>
	    The <span class="bold_code"><a href="erlang.html#port_command-3">erlang:port_command/3</a></span>
	    BIF has been added. <span class="code">erlang:port_command/3</span> is
	    currently not auto imported, but it is planned to be auto
	    imported in OTP R14. For more information see the
	    <span class="bold_code"><a href="erlang.html">erlang(3)</a></span>
	    documentation.</p>
          <p>
	    Own Id: OTP-8225</p>
        </li>
        <li>
          <p>
	    '<span class="code">configure --enable-darwin-64bit</span>' would fail if
	    Snow Leopard had been booted with the 64-bit kernel.
	    (Thanks to Ryan M. Graham.)</p>
          <p>
	    Own Id: OTP-8236</p>
        </li>
      </ul>
    



<h3><a name="id99304">1.16 
        Erts 5.7.3</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    On Windows, open_port({spawn,Command},Opts) could not run
	    executables with spaces in the path or filename,
	    regardless of quoting efforts. While
	    open_port({spawn_executable,Exec},Opts) can run any
	    executable, it was still impossible to use 'spawn' to do
	    the same thing. This is now corrected.</p>
          <p>
	    Own Id: OTP-8055</p>
        </li>
        <li>
          <p>
	    The scheduler bind type <span class="code">processor_spread</span> spread
	    schedulers too much on large NUMA systems.</p>
          <p>
	    The new scheduler bind type <span class="code">spread</span> spreads
	    schedulers as much as possible, and behaves as
	    <span class="code">processor_spread</span> previously did. For more
	    information see the documentation of the <span class="code">+sbt</span>
	    command line argument in the <span class="code">erl(1)</span> documentation,
	    and the documentation of
	    <span class="code">erlang:system_flag(scheduler_bind_type,
	    SchedulerBindType)</span>.</p>
          <p>
	    Own Id: OTP-8063</p>
        </li>
        <li>
          <p>
	    Automatically detected CPU topology on Linux system could
	    erroneously contain logical processors with <span class="code">-1</span> as
	    identifiers. This happened when
	    <span class="code">sysconf(_SC_NPROCESSORS_CONF)</span> returned a value
	    larger than the amount of logical processors found.</p>
          <p>
	    Own Id: OTP-8064</p>
        </li>
        <li>
          <p>
	    When the minimal term [] (end of list) was sent as the
	    complete message to a process on another node, and
	    received there, it could not be decoded. This bug is now
	    corrected. Fortunately [] is uncommon as the complete
	    message in real applications but it is a serious bug
	    anyway.</p>
          <p>
	    Own Id: OTP-8092</p>
        </li>
        <li>
	    <p>A bug when the floating point exception pointer was
	    not initialized has been corrected. It manifested itself
	    on CentOS 5.1 sometimes when a floating point value was
	    sent to a remote node. Bug reported and patch suggested
	    by David Reiss, confirmed by Mikael Pettersson.</p>
	    <p>Some build problems on IRIX was also corrected.
	    Problem reported by Patrick Baggett, patch by Mikael
	    Pettersson.</p>
          <p>
	    Own Id: OTP-8095</p>
        </li>
        <li>
          <p>
	    A terminating process could erroneously unregister a name
	    for another process. This could occur under the following
	    conditions: The name of the terminating process was
	    unregistered and then registered for another process
	    simultaneously as the process that first had the name was
	    terminating.</p>
          <p>
	    Own Id: OTP-8099 Aux Id: seq11344 </p>
        </li>
        <li>
          <p>
	    Running erlc in a very deep directory (with a path length
	    of more 256 or more characters) would cause the emulator
	    to crash in a call to <span class="code">list_to_atom/1</span>. (Thanks to
	    Chris Newcombe.)</p>
          <p>
	    Own Id: OTP-8124</p>
        </li>
        <li>
          <p>
	    A deadlock of the runtime system could occur when
	    unregistering the name of a port.</p>
          <p>
	    Own Id: OTP-8145</p>
        </li>
        <li>
          <p>
	    <span class="code">Makefile.in</span> has been updated to use the LDFLAGS
	    environment variable (if set). (Thanks to Davide
	    Pesavento.)</p>
          <p>
	    Own Id: OTP-8157</p>
        </li>
        <li>
          <p>
	    The pthread rwlock implemention on Linux could cause
	    starvation of writers. We, therefore, now use our own
	    rwlock implementation on Linux.</p>
          <p>
	    Own Id: OTP-8158</p>
        </li>
        <li>
          <p>
	    Open source Erlang builds are updated to work well on
	    Snow Leopard (MacOS X 10.6)</p>
          <p>
	    Own Id: OTP-8168</p>
        </li>
        <li>
          <p>
	    A call to <span class="code">erlang:system_info(schedulers_online)</span>
	    could end up in an infinite loop. This happened if the
	    amount of schedulers was larger than one, the amount of
	    schedulers online was one, and someone was blocking
	    multi-scheduling.</p>
          <p>
	    Own Id: OTP-8169</p>
        </li>
        <li>
          <p>
	    An error in erlang:system_profile/2 could cause
	    timestamped messages to arrive out of order in the SMP
	    case. This has now been fixed.</p>
          <p>
	    Own Id: OTP-8171</p>
        </li>
	<li>
	  <p>
	    <span class="code">binary_to_atom/2</span> and
	    <span class="code">binary_to_existing_atom/2</span> would leak memory if the
	    binary contained unaligned data.</p>
          <p>
	    Own Id: OTP-8192</p>
        </li>
        <li>
          <p>
	    The async thread pool in the runtime system without SMP
	    support used a memory allocator that was not thread safe
	    for async jobs.</p>
          <p>
	    Own Id: OTP-8194</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    Processor internal NUMA nodes are now supported in the
	    ERTS internal CPU topology representation. For more
	    information see the documentation of the <span class="code">+sct</span>
	    command line argument in the <span class="code">erl(1)</span> documentation,
	    and the documentation of
	    <span class="code">erlang:system_info(cpu_topology)</span>.</p>
          <p>
	    Own Id: OTP-8041</p>
        </li>
        <li>
          <p>
	    Documentation for ets improved about concurrency.</p>
          <p>
	    Own Id: OTP-8050</p>
        </li>
        <li>
          <p>
	    Emulator flags in an escript were earlier inherited to
	    emulators started from from the emulator running the
	    escript. For example when an escript invoked
	    <span class="code">os:cmd("erl")</span>, the new emulator were given
	    erroneous emulator flags. This bug has now been fixed</p>
          <p>
	    Escript filenames may now contain dots.</p>
          <p>
	    Own Id: OTP-8060</p>
        </li>
        <li>
          <p>
	    Made some BIFs non-recursive (relational operators,hash
	    and phash) to limit internal stack usage.</p>
          <p>
	    Own Id: OTP-8065</p>
        </li>
        <li>
          <p>
	    Fixed Windows specific bug in erl_prim_loader. Now it
	    handles the root directory (e.g. c:/) better. This bug
	    affected the directory listing in the debugger.</p>
          <p>
	    Own Id: OTP-8080</p>
        </li>
        <li>
          <p>
	    A TCP socket with option <span class="code">{packet,4}</span> could crash
	    the emulator if it received a packet header with a very
	    large size value (&gt;2Gb). The same bug caused
	    <span class="code">erlang:decode_packet/3</span> to return faulty values.
	    (Thanks to Georgos Seganos.)</p>
          <p>
	    Own Id: OTP-8102</p>
        </li>
        <li>
          <p>
	    The maximum size of the export table has been raised from
	    65536 to 524288 entries.</p>
          <p>
	    Own Id: OTP-8104 Aux Id: seq11345 </p>
        </li>
        <li>
          <p>
	    The file module has now a read_line/1 function similar to
	    the io:get_line/2, but with byte oriented semantics. The
	    function file:read_line/1 works for raw files as well,
	    but for good performance it is recommended to use it
	    together with the 'read_ahead' option for raw file
	    access.</p>
          <p>
	    Own Id: OTP-8108</p>
        </li>
        <li>
          <p>
	    Fixed bug causing emulator crash when reading a term in
	    external format containing a corrupt list with a negative
	    length.</p>
          <p>
	    Own Id: OTP-8117</p>
        </li>
        <li>
          <p>
	    New emulator flag <span class="code">+sss</span>, to set stack size of
	    scheduler threads.</p>
          <p>
	    Own Id: OTP-8119</p>
        </li>
        <li>
          <p>
	    The Windows utility Erlsrv, run in interactive mode now
	    accepts options for registering internal service name and
	    description field of Windows registry database.</p>
          <p>
	    Own Id: OTP-8132</p>
        </li>
        <li>
          <p>
	    <span class="code">erlang:demonitor(Mon, [flush])</span> has been optimized.
	    Previously it always searched the message queue of the
	    caller for a <span class="code">'DOWN'</span> message. Current
	    implementation only search the message queue when
	    necessary. It is quite common that the search is not
	    necessary.</p>
          <p>
	    A new option <span class="code">info</span> has been added to
	    <span class="code">erlang:demonitor/2</span>. For more information see the
	    <span class="code">erlang(3)</span> documentation.</p>
          <p>
	    Own Id: OTP-8143</p>
        </li>
        <li>
          <p>
	    I/O tasks could unnecessarily be rescheduled. This was
	    harmless, but not useful work.</p>
          <p>
	    Own Id: OTP-8148</p>
        </li>
        <li>
          <p>
	    Minor improvements of <span class="code">erlang:memory/[1,2]</span>.</p>
          <p>
	    Own Id: OTP-8152</p>
        </li>
        <li>
          <p>
	    New configuration option to enable use of shared zlib.</p>
          <p>
	    Own Id: OTP-8155</p>
        </li>
        <li>
          <p>
	    Fixed smp bug in ETS that could cause emulator crash when
	    table with more than 1000 objects accessed by several
	    processes, including calls to variants of <span class="code">select</span>
	    or <span class="code">match</span> combined with concurrent object deletion.</p>
          <p>
	    Own Id: OTP-8166 Aux Id: seq11392 </p>
        </li>
        <li>
          <p>
	    The code path interpretation is now more relaxed. The
	    flag -code_path_choice now defaults to relaxed instead of
	    strict. See the documentation of code and init for more
	    info.</p>
          <p>
	    Own Id: OTP-8170</p>
        </li>
        <li>
          <p>
	    Load balancing of run queues and check for I/O are
	    triggered more often than before in situations where
	    processes are scheduled often but are doing very little
	    work each time they execute.</p>
          <p>
	    Own Id: OTP-8172</p>
        </li>
        <li>
          <p>
	    Call tracing binary comprehensions would cause an
	    emulator crash. (Thanks to Paul Mineiro.)</p>
          <p>
	    Own Id: OTP-8179</p>
        </li>
        <li>
          <p>
	    <span class="code">binary_to_term/1</span> would crash the emulator instead
	    of generating a <span class="code">badarg</span> exception when given
	    certain invalid terms. (Thanks to Scott Lystig Fritchie.)</p>
          <p>
	    Own Id: OTP-8180</p>
        </li>
      </ul>
    



<h3><a name="id99902">1.17 
        Erts 5.7.2</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Crash dumps should now cause less problems for the
	    crashdump_viewer application. (For processes where arity
	    was non-zero, the arguments are now longer printed - they
	    used to be printed in a format that was not parseable.)</p>
          <p>
	    Own Id: OTP-7472 Aux Id: seq11019, 11292 </p>
        </li>
        <li>
          <p>
	    Processes could potentially get stuck on an offline
	    scheduler.</p>
          <p>
	    Own Id: OTP-7990</p>
        </li>
        <li>
          <p>
	    <span class="code">binary_to_atom/2</span> and
	    <span class="code">binary_to_existing_atom/2</span> could leak memory if
	    they caused a <span class="code">badarg</span> exception.</p>
          <p>
	    Own Id: OTP-7997</p>
        </li>
        <li>
          <p>
	    A process could under very rare circumstances erroneously
	    be resumed.</p>
          <p>
	    Own Id: OTP-8000</p>
        </li>
        <li>
          <p>
	    Load balancing between schedulers could under rare
	    circumstances cause an emulator crash.</p>
          <p>
	    Own Id: OTP-8008</p>
        </li>
        <li>
          <p>
	    <span class="code">erlang:memory(processes_used)</span> always returned
	    <span class="code">0</span> instead of the correct value. (Thanks to Geoff
	    Cant)</p>
          <p>
	    Own Id: OTP-8022</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    Major improvements of the Erlang distribution for Erlang
	    runtime systems with SMP support. Previously distribution
	    port locks were heavily contended, and all encoding and
	    decoding for a specific distribution channel had to be
	    done in sequence. Lock contention due to the distribution
	    is now negligible and both encoding and decoding of
	    Erlang messages can be done in parallel.</p>
          <p>
	    The old atom cache protocol used by the Erlang
	    distribution has been dropped since it effectively
	    prevented all parallel encoding and decoding of messages
	    passed over the same distribution channel.</p>
          <p>
	    A new atom cache protocol has been introduced which
	    isolates atom cache accesses and makes parallel encoding
	    and decoding of messages passed over the same
	    distribution channel possible. The new atom cache
	    protocol also use an atom cache size 8 times larger than
	    before. The new atom cache protocol is documented in the
	    ERTS users guide.</p>
          <p>
	    Erlang messages received via the distribution are now
	    decoded by the receiving Erlang processes without holding
	    any distribution channel specific locks. Erlang messages
	    and signals sent over the distribution are as before
	    encoded by the sending Erlang process, but now without
	    holding any distribution channel specific locks during
	    the encoding. That is, both encoding and decoding can be
	    and are done in parallel regardless of distribution
	    channel used.</p>
          <p>
	    The part that cannot be parallelized is the atom cache
	    updates. Atom cache updates are therefore now scheduled
	    on the distribution port. Since it is only one entity per
	    distribution channel doing this work there is no lock
	    contention due to the atom cache updates.</p>
          <p>
	    The new runtime system does not understand the old atom
	    cache protocol. New and old runtime systems can however
	    still communicate, but no atom cache will be used.</p>
          <p>
	    Own Id: OTP-7774</p>
        </li>
        <li>
          <p>
	    Fixed a bug that caused error logging from
	    <span class="code">driver_select</span> sometimes with additional symptoms
	    such as failing IP communications or even an emulator
	    crash.</p>
          <p>
	    Own Id: OTP-7898 Aux Id: seq11304 </p>
        </li>
        <li>
          <p>
	    Improved SMP concurrency for ETS tables. Several mutating
	    operations can now be performed truly concurrent on
	    different records of the same table. To support this, the
	    table has to be created with option
	    <span class="code">write_concurrency</span>, as it is achieved at the
	    expense of some execution and memory overhead.
	    <span class="code">ets:select</span> and <span class="code">select_count</span> has also been
	    improved for all tables to not acquire exclusive table
	    lock during the iteration.</p>
          <p>
	    Own Id: OTP-7922</p>
        </li>
        <li>
          <p>
	    erl (that is erl.exe and dyn_erl) and erlexec has been
	    made more dynamic so no hard coded paths needs to added
	    at installation time to erl (that is erl.ini and erl).
	    Reltool will make use of this in a future release.</p>
          <p>
	    Own Id: OTP-7952</p>
        </li>
        <li>
          <p>
	    Added functionality to get higher resolution timestamp
	    from system. The erlang:now function returns a timestamp
	    that's not always consistent with the actual operating
	    system time (due to resilience against large time changes
	    in the operating system). The function os:timestamp/0 is
	    added to get a similar timestamp as the one being
	    returned by erlang:now, but untouched by Erlangs time
	    correcting and smoothing algorithms. The timestamp
	    returned by os:timestamp is always consistent with the
	    operating systems view of time, like the calendar
	    functions for getting wall clock time, but with higher
	    resolution. Example of usage can be found in the os
	    manual page.</p>
          <p>
	    Own Id: OTP-7971</p>
        </li>
        <li>
          <p>
	    Two new options are added to open_port - spawn_executable
	    which runs external executables in a controlled way, and
	    spawn_driver which only opens port to loaded Erlang
	    drivers. See the erlang manual page for details.</p>
          <p>
	    Own Id: OTP-7995</p>
        </li>
        <li>
          <p>
	    New functionality in ETS to transfer the ownership of a
	    table. A table can either change owner be declaring an
	    "heir", another process that will inherit the table if
	    the owner terminates. A table can also change owner by
	    calling a new function <span class="code">ets:give_away</span>.</p>
          <p>
	    Own Id: OTP-8006</p>
        </li>
        <li>
          <p>
	    Updates to Tilera build environment.</p>
          <p>
	    Own Id: OTP-8009</p>
        </li>
        <li>
          <p>
	    A stack trace was unnecessarily saved during process
	    termination.</p>
          <p>
	    Own Id: OTP-8014</p>
        </li>
        <li>
          <p>
	    User defined CPU topology and scheduler bind type can now
	    be set from the command line when starting an emulator.
	    For more information see the documentation of the
	    <span class="code">+sct</span>, and the <span class="code">+sbt</span> emulator flags in the
	    <span class="code">erl(1)</span> documentation.</p>
          <p>
	    The CPU topologies returned from
	    <span class="code">erlang:system_info/1</span> and
	    <span class="code">erlang:system_flag/2</span> now always contain the
	    <span class="code">processor</span> level, also when not strictly necessary.</p>
          <p>
	    Own Id: OTP-8030</p>
        </li>
        <li>
          <p>
	    Various fixes in ETS: <span class="code">ets:first</span> could return a
	    deleted key in a fixated table. <span class="code">ets:lookup</span> could
	    return objects out of order if a deleted object was
	    re-inserted into a fixed bag. <span class="code">ets:delete_object</span>
	    could fail to delete duplicate objects in a
	    duplicate_bag.</p>
          <p>
	    Own Id: OTP-8040</p>
        </li>
      </ul>
    



<h3><a name="id100257">1.18 
        Erts 5.7.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Fixed a bug on Windows that could make
	    <span class="code">gen_tcp:send</span> hang trying to send an iolist of more
	    than 16 binaries.</p>
          <p>
	    Own Id: OTP-7816</p>
        </li>
        <li>
          <p>
	    The runtime system could under rare circumstances crash
	    during load balancing.</p>
          <p>
	    Own Id: OTP-7908 Aux Id: otp-7500 </p>
        </li>
        <li>
          <p>
	    <span class="code">run_erl</span> uses fallback if Unix98 pseudo-terminal is
	    not present on host.</p>
          <p>
	    Own Id: OTP-7916 Aux Id: seq11249 </p>
        </li>
        <li>
          <p>
	    A message buffer memory leak in the runtime system
	    without smp support has been fixed.</p>
          <p>
	    Own Id: OTP-7941</p>
        </li>
        <li>
	    <p>Attempting to append a binary of 16Mb or greater to
	    another binary using the bit syntax would cause a
	    <span class="code">system_limit</span> exception. There was also several
	    cases when constructing binaries when a <span class="code">badarg</span>
	    exception was generated when it should have been
	    <span class="code">system_limit</span>.</p>
          <p>
	    Own Id: OTP-7942</p>
        </li>
        <li>
          <p>
	    The runtime system with SMP support failed to terminate
	    the caller of <span class="code">link(RemotePid)</span> properly, if
	    <span class="code">RemotePid</span> was the pid of a process on an
	    unreachable node. The calling process was in this case
	    marked as exiting, but never terminated.</p>
          <p>
	    Own Id: OTP-7946</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    Rudimentary support for cross compiling is added to the
	    source release. The support is still in its infancy and
	    has only been used to cross compile on Linux for a
	    different cpu architecture and a different Linux version,
	    but should be extendible to support other platforms as
	    well. The cross configuration files with examples are
	    placed in $ERL_TOP/xcomp/. View README.xcomp and run
	    $ERL_TOP/otp_build -help for further information.</p>
          <p>
	    Own Id: OTP-7854</p>
        </li>
        <li>
	    <p>The escape sequence <span class="code">\{</span> which was given a new
	    interpretation in R13A has retained its old meaning (the
	    ASCII code for <span class="code">{</span>), which means that codes greater
	    than 255 have to be stated using hexadecimal characters
	    (for example, <span class="code">\x{AAA}</span>). The escape sequence
	    <span class="code">\xH</span> where H is a hexadecimal character followed by
	    something else but a hexadecimal character is no longer
	    valid (incompatibility with R13A). Character codes less
	    than 256 can be stated using two hexadecimal characters
	    (for example, <span class="code">\x0D</span>).</p>
          <p>
	    Own Id: OTP-7891 Aux Id: OTP-7855 </p>
        </li>
        <li>
	    <p>The <span class="code">term_to_binary/1</span> BIF used to be implemented
	    with recursive C code, which could cause the Erlang
	    emulator to terminate because of a stack overflow.</p>
	    <p>Also fixed some minor issues in
	    <span class="code">term_to_binary/1</span> and <span class="code">binary_to_term/1</span>
	    pointed out by Matthew Dempsky.</p>
          <p>
	    Own Id: OTP-7894</p>
        </li>
        <li>
          <p>
	    Several glitches and performance issues in the Unicode
	    and I/O-system implementation of R13A have been
	    corrected.</p>
          <p>
	    Own Id: OTP-7896 Aux Id: OTP-7648 OTP-7887 </p>
        </li>
        <li>
          <p>
	    Minor documentation improvements of the
	    <span class="code">scheduler_bind_type</span> argument of
	    <span class="code">erlang:system_flag/2</span>, and the
	    <span class="code">scheduler_bind_type</span>, and the
	    <span class="code">scheduler_bindings</span> arguments of
	    <span class="code">erlang:system_info/1</span>.</p>
          <p>
	    Own Id: OTP-7901 Aux Id: OTP-7777 </p>
        </li>
        <li>
          <p>
	    There is a new BIF <span class="code">erlang:make_tuple/3</span>.</p>
          <p>
	    Own Id: OTP-7913</p>
        </li>
      </ul>
    




<h3><a name="id100522">1.19 
        Erts 5.7</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
	    <p><strong>OpenSource:</strong></p>
	    <p>FreeBSD leap-seconds are handled according to patch
	    submitted by OpenSource user Kenji Rikitake. No test case
	    covers this functionality (unsupported platform).</p>
          <p>
	    Own Id: OTP-7609</p>
        </li>
        <li>
          <p>
	    A corrected bug in <span class="code">ets</span> for <span class="code">bag</span> and
	    <span class="code">duplicate_bag</span>. A <span class="code">delete/2</span> or
	    <span class="code">lookup_element/3</span> could miss objects in a fixed
	    table if one or more objects with the same key had
	    already been deleted.</p>
          <p>
	    Own Id: OTP-7665</p>
        </li>
        <li>
          <p>
	    A new driver call-back <span class="code">stop_select</span> is introduced
	    to allow drivers to de-select and then close a file
	    descriptor in a safe way in a SMP emulator. The old way
	    was not strictly according to posix standard and could in
	    some rare cases lead to unexpected behavior. A new flag
	    <span class="code">ERL_DRV_USE</span> can be passed to
	    <span class="code">driver_select()</span> to tell it that the descriptor
	    should be closed. <span class="code">stop_select</span> is then called when
	    it is safe to do so. Old drivers will however still work
	    as before.</p>
          <p>
	    Own Id: OTP-7670</p>
        </li>
        <li>
          <p>
	    A bug fixed for TCP sockets with option
	    <span class="code">{packet,http}</span>. An HTTP request with an absolute
	    URI was returned with a corrupt path string. This bug did
	    only exist in R12B-4 and R12B-5.</p>
          <p>
	    Own Id: OTP-7682 Aux Id: OTP-7647 </p>
        </li>
        <li>
          <p>
	    run_erl did in some cases fail to extract control
	    sequences from to_erl (like: winsize=X,Y) and did instead
	    send them to be interpreted by the erlang shell.</p>
          <p>
	    Own Id: OTP-7688</p>
        </li>
        <li>
          <p>
	    A bug in the installer on Windows not updating file
	    associations properly is now corrected.</p>
          <p>
	    Own Id: OTP-7746</p>
        </li>
        <li>
	    <p>More space than necessary could be allocated in
	    binaries when appending to a binary (also in a binary
	    comprehension) and the data appended did not consist of
	    wholes bytes (e.g. 13 bits).</p>
          <p>
	    Own Id: OTP-7747</p>
        </li>
        <li>
          <p>
	    The gen_sctp option sctp_peer_addr_params,
	    #sctp_paddrparams{address={IP,Port} was erroneously
	    decoded in the inet driver. This bug has now been
	    corrected.</p>
          <p>
	    Own Id: OTP-7755</p>
        </li>
        <li>
          <p>
	    Outstanding async driver jobs leaked memory if the
	    issuing port died before the async jobs completed.</p>
          <p>
	    Own Id: OTP-7784</p>
        </li>
        <li>
	    <p>A bug in the dynamic library loading affecting, among
	    others, OpenSolaris is now corrected. (Thanks to Paul
	    Fisher.)</p>
          <p>
	    Own Id: OTP-7796</p>
        </li>
        <li>
          <p>
	    run_erl compile errors fixed for FreeBSD</p>
          <p>
	    Own Id: OTP-7817</p>
        </li>
        <li>
          <p>
	    A bug in the inet driver for SCTP on Solaris showing for
	    e.g gen_sctp:abort/1 and gen_sctp:eof/1 has been
	    corrected. Patch suggestion by Simon Cornish.</p>
          <p>
	    Own Id: OTP-7866</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    The order of objects visited in select for ordered_set is
	    now documented.</p>
          <p>
	    Own Id: OTP-7339</p>
        </li>
        <li>
          <p>
	    The runtime system with SMP support now uses multiple,
	    scheduler specific run queues, instead of one globally
	    shared run queue.</p>
          <p>
	    The lock protecting the shared run queue was heavily
	    contended, and the shared run queue also caused Erlang
	    processes to randomly migrate between schedulers with
	    negative cache effects as a result.</p>
          <p>
	    With the current scheduler specific run queue solution,
	    lock contention due to run queue protection has been
	    reduced, and Erlang processes are only migrated when
	    needed to balance the load between the schedulers. The
	    reduced amount of migration also reduce lock contention
	    on locks protecting the scheduler specific instances of
	    the erts internal memory allocators.</p>
          <p>
	    The scheduler specific run queues are also a necessity
	    for a lot of future planned NUMA (Non-Uniform Memory
	    Access) specific optimizations.</p>
          <p>
	    Own Id: OTP-7500</p>
        </li>
        <li>
	    <p>Support for Unicode is implemented as described in
	    EEP10. Formatting and reading of unicode data both from
	    terminals and files is supported by the io and io_lib
	    modules. Files can be opened in modes with automatic
	    translation to and from different unicode formats. The
	    module 'unicode' contains functions for conversion
	    between external and internal unicode formats and the re
	    module has support for unicode data. There is also
	    language syntax for specifying string and character data
	    beyond the ISO-latin-1 range.</p>
	    <p>The interactive shell will support input and output of
	    unicode characters when the terminal and operating system
	    supports it.</p>
	    <p>Please see the EEP and the io/io_lib manual pages as
	    well as the stdlib users guide for details.</p>
	    <p><strong>I/O-protocol incompatibilities:</strong></p>
	    <p>The io_protocol between io_Server and client is
	    updated to handle protocol data in unicode formats. The
	    updated protocol is now documented. The specification
	    resides in the stdlib <strong>users manual</strong>, which is a
	    new part of the manual.</p>
	    <p><strong>io module incompatibilities:</strong></p>
	    <p>The io:put_chars, io:get_chars and io:get_line all
	    handle and return unicode data. In the case where
	    binaries can be provided (as to io:put_chars), they shall
	    be encoded in UTF-8. When binaries are returned (as by
	    io:get_line/get_chars when the io_server is set in
	    <strong>binary mode</strong>) the returned data is also
	    <strong>always</strong> encoded as UTF-8. The file module however
	    still returns byte-oriented data, why file:read can be
	    used instead of io:get_chars to read binary data in
	    ISO-latin-1.</p>
	    <p><strong>io_lib module incompatibilities:</strong></p>
	    <p>io_lib:format can, given new format directives (i.e
	    "~ts" and "~tc"), return lists containing integers larger
	    than 255. </p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7648 Aux Id: OTP-7580 OTP-7514 OTP-7494
	    OTP-7443 OTP-7181 EEP10 EEP11 </p>
        </li>
        <li>
          <p>
	    The format of the string returned by
	    <span class="code">erlang:system_info(system_version)</span> (as well as the
	    first message when Erlang is started) has changed. The
	    string now contains the both the OTP version number as
	    well as the erts version number.</p>
          <p>
	    Own Id: OTP-7649</p>
        </li>
        <li>
          <p>
	    Message passing has been further optimized for parallel
	    execution. Serial message passing is slightly more
	    expensive than before, but parallel send to a common
	    receiver is much cheaper.</p>
          <p>
	    Own Id: OTP-7659</p>
        </li>
        <li>
          <p>
	    Lock contention on the atom table lock when decoding
	    Erlang terms on the external format has been drastically
	    reduced.</p>
          <p>
	    Own Id: OTP-7660</p>
        </li>
        <li>
          <p>
	    The undocumented, unsupported, and deprecated guard BIF
	    <span class="code">is_constant/1</span> has been removed.</p>
          <p>
	    *** INCOMPATIBILITY with R12B ***</p>
          <p>
	    Own Id: OTP-7673</p>
        </li>
        <li>
          <p>
	    The Erlang process lock implementation has been improved
	    by Mat Hostetter at Tilera Corporation.</p>
          <p>
	    Own Id: OTP-7692</p>
        </li>
        <li>
          <p>
	    A <span class="code">{nodedown, Node}</span> message passed by the
	    <span class="code">net_kernel:monitor_nodes/X</span> functionality is now
	    guaranteed to be sent after <span class="code">Node</span> has been removed
	    from the result returned by <span class="code">erlang:nodes/Y</span>.</p>
          <p>
	    Own Id: OTP-7725</p>
        </li>
        <li>
	    <p>The short-circuit operators <span class="code">andalso</span> and
	    <span class="code">orelse</span> no longer guarantees that their second
	    argument is either <span class="code">true</span> or <span class="code">false</span>. As a
	    consequence, <span class="code">andalso</span>/<span class="code">orelse</span> are now
	    tail-recursive.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7748</p>
        </li>
        <li>
          <p>
	    A new BIF, <span class="code">lists:keyfind/3</span>, has been added. It
	    works like <span class="code">lists:keysearch/3</span> except that it does
	    not wrap the returned tuple in a <span class="code">value</span> tuple in
	    case of success. (Thanks to James Hague for suggesting
	    this function.)</p>
          <p>
	    Own Id: OTP-7752</p>
        </li>
        <li>
          <p>
	    Optimization for drivers by creating small binaries
	    direct on process heap.</p>
          <p>
	    Own Id: OTP-7762</p>
        </li>
        <li>
	    <p><span class="code">I bsl N</span> could cause the Erlang virtual machine
	    to run of memory instead generating a <span class="code">system_limit</span>
	    if N was absurdly huge. (Thanks to Daniel Hedlund.)</p>
	    <p>There would always be a garbage collection when
	    evaluating <span class="code">I bsl N</span> or <span class="code">I bsr N</span> if <span class="code">I</span>
	    was a bignum.</p>
	    <p>If <span class="code">I</span> is an integer and <span class="code">N</span> a bignum, <span class="code">I
	    bsl N</span> will now cause the correct <span class="code">system_limit</span>
	    exception instead of <span class="code">bad_arith</span> as in earlier
	    releases.</p>
	    <p>If <span class="code">I</span> is an integer and <span class="code">N</span> a bignum, <span class="code">I
	    bsr N</span> will return either 0 or -1 depending on the
	    sign of <span class="code">I</span> instead of causing a <span class="code">bad_arith</span>
	    exception as in earlier releases.</p>
          <p>
	    Own Id: OTP-7764</p>
        </li>
        <li>
          <p>
	    Scheduler threads can now be bound to logical processors
	    on newer Linux and Solaris systems. More systems will be
	    supported in the future.</p>
          <p>
	    In some cases performance has increased drastically when
	    binding schedulers. Schedulers are not bound by default,
	    though. This since it might cause a performance
	    degradation if multiple programs have bound to
	    processors, e.g. multiple Erlang runtime systems. For
	    more information see the documentation of
	    <span class="code">erlang:system_flag/2</span>.</p>
          <p>
	    In order to bind scheduler threads the CPU topology need
	    to be known. On some newer Linux and Solaris systems the
	    runtime system automatically detects the CPU topology. If
	    the emulator isn't able to automatically detect the CPU
	    topology, the CPU topology can be defined. For more
	    information see the documentation of
	    <span class="code">erlang:system_flag/2</span>.</p>
          <p>
	    Own Id: OTP-7777</p>
        </li>
        <li>
	    <p>The compiler will refuse to a compile file where the
	    module name in the file differs from the output file
	    name.</p>
	    <p>When compiling using <span class="code">erlc</span>, the current working
	    directory will no be included in the code path (unless
	    explicitly added using "-pa .").</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7793</p>
        </li>
        <li>
          <p>
	    The BIFs <span class="code">atom_to_binary/2</span>,
	    <span class="code">binary_to_atom/2</span>, and
	    <span class="code">binary_to_existing_atom/2</span> have been added.</p>
          <p>
	    Own Id: OTP-7804</p>
        </li>
        <li>
          <p>
	    The amount of schedulers online can now be changed during
	    operation. The amount of schedulers online defaults to
	    the same amount as available logical processors. For more
	    information see the documentation of
	    <span class="code">erlang:system_flag/2</span> and <span class="code">erl</span>.</p>
          <p>
	    Own Id: OTP-7811</p>
        </li>
        <li>
	    <p>The deprecated functions <span class="code">erlang:fault/1</span>,
	    <span class="code">erlang:fault/2</span>, and <span class="code">file:rawopen/2</span> have
	    been removed.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7812</p>
        </li>
        <li>
          <p>
	    Erts internal dynamically allocated process and port
	    specific data for rarely used data. This is used to
	    reduce memory usage of processes and ports that do not
	    use specific functionality. More functionality will be
	    moved to process and port specific data in future
	    releases.</p>
          <p>
	    Own Id: OTP-7818</p>
        </li>
        <li>
          <p>
	    New packet type <span class="code">http_bin</span> for gen_tcp sockets and
	    <span class="code">erlang:decode_packet</span>. It works like <span class="code">http</span>
	    except that strings are returned as binaries instead of
	    lists.</p>
          <p>
	    Own Id: OTP-7821</p>
        </li>
        <li>
          <p>
	    The obsolete wd_keeper program for embedded Solaris
	    systems has been removed.</p>
          <p>
	    Own Id: OTP-7822</p>
        </li>
        <li>
          <p>
	    Nodes belonging to different independent clusters can now
	    co-exist on the same host with the help of a new
	    environment variable setting ERL_EPMD_PORT.</p>
          <p>
	    Own Id: OTP-7826</p>
        </li>
        <li>
	    <p>There are new functions <span class="code">erlang:min/2</span> and
	    <span class="code">erlang:max/2</span> to calculate the minimum and maximum
	    of two terms, respectively. Note that the functions are
	    not auto-imported, so they need to be imported explicitly
	    or the <span class="code">erlang</span> prefix must be used when calling
	    them.</p>
          <p>
	    Own Id: OTP-7841</p>
        </li>
        <li>
	    <p>The copyright notices have been updated.</p>
          <p>
	    Own Id: OTP-7851</p>
        </li>
        <li>
	    <p>Enhanced build environment for cross compilation to
	    Tilera Tile architecture.</p>
	    <p>Support for native ethread atomics on Tilera
	    Tile64/TilePro (Thanks to Tilera Corporation).</p>
          <p>
	    Own Id: OTP-7852</p>
        </li>
        <li>
	    <p>The escape sequences <span class="code">\x</span> and <span class="code">\{</span> have been
	    assigned new interpretations (they used to return the
	    ASCII code for <span class="code">x</span> and <span class="code">{</span> respectively). One
	    or more octal characters inside curly brackets after a
	    leading backslash is from now on an alternative to the
	    existing syntax <span class="code">\NNN</span>, but can also be used for
	    codes greater than 255. In a similar fashion, one or more
	    hexadecimal characters can be put inside curly brackets
	    after a leading <span class="code">\x</span>. Furthermore, the escape
	    sequences <span class="code">\xH</span> and <span class="code">\xHH</span>, where N is a
	    hexadecimal character, can be used for codes less than
	    256.</p>
	    <p>NOTE: These new escape sequences are still considered
	    experimental and may be changed in the R13B release.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7855</p>
        </li>
        <li>
          <p>
	    The PCRE library's exported function names are now
	    prefixed with erts_ in the erlang emulator to avoid
	    clashes with dynamically loaded drivers.</p>
          <p>
	    Own Id: OTP-7861</p>
        </li>
        <li>
          <p>
	    A runtime system with SMP support will now be built by
	    default on most platforms if a usable posix thread
	    library or native windows threads are found.</p>
          <p>
	    For more information see the top README file.</p>
          <p>
	    Own Id: OTP-7872</p>
        </li>
      </ul>
    




<h3><a name="id101433">1.20 
        Erts 5.6.5.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    A corrected bug in <span class="code">ets</span> for <span class="code">bag</span> and
	    <span class="code">duplicate_bag</span>. A <span class="code">delete/2</span> or
	    <span class="code">lookup_element/3</span> could miss objects in a fixed
	    table if one or more objects with the same key had
	    already been deleted.</p>
          <p>
	    Own Id: OTP-7665</p>
        </li>
        <li>
          <p>
	    A bug fixed for TCP sockets with option
	    <span class="code">{packet,http}</span>. An HTTP request with an absolute
	    URI was returned with a corrupt path string. This bug did
	    only exist in R12B-4 and R12B-5.</p>
          <p>
	    Own Id: OTP-7682 Aux Id: OTP-7647 </p>
        </li>
        <li>
          <p>
	    Calling <span class="code">gen_tcp:send()</span> from several processes on
	    socket with option <span class="code">send_timeout</span> could lead to much
	    longer timeout than specified. The solution is a new
	    socket option <span class="code">{send_timeout_close,true}</span> that will
	    do automatic close on timeout. Subsequent calls to send
	    will then immediately fail due to the closed connection.</p>
          <p>
	    Own Id: OTP-7731 Aux Id: seq11161 </p>
        </li>
        <li>
          <p>
	    A process being garbage collected via the
	    <span class="code">garbage_collect/1</span> BIF or the
	    <span class="code">check_process_code/2</span> BIF didn't handle message
	    receive and resume correctly during the garbage collect.
	    When this occurred, the process returned to the state it
	    had before the garbage collect instead of entering the
	    new state.</p>
          <p>
	    Own Id: OTP-7738</p>
        </li>
      </ul>
    



<h3><a name="id101544">1.21 
        Erts 5.6.5</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    A bug in inet_drv concerning gen_tcp:connect has been
	    corrected. A connect towards a non-open port through open
	    firewalls could sometimes erroneously be successful. Any
	    subsequent operation would fail, though.</p>
          <p>
	    Own Id: OTP-6542</p>
        </li>
        <li>
          <p>
	    Floating point arithmetics in drivers could cause a
	    runtime system crash and/or unexpected results on runtime
	    systems with floating point exceptions enabled. Floating
	    point exceptions are disabled unless explicitly enabled
	    or if hipe is enabled.</p>
          <p>
	    Own Id: OTP-7237</p>
        </li>
        <li>
          <p>
	    A bug when many sockets got signalled simultaneously
	    causing the emulator to panic with the message
	    "Inconsistent, why isnt io reported?" is now corrected.</p>
          <p>
	    Own Id: OTP-7420</p>
        </li>
        <li>
          <p>
	    Starting erl with option "-detached" now disconnects
	    correctly from terminal session on Unix.</p>
          <p>
	    Own Id: OTP-7461</p>
        </li>
        <li>
          <p>
	    Mended gdb etp-commands for ETS access.</p>
          <p>
	    Own Id: OTP-7538</p>
        </li>
        <li>
          <p>
	    <span class="code">erlang:decode_packet/3</span> allows white space between
	    HTTP header tag and colon according to RFC2616.</p>
          <p>
	    Own Id: OTP-7543</p>
        </li>
        <li>
          <p>
	    An emulator compiled for SCTP now starts even if the
	    dynamic libraries are not present. The SCTP driver is
	    then of course not loaded.</p>
          <p>
	    Own Id: OTP-7551</p>
        </li>
        <li>
	    <p>To build on Mac OS X, 10.3.0 or later is now required
	    because of fixes for two problems:</p>
	    <p>There would be a resource leak when <span class="code">erl_ddl</span>
	    attempted to unload a driver. This problem has been
	    corrected by using <span class="code">dlopen()</span> (which works on all
	    modern Unix-like platforms) instead of the Mac OS X
	    specific API calls.</p>
	    <p>Signal handling in the run-time system for HiPE has
	    been updated to work on later versions of Mac OS X than
	    10.2.x. Therefore, <span class="code">--enable-hipe</span> now works on Mac
	    OS X with Intel CPUs.</p>
	    <p>Thanks to Geoff Cant for the patches.</p>
          <p>
	    Own Id: OTP-7562</p>
        </li>
        <li>
	    <p>Corrected some information about the protocol between
	    EPMD and Erlang nodes. (Thanks to Michael Regen.)</p>
          <p>
	    Own Id: OTP-7594</p>
        </li>
        <li>
          <p>
	    When using
	    <span class="code">erlang:system_monitor(Pid,{long_gc,Time})</span>, and the
	    GC time exceeded 1 second, it sometimes erroneously
	    showed up as about 4300 seconds. (This bug was corrected
	    in R9C, but re-introduced in R12B.) (Thanks to Chris
	    Newcombe.)</p>
          <p>
	    Own Id: OTP-7622 Aux Id: OTP-4903, seq8379 </p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    The driver entry of a dynamically loaded driver is now
	    copied when loaded which enables some internal
	    optimizations. Note that drivers that modify the driver
	    entry during execution will not work anymore. Such a
	    miss-use of the driver interface is however not
	    supported.</p>
          <p>
	    Own Id: OTP-6900</p>
        </li>
        <li>
          <p>
	    The split function is now added to the re library.
	    Exceptions and errors from both run, replace and split
	    are made more consistent.</p>
          <p>
	    Own Id: OTP-7514 Aux Id: OTP-7494 </p>
        </li>
        <li>
          <p>
	    Fixed harmless compiler warnings when building the
	    emulator and minor build changes in order to avoid
	    unnecessary rebuilds.</p>
          <p>
	    Own Id: OTP-7530</p>
        </li>
        <li>
          <p>
	    There is now experimental support for loading of code
	    from archive files. See the documentation of <span class="code">code</span>,
	    <span class="code">init</span>, <span class="code">erl_prim_loader </span> and <span class="code">escript</span>
	    for more info.</p>
          <p>
	    The error handling of <span class="code">escripts</span> has been improved.</p>
          <p>
	    An <span class="code">escript</span> may now set explicit arguments to the
	    emulator, such as <span class="code">-smp enabled</span>.</p>
          <p>
	    An <span class="code">escript</span> may now contain a precompiled beam
	    file.</p>
          <p>
	    An <span class="code">escript</span> may now contain an archive file
	    containing one or more applications (experimental).</p>
          <p>
	    The internal module <span class="code">code_aux</span> has been removed.</p>
          <p>
	    Own Id: OTP-7548 Aux Id: otp-6622 </p>
        </li>
        <li>
          <p>
	    The reallocation functionality part of the ERTS internal
	    memory allocators, now consider current block in
	    combination with surrounding free blocks as an
	    alternative location for a reallocation.</p>
          <p>
	    Own Id: OTP-7555</p>
        </li>
        <li>
	    <p>There could remain false references from a process to
	    a module that has been called earlier, so that the
	    process would be killed if the module was reloaded.
	    (Thanks to Richard Carlsson.)</p>
	    <p>Also, the fix for this bug also made it possible to
	    make stack backtraces (as returned from
	    <span class="code">erlang:get_stacktrace/0</span> and other functions) more
	    correct in that the immediate caller is always included
	    in the stack backtrace (it could sometimes be
	    missing).</p>
          <p>
	    Own Id: OTP-7559</p>
        </li>
        <li>
          <p>
	    Improved locking in IO-handling for better smp
	    performance.</p>
          <p>
	    Own Id: OTP-7560</p>
        </li>
        <li>
          <p>
	    Improved BIF rescheduling functionality.</p>
          <p>
	    Own Id: OTP-7587</p>
        </li>
        <li>
          <p>
	    Loading a module compiled with Erlang/OTP R9C and calling
	    <span class="code">module_info/0</span> in the module would crash the
	    emulator. The emulator now refuses to load any module
	    compiled with R9C or earlier. (Note: only trivial modules
	    compiled with R10B or earlier could be loaded anyway.)
	    (Thanks to Martin Kjellin.)</p>
          <p>
	    Own Id: OTP-7590</p>
        </li>
      </ul>
    



<h3><a name="id101914">1.22 
        Erts 5.6.4.2</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    A process calling one of the following BIFs could under
	    very rare conditions deadlock in the runtime system with
	    SMP support: <span class="code">check_process_code/2</span>,
	    <span class="code">garbage_collect/1</span>, <span class="code">process_info/[1,2]</span>,
	    <span class="code">system_flag/2</span>, and
	    <span class="code">erlang:suspend_process/[1,2]</span>.</p>
          <p>
	    Own Id: OTP-7582</p>
        </li>
        <li>
          <p>
	    A couple of statistics variables were not managed in a
	    thread safe manner in the runtime system with SMP
	    support.</p>
          <p>
	    Own Id: OTP-7583</p>
        </li>
        <li>
          <p>
	    An extremely rare race condition when terminating a
	    process could potentially cause a runtime system crash.</p>
          <p>
	    Own Id: OTP-7584</p>
        </li>
        <li>
          <p>
	    Under certain conditions and when using run_erl/to_erl,
	    the terminal Erlang driver (ttsl_drv) could crash the
	    emulator by doing a division by zero due to incorrect
	    handling of terminals reporting a zero width. For
	    terminals reporting zero width, the driver now fallbacks
	    to a default width of 80 and a default height of 24
	    (vt100), as a fallback behaviour. This fixes the crashes
	    and also makes output on "dumb" terminals much more
	    readable.</p>
          <p>
	    Own Id: OTP-7592 Aux Id: seq11073 </p>
        </li>
      </ul>
    



<h3><a name="id102003">1.23 
        Erts 5.6.4.1</a></h3>

    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    A new <span class="code">erts_alloc</span> parameter
	    <span class="code">+M&lt;S&gt;rmbcmt</span> (relative multiblock carrier
	    move threshold) has been added. It determines when to
	    force a moving realloc in a multiblock carrier when a
	    block is shrunk. For more information see the
	    <span class="code">erts_alloc(3)</span> documentation.</p>
          <p>
	    Own Id: OTP-7540</p>
        </li>
        <li>
	    <p>The new option <span class="code">+d</span> can be given to <span class="code">erl</span> to
	    suppress the crash dump generation if an internal error
	    is detected. As a result, a more useful core dump is
	    produced.</p>
          <p>
	    Own Id: OTP-7578 Aux Id: seq11052 </p>
        </li>
      </ul>
    



<h3><a name="id102065">1.24 
        Erts 5.6.4</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Double backslashes in format string passed to the erts
	    internal printf implementation produced erroneous
	    results. No such format strings were passed to the erts
	    internal printf implementation, i.e., the bug was
	    therefore completely harmless. (Thanks to Perry Smith.)</p>
          <p>
	    Own Id: OTP-7408</p>
        </li>
        <li>
          <p>
	    Large files are now handled on Windows, where the
	    filesystem supports it.</p>
          <p>
	    Own Id: OTP-7410</p>
        </li>
        <li>
          <p>
	    Bug fixed for <span class="code">{packet,http}</span> when space follows
	    http headers.</p>
          <p>
	    Own Id: OTP-7458</p>
        </li>
        <li>
          <p>
	    The trace option <span class="code">running</span> could cause an emulator
	    crash if the current function couldn't be determined.</p>
          <p>
	    Own Id: OTP-7484</p>
        </li>
        <li>
          <p>
	    Using 16#ffffFFFF as a timeout value in receive...after
	    would often cause a timeout almost at once due to an
	    32-bit integer overflow. (Thanks to Serge Aleynikov and
	    Matthias Lang.)</p>
          <p>
	    Own Id: OTP-7493</p>
        </li>
        <li>
          <p>
	    For the process that an escript runs in, the
	    <span class="code">trap_exit</span> process flag is now <span class="code">false</span> instead
	    of <span class="code">true</span> (as in previous releases). Scripts that
	    depend on the previous (counter-intuitive) behaviour
	    might not work. (Thanks to Bengt Kleberg.)</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7517</p>
        </li>
        <li>
          <p>
	    A bug in the <span class="code">string:to_integer/1</span> builtin made the
	    emulator unstable. This is now corrected. (Thanks to Lev
	    Walkin.)</p>
          <p>
	    Own Id: OTP-7526</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
	    <p>Performance for ETS intensive applications should now
	    be better in the SMP emulator. Also, ETS table
	    identifiers (as returned by <span class="code">ets:new/2</span>) are now
	    spread out in wider range than before (using 28 bits in a
	    32-bit emulator) to make sure that the table identifier
	    for a deleted table will not be quickly re-used.</p>
	    <p>NOTE: Table identifiers can now be negative integers.
	    Programs that (incorrectly) assume that table identifiers
	    can only be positive integers might stop to work. (The
	    type of a table identifier is intentionally not
	    documented, and may change in a future release.)</p>
          <p>
	    Own Id: OTP-7348</p>
        </li>
        <li>
          <p>
	    New BIF <span class="code">erlang:decode_packet/3</span> that extracts a
	    protocol packet from a binary. Similar to the socket
	    option <span class="code">{packet, Type}</span>. Also documented the socket
	    packet type <span class="code">http</span> and made it official.
	    <strong>NOTE</strong>: The tuple format for <span class="code">http</span> packets
	    sent from an active socket has been changed in an
	    incompatible way.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7404</p>
        </li>
        <li>
          <p>
	    The source code for the documentation for some
	    applications (erts, kernel, stdlib, and several others)
	    are now included in the source tar ball. There is
	    currently no Makefile support for building HTML files
	    from the source (such support will be included in a
	    future release).</p>
          <p>
	    Own Id: OTP-7406</p>
        </li>
        <li>
          <p>
	    A lot of frequently accessed memory counters (erts
	    internal) have been removed. This since they hurt
	    performance on the runtime system with SMP support. As a
	    result <span class="code">erlang:memory/[0,1]</span> will only deliver a
	    result if all <span class="code">erts_alloc(3)</span> allocators are enabled
	    (default). The result delivered when all
	    <span class="code">erts_alloc(3)</span> allocators are enabled are both more
	    accurate and less accurate than before. More memory than
	    before are included in the result, but the different
	    parts that are summed are not gathered atomically. A call
	    to <span class="code">erlang:memory/[0,1]</span> is much cheaper for the
	    system than before. This since the information isn't
	    gathered atomically anymore which was very expensive.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7468</p>
        </li>
        <li>
          <p>
	    Pre-allocators used for, for example, timers, and
	    messages have been rewritten to be scheduler specific.
	    That is, different schedulers will now allocate from
	    different pools which reduces lock contention.</p>
          <p>
	    Own Id: OTP-7470</p>
        </li>
        <li>
          <p>
	    On Mac OS X, file:sync/1 now guarantees that all
	    filesystem buffers are written to the disk by using the
	    fcntl() with F_FULLFSYNC option. Previously, file:sync/1
	    called fsync(), which only guaranteed that the data had
	    been transferred to the disk drive. (Thanks to Jan
	    Lehnardt.)</p>
          <p>
	    Own Id: OTP-7471</p>
        </li>
        <li>
          <p>
	    Termination of a process that takes a long time can now
	    be preempted, i.e., the terminating process will be
	    rescheduled for later continuation of termination so that
	    other processes can execute. Termination of a process
	    that owns many and/or large ets tables typically takes a
	    long time.</p>
          <p>
	    Own Id: OTP-7477</p>
        </li>
        <li>
          <p>
	    A new trace option <span class="code">exiting</span> has been added. The
	    <span class="code">exiting</span> trace is similar to the <span class="code">running</span>
	    trace, but for exiting processes. For more information
	    see the erlang(3) documentation.</p>
          <p>
	    The <span class="code">erlang:trace/3</span> bif now doesn't block other
	    scheduler threads if only one tracee is specified in the
	    call to <span class="code">erlang:trace/3</span>.</p>
          <p>
	    Own Id: OTP-7481</p>
        </li>
        <li>
          <p>
	    The re module is extended with repetitive matches (global
	    option) and replacement function.</p>
          <p>
	    Own Id: OTP-7494 Aux Id: OTP-7181 </p>
        </li>
        <li>
          <p>
	    In the section about binary construction, the reference
	    manual now mentions what happens when an integer value
	    does not fit into an integer segment of size N (namely,
	    that the N least significant bits will be put into into
	    the binary and that the most significant bits will be
	    silently discarded). (Thanks to Edwin Fine.)</p>
          <p>
	    Own Id: OTP-7506</p>
        </li>
        <li>
          <p>
	    Setting the <span class="code">{active,once}</span> for a socket (using
	    inets:setopts/2) is now specially optimized (because the
	    <span class="code">{active,once}</span> option is typically used much more
	    frequently than other options).</p>
          <p>
	    Own Id: OTP-7520</p>
        </li>
      </ul>
    


    <h4>Known Bugs and Problems</h4>
      <ul>
        <li>
          <p>
	    Floating point arithmetics in drivers can cause a runtime
	    system crash and/or unexpected results on runtime systems
	    with floating point exceptions enabled. Floating point
	    exceptions are disabled unless explicitly enabled or if
	    hipe is enabled.</p>
          <p>
	    Own Id: OTP-7237</p>
        </li>
      </ul>
    



<h3><a name="id102462">1.25 
        Erts 5.6.3.3</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Binary construction with an integer field of size 0 at
	    the end of the constructed binary (and the size given in
	    a variable), would cause a write of one byte outside the
	    memory reserved for the binary, which in turn could cause
	    an emulator crash.</p>
          <p>
	    Own Id: OTP-7422</p>
        </li>
        <li>
          <p>
	    A race condition in the dynamic driver implementation
	    could cause an emulator crash. (Thanks to Paul Fisher)</p>
          <p>
	    Own Id: OTP-7464</p>
        </li>
        <li>
          <p>
	    Calls to <span class="code">erlang:system_info(allocated_areas)</span> could
	    cause the runtime system with SMP support to crash.</p>
          <p>
	    Own Id: OTP-7474</p>
        </li>
        <li>
          <p>
	    The <span class="code">env</span> option to <span class="code">open_port()</span> could cause
	    the runtime system with SMP support to crash.</p>
          <p>
	    Own Id: OTP-7475</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    Operations that needed to block other threads in the
	    runtime system with SMP support unnecessarily waited for
	    async threads to block. Most important the
	    <span class="code">erlang:memory/[0,1]</span> bif, code loading, and the
	    <span class="code">erlang:trace/3</span> bif.</p>
          <p>
	    Own Id: OTP-7480</p>
        </li>
      </ul>
    



<h3><a name="id102573">1.26 
        Erts 5.6.3.2</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Calls to <span class="code">erlang:memory/[0,1]</span> could cause the
	    runtime system with SMP support to crash.</p>
          <p>
	    Own Id: OTP-7415</p>
        </li>
      </ul>
    



<h3><a name="id102607">1.27 
        Erts 5.6.3.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Doing local call trace on bit syntax matching code that
	    has been optimized with delayed sub-binary creation could
	    crash the emulator.</p>
          <p>
	    Own Id: OTP-7399 Aux Id: seq10978 </p>
        </li>
      </ul>
    



<h3><a name="id102638">1.28 
        Erts 5.6.3</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Only one to_erl process at a time is allowed to connect
	    to the same run_erl pipe. Prevents buggy behaviour when
	    IO from several to_erl's get interleaved.</p>
          <p>
	    Own Id: OTP-5107</p>
        </li>
        <li>
          <p>
	    IPv6 name resolving has now been fixed to use
	    getaddrinfo() patch (thoroughly reworked) courtesy of Love
	    Hörnquist-Åstrand submitted by Fredrik Thulin. It also
	    can use gethostname2() patch (also reworked) courtesy of
	    Mikael Magnusson for debian submitted by Sergei Golovan.</p>
          <p>
	    Own Id: OTP-5382</p>
        </li>
        <li>
          <p>
	    Improved error handling in run_erl</p>
          <p>
	    Own Id: OTP-7252</p>
        </li>
        <li>
	    <p>A permanent fix for the deadlock issue temporarily
	    fixed by OTP-7260.</p> <dl>
<dt><strong>OTP-7260</strong></dt>
<dd>
	    The runtime system with SMP support could under rare
	    circumstances deadlock when a distribution channel was
	    taken down while multiple simultaneous operations were
	    performed on it. </dd>
</dl>
          <p>
	    Own Id: OTP-7267 Aux Id: OTP-7260 </p>
        </li>
        <li>
          <p>
	    ./configure has been improved to find 64-bit OpenSSL
	    libraries.</p>
          <p>
	    Own Id: OTP-7270</p>
        </li>
        <li>
          <p>
	    A terminating process could under very rare circumstances
	    trigger a bug which could crash the runtime system with
	    SMP support.</p>
          <p>
	    Own Id: OTP-7272</p>
        </li>
        <li>
          <p>
	    SCTP_ADDR_CONFIRMED events are now handled by gen_sctp.</p>
          <p>
	    Own Id: OTP-7276</p>
        </li>
        <li>
          <p>
	    binary_to_term/1 would crash the emulator if the binary
	    data contained an external fun with non-atom module
	    and/or function. Corrected to generate a badarg
	    exception.</p>
          <p>
	    Own Id: OTP-7281</p>
        </li>
        <li>
          <p>
	    On Mac OS 10.5 (Leopard), sending to socket which the
	    other end closes could cause the emulator to consume 100%
	    CPU time. (Thanks to Matthias Radestock.)</p>
          <p>
	    Own Id: OTP-7289</p>
        </li>
        <li>
          <p>
	    The vanilla driver used on Windows could crash the
	    emulator and sometimes produced corrupt files. The
	    vanilla driver is the driver that is used when one only
	    pass a filename as first argument to <span class="code">open_port/2</span>.
	    <strong>NOTE</strong>: This use of <span class="code">open_port/2</span> is
	    <strong>obsolete</strong>, and the documentation of this use has
	    previously been removed. The functionality is only
	    present for backward compatibility reasons and
	    <strong>will</strong> eventually be removed.</p>
          <p>
	    Own Id: OTP-7301</p>
        </li>
        <li>
          <p>
	    Faulty matching in binaries larger than 512Mb on 64bit
	    machines fixed.(On 32bit, the size limit for binaries is
	    still 512Mb). Thanks to Edwin Fine and Per Gustafsson for
	    finding fault and fix.</p>
          <p>
	    Own Id: OTP-7309</p>
        </li>
        <li>
          <p>
	    crypto:start() on Windows caused emulator to hang on
	    error popup window if openssl DLL was not found. Windows
	    error popups now suppressed.</p>
          <p>
	    Own Id: OTP-7325</p>
        </li>
        <li>
          <p>
	    Configuration option <span class="code">without-termcap</span> can be used to
	    disable the use of termcap libraries for terminal cursor
	    control in the shell.</p>
          <p>
	    Own Id: OTP-7338</p>
        </li>
        <li>
          <p>
	    to_erl reports its terminal window size to run_erl in
	    order to get output formatted accordingly</p>
          <p>
	    Own Id: OTP-7342</p>
        </li>
        <li>
          <p>
	    On Solaris, the <span class="code">compressed</span> option for file
	    operations did not work if the file descriptor happened
	    to be greater than 255 (a problem with fopen() and
	    friends in Solaris itself).</p>
          <p>
	    Own Id: OTP-7343 Aux Id: seq10949 </p>
        </li>
        <li>
          <p>
	    A race condition in the runtime system with SMP support
	    causing an erroneous removal of a newly created ets table
	    has been fixed.</p>
          <p>
	    The race occurred when a process removed a table during
	    termination simultaneously as another process removed the
	    same table via <span class="code">ets:delete/1</span> and a third process
	    created a table that accidentally got the same internal
	    table index as the table being removed.</p>
          <p>
	    Own Id: OTP-7349</p>
        </li>
        <li>
          <p>
	    <span class="code">zlib:inflate</span> failed when the size of the inflated
	    data was an exact multiple of the internal buffer size
	    (4000 bytes by default).</p>
          <p>
	    Own Id: OTP-7359</p>
        </li>
        <li>
          <p>
	    If the total number of allowed atoms is exceeded, there
	    will now be a controlled termination of the emulator with
	    a crash dump file. The emulator used to simply crash.
	    (Thanks Howard Yeh and Thomas Lindgren.)</p>
          <p>
	    Own Id: OTP-7372</p>
        </li>
        <li>
          <p>
	    The break handler in werl on Windows could cause the
	    emulator to hang or crash, that is now corrected.</p>
          <p>
	    Own Id: OTP-7394 Aux Id: seq10969 </p>
        </li>
        <li>
          <p>
	    The configure script now tests for an serious
	    optimization bug in gcc-4.3.0. If the bug is present, the
	    configure script will abort (if this happens, the only
	    way to build Erlang/OTP is to change to another version
	    of gcc). (Thanks to Mikael Pettersson.)</p>
          <p>
	    Own Id: OTP-7397</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    On Unix, the emulator now notices when the width of the
	    terminal has changed. (Thanks to Matthew Dempsky and
	    Patrick Mahoney.)</p>
          <p>
	    Own Id: OTP-7290</p>
        </li>
        <li>
          <p>
	    There is a new function <span class="code">init:stop/1</span> which can be
	    used to shutdown the system cleanly AND generate a
	    non-zero exit status or crash dump. (Thanks to Magnus
	    Froberg.)</p>
          <p>
	    Own Id: OTP-7308</p>
        </li>
        <li>
          <p>
	    process_info(Pid, garbage_collection) now returns more
	    information</p>
          <p>
	    Own Id: OTP-7311</p>
        </li>
        <li>
          <p>
	    The <span class="code">hide</span> option for <span class="code">open_port/2</span> is now
	    documented. (Thanks to Richard Carlsson.)</p>
          <p>
	    Own Id: OTP-7358</p>
        </li>
      </ul>
    


    <h4>Known Bugs and Problems</h4>
      <ul>
        <li>
          <p>
	    Floating point arithmetics in drivers can cause a runtime
	    system crash on runtime systems with floating point
	    exceptions enabled. Floating point exceptions are
	    disabled unless explicitly enabled or if hipe is enabled.</p>
          <p>
	    Own Id: OTP-7237</p>
        </li>
      </ul>
    




<h3><a name="id103050">1.29 
        Erts 5.6.2</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    The maximum length of an atom of 255 characters is now
	    strictly enforced. <span class="code">binary_to_term/1</span> will now fail
	    with a badarg if an encoded term contains an atom longer
	    than 255 characters. Atoms created by drivers will now be
	    truncated to 255 characters if necessary. (Thanks to
	    Matthew Dempsky.)</p>
          <p>
	    Own Id: OTP-7147</p>
        </li>
        <li>
          <p>
	    A bug in "bignum handling" on some 64bit architectures
	    could cause rem and div operations on large numbers to
	    hang indefinitely. Rem operations involving the smallest
	    negative number representable in 28 bits or 60 bits could
	    also cause access violation and emulator crash. Both
	    errors are corrected.</p>
          <p>
	    Own Id: OTP-7177</p>
        </li>
        <li>
          <p>
	    When doing the initial garbage collection after waking a
	    hibernated process, a fullsweep garbage collection was
	    unnecessarily triggered.</p>
          <p>
	    Own Id: OTP-7212</p>
        </li>
        <li>
	    <p>The beta testing module <span class="code">gen_sctp</span> now supports
	    active mode as stated in the documentation. Active mode
	    is still rather untested, and there are some issues about
	    what should be the right semantics for
	    <span class="code">gen_sctp:connect/5</span>. In particular: should it be
	    blocking or non-blocking or choosable. There is a high
	    probability it will change semantics in a (near) future
	    patch.</p> <p>Try it, give comments and send in bug
	    reports!</p>
          <p>
	    Own Id: OTP-7225</p>
        </li>
        <li>
          <p>
	    Invalid arguments to <span class="code">ets:update_counter/3</span> were not
	    handled correctly. A tuple position (<span class="code">Pos</span>) less
	    than 1 caused the element directly following the key to
	    be updated (as if no position at all had been specified).
	    All invalid values for <span class="code">Pos</span> will now fail with
	    <span class="code">badarg</span>.</p>
          <p>
	    Own Id: OTP-7226</p>
        </li>
        <li>
          <p>
	    The runtime system with SMP support could under rare
	    circumstances deadlock when a distribution channel was
	    taken down while multiple simultaneous operations were
	    performed on it.</p>
          <p>
	    Own Id: OTP-7260</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    More checksum/hash algorithms from the zlib library are
	    now available as built in functions (like md5 hashes has
	    been for a long time).</p>
          <p>
	    Own Id: OTP-7128</p>
        </li>
        <li>
          <p>
	    Minor improvements in the garbage collector.</p>
          <p>
	    Own Id: OTP-7139 Aux Id: OTP-7132 </p>
        </li>
        <li>
          <p>
	    The switch "-detached" to the windows werl program now
	    can create an erlang virtual machine without any main
	    window and without a temporary console showing.</p>
          <p>
	    Own Id: OTP-7142</p>
        </li>
        <li>
	    <p><span class="code">erlang:system_info/1</span> now accepts the
	    <span class="code">logical_processors</span>, and <span class="code">debug_compiled</span>
	    arguments. For more info see the, <span class="code">erlang(3)</span>
	    documentation.</p> <p>The scale factor returned by
	    <span class="code">test_server:timetrap_scale_factor/0</span> is now also
	    effected if the emulator uses a larger amount of
	    scheduler threads than the amount of logical processors
	    on the system. </p>
          <p>
	    Own Id: OTP-7175</p>
        </li>
        <li>
          <p>
	    A new BIF ets:update_element/3. To update individual
	    elements within an ets-tuple, without having to read,
	    update and write back the entire tuple.</p>
          <p>
	    Own Id: OTP-7200</p>
        </li>
        <li>
          <p>
	    A process executing the <span class="code">processes/0</span> BIF can now be
	    preempted by other processes during its execution. This
	    in order to disturb the rest of the system as little as
	    possible. The returned result is, of course, still a
	    consistent snapshot of existing processes at a time
	    during the call to <span class="code">processes/0</span>.</p>
          <p>
	    The documentation of the <span class="code">processes/0</span> BIF and the
	    <span class="code">is_process_alive/1</span> BIF have been updated in order
	    to clarify the difference between an existing process and
	    a process that is alive.</p>
          <p>
	    Own Id: OTP-7213</p>
        </li>
      </ul>
    




<h3><a name="id103306">1.30 
        Erts 5.6.1.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Not enough parameters were passed when sending an error
	    report in erl_check_io.c (Thanks to Matthew Dempsky).</p>
          <p>
	    Own Id: OTP-7176</p>
        </li>
        <li>
          <p>
	    In rare circumstances, complex binary matching code could
	    cause the emulator to crash or not match when it should.
	    (Thanks to Rory Byrne.)</p>
          <p>
	    Own Id: OTP-7198</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
	    <p>The <span class="code">{allocator_sizes, Alloc}</span> and
	    <span class="code">alloc_util_allocators</span> arguments are now accepted
	    by <span class="code">erlang:system_info/1</span>. For more information see
	    the <span class="code">erlang(3)</span> documentation.</p>
          <p>
	    Own Id: OTP-7167</p>
        </li>
        <li>
          <p>
	    The finishing reallocation of the heap block when
	    hibernating a process is now always moving the heap block
	    since it drastically reduces memory fragmentation when
	    hibernating large amounts of processes.</p>
          <p>
	    Own Id: OTP-7187</p>
        </li>
      </ul>
    



<h3><a name="id103401">1.31 
        Erts 5.6.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    The SMP emulator on sparc64 erroneously used the sparc32
	    atomic and the sparc32 spinlock implementations which
	    caused it to crash.</p>
          <p>
	    Own Id: OTP-7006</p>
        </li>
        <li>
          <p>
	    Call tracing the new guard BIFs <span class="code">byte_size</span>,
	    <span class="code">bit_size</span>, or <span class="code">tuple_size</span> and the loading a
	    module that uses one of those functions, could cause the
	    emulator to terminate.</p>
          <p>
	    Own Id: OTP-7008</p>
        </li>
        <li>
          <p>
	    configuring --enable-darwin-universal or
	    --enable-darwin-64bit on MacOSX could result in a non
	    optimized emulator. Top level configure script now
	    corrected.</p>
          <p>
	    Own Id: OTP-7014</p>
        </li>
        <li>
          <p>
	    configuring --with-gd did not produce correct include
	    flags for percept.</p>
          <p>
	    Own Id: OTP-7015</p>
        </li>
        <li>
          <p>
	    Environment variables weren't handled in thread safe
	    manner in the runtime system with SMP support on Windows.</p>
          <p>
	    <span class="code">erl_drv_putenv()</span>, and <span class="code">erl_drv_getenv()</span> has
	    been introduced for use in drivers. Do <strong>not</strong> use
	    putenv(), or getenv() directly in drivers. For more
	    information see the <span class="code">erl_driver</span> documentation.</p>
          <p>
	    Own Id: OTP-7035</p>
        </li>
        <li>
          <p>
	    HIPE: Corrected the choice of interface to the send/3 and
	    setnode/3 BIFs for native-compiled code. Using the
	    incorrect interface could, in unusual circumstances, lead
	    to random runtime errors.</p>
          <p>
	    Own Id: OTP-7067</p>
        </li>
        <li>
          <p>
	    Garbage collections could become extremely slow when
	    there were many keys in the process dictionary. (Thanks
	    to Fredrik Svahn.)</p>
          <p>
	    Own Id: OTP-7068</p>
        </li>
        <li>
          <p>
	    The duplicate documentation directory in the windows
	    installation is removed.</p>
          <p>
	    Own Id: OTP-7070</p>
        </li>
        <li>
	    <p>Documentation bugfixes and clarifications.</p> (Thanks
	    to Joern (opendev@gmail.com), Matthias Lang, and Richard
	    Carlsson.)
          <p>
	    Own Id: OTP-7079</p>
        </li>
        <li>
          <p>
	    The runtime system with SMP support <strong>not</strong> using
	    the native atomic integer implementation part of OTP
	    could deadlock when run on a system with more than one
	    logical processor. That is, only the runtime system with
	    SMP support on <strong>other</strong> hardware platforms than
	    x86, x86_64, sparc32, and powerpc32 were effected by this
	    bug.</p>
          <p>
	    Own Id: OTP-7080</p>
        </li>
        <li>
          <p>
	    The break handling code (run when Ctrl-C is hit) could
	    could potentially deadlock the runtime system with SMP
	    support.</p>
          <p>
	    Own Id: OTP-7104</p>
        </li>
        <li>
          <p>
	    The sctp driver has been updated to work against newer
	    lksctp packages e.g 1.0.7 that uses the API spelling
	    change adaption -&gt; adaptation. Older lksctp (1.0.6) still
	    work. The erlang API in gen_sctp.erl and inet_sctp.hrl
	    now spells 'adaptation' regardless of the underlying C
	    API.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7120</p>
        </li>
        <li>
	    <p>A bug in <span class="code">erlang:phash2/1</span> on 64-bit platforms
	    has been fixed. (Thanks to Scott Lystig Fritchie.)</p>
          <p>
	    Own Id: OTP-7127</p>
        </li>
        <li>
          <p>
	    The emulator could under rare circumstances crash while
	    garbage collecting.</p>
          <p>
	    Own Id: OTP-7132</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
	    <p>The documentation has been updated so as to reflect
	    the last updates of the Erlang shell as well as the minor
	    modifications of the control sequence <span class="code">p</span> of the
	    <span class="code">io_lib</span> module.</p> <p>Superfluous empty lines have
	    been removed from code examples and from Erlang shell
	    examples.</p>
          <p>
	    Own Id: OTP-6944 Aux Id: OTP-6554, OTP-6911 </p>
        </li>
        <li>
          <p>
	    Bit syntax construction with a small integer in a
	    non-byte aligned field wider than the CPU's word size
	    could cause garbage bits in the beginning of the field.</p>
          <p>
	    Own Id: OTP-7085</p>
        </li>
        <li>
          <p>
	    All Windows versions older than Windows 2000 are now
	    <strong>not supported</strong> by the Erlang runtime system. This
	    since there was a need for usage of features introduced
	    in Windows 2000.</p>
          <p>
	    Own Id: OTP-7086</p>
        </li>
        <li>
	    <p>Memory management improvements especially for the
	    runtime system with SMP support:</p> <ul> <li> The
	    runtime system with SMP support can now use multiple,
	    thread specific instances of most memory allocators. This
	    improves performance since it reduces lock contention in
	    the memory allocators. It may however increase memory
	    usage for some applications. The runtime system with SMP
	    support will by default enable this feature on most
	    allocators. The amount of instances used can be
	    configured. </li> <li> <span class="code">driver_alloc()</span>,
	    <span class="code">driver_realloc()</span>, and <span class="code">driver_free()</span> now use
	    their own erts specific memory allocator instead of the
	    default <span class="code">malloc()</span> implementation on the system.
	    </li> <li> The default configuration of some
	    allocators have been changed to fit applications that use
	    much memory better. </li> <li> Some new
	    <span class="code">erts_alloc</span> configuration parameters have been
	    added. </li> <li> <span class="code">erts_alloc_config</span> has been
	    modified to be able to create configurations suitable for
	    multiple instances of allocators. </li> <li> The
	    returned value from <span class="code">erlang:system_info({allocator,
	    Alloc})</span> has been changed. This since an allocator may
	    now run in multiple instances. </li> </ul> <p>If you
	    for some reason want the memory allocators to be
	    configured as before, you can pass the <span class="code">+Mea r11b</span>
	    command-line argument to <span class="code">erl</span>.</p> <p>For more
	    information see the <span class="code">erts_alloc(3)</span>, the
	    <span class="code">erts_alloc_config(3)</span>, and the <span class="code">erlang(3)</span>
	    documentation.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-7100</p>
        </li>
        <li>
          <p>
	    On Unix, denormalized floating point numbers could not be
	    created using <span class="code">list_to_float/1</span> or
	    <span class="code">binary_to_term/1</span>. (Thanks to Matthew Dempsky.)</p>
          <p>
	    Own Id: OTP-7122</p>
        </li>
        <li>
          <p>
	    Native atomic integers and spin-locks are now also
	    available for the runtime system with SMP support on
	    sparc64.</p>
          <p>
	    Own Id: OTP-7130</p>
        </li>
        <li>
          <p>
	    FP exceptions support for sparc64 userspace on Linux has
	    been added. Note that FP exception support is now turned
	    off by default, so to actually enable it you need to do
	    '<span class="code">./configure --enable-fp-exceptions</span>'.</p>
          <p>
	    Own Id: OTP-7131</p>
        </li>
      </ul>
    



<h3><a name="id103856">1.32 
        Erts 5.6</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    A bug for raw files when reading 0 bytes returning 'eof'
	    instead of empty data has been corrected.</p>
          <p>
	    Own Id: OTP-6291 Aux Id: OTP-6967 </p>
        </li>
        <li>
          <p>
	    All exported functions in gzio.c have now been renamed to
	    avoid conflict with drivers that are indirectly linked
	    with an external zlib library.</p>
          <p>
	    Own Id: OTP-6816 Aux Id: OTP-6591 </p>
        </li>
        <li>
          <p>
	    On the 64-bit Erlang emulator, bit syntax construction
	    with integers containing more than 60 bits ("big
	    numbers") into fields with more than 60 bits could
	    produce incorrect results.</p>
          <p>
	    Own Id: OTP-6833</p>
        </li>
        <li>
          <p>
	    When the runtime system failed to allocate memory for
	    binaries, it could dead lock while writing the
	    <span class="code">erl_crash.dump</span>.</p>
          <p>
	    Own Id: OTP-6848</p>
        </li>
        <li>
          <p>
	    The runtime system with SMP support could deadlock if a
	    process called the <span class="code">erlang:suspend_process(Pid)</span> BIF
	    or the <span class="code">erlang:garbage_collect(Pid)</span> BIF while the
	    process identified by <span class="code">Pid</span> was currently running
	    and the process calling the BIFs was terminated during
	    the call to the BIFs.</p>
          <p>
	    Processes suspending each other via the
	    <span class="code">erlang:suspend_process/1</span> BIF or garbage collecting
	    each other via the <span class="code">erlang:garbage_collect/1</span> BIF
	    could deadlock each other when the runtime system with
	    SMP support was used.</p>
          <p>
	    Own Id: OTP-6920</p>
        </li>
        <li>
          <p>
	    <span class="code">dbg</span> could leave traced processes in a suspended
	    state if the tracer process was killed with exit reason
	    <span class="code">kill</span>.</p>
          <p>
	    <span class="code">erlang:suspend_process/2</span> has been introduced which
	    accepts an option list as second argument. For more
	    information see the <span class="code">erlang(3)</span> documentation.</p>
          <p>
	    Processes suspended via
	    <span class="code">erlang:suspend_process/[1,2]</span> will now be
	    automatically resumed if the process that called
	    <span class="code">erlang:suspend_process/[1,2]</span> terminates.</p>
          <p>
	    Processes could previously be suspended by one process
	    and resumed by another unless someone was tracing the
	    suspendee. This is <strong>not</strong> possible anymore. The
	    process resuming a process <strong>has</strong> to be the one
	    that suspended it.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-6946</p>
        </li>
        <li>
	    <p>file:write_file/3, file:write/2 and file:read/2 could
	    crash (contrary to documentation) for odd enough file
	    system problems, e.g write to full file system. This bug
	    has now been corrected.</p> <p>In this process the file
	    module has been rewritten to produce better error codes.
	    Posix error codes now originate from the OS file system
	    calls or are generated only for very similar causes (for
	    example 'enomem' is generated if a memory allocation
	    fails, and 'einval' is generated if the file handle in
	    Erlang is a file handle but currently invalid).</p>
	    <p>More Erlang-ish error codes are now generated. For
	    example <span class="code">{error,badarg}</span> is now returned from
	    <span class="code">file:close/1</span> if the argument is not of a file
	    handle type. See file(3).</p> <p>The possibility to write
	    a single byte using <span class="code">file:write/2</span> instead of a list
	    or binary of one byte, contradictory to the
	    documentation, has been removed.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-6967 Aux Id: OTP-6597 OTP-6291 </p>
        </li>
        <li>
          <p>
	    Monitor messages produced by the system monitor
	    functionality, and garbage collect trace messages could
	    contain erroneous heap and/or stack sizes when the actual
	    heaps and/or stacks were huge.</p>
          <p>
	    As of erts version 5.6 the <span class="code">large_heap</span> option to
	    <span class="code">erlang:system_monitor/[1,2]</span> has been modified. The
	    monitor message is sent if the sum of the sizes of all
	    memory blocks allocated for all heap generations is equal
	    to or larger than the specified size. Previously the
	    monitor message was sent if the memory block allocated
	    for the youngest generation was equal to or larger than
	    the specified size.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-6974 Aux Id: seq10796 </p>
        </li>
        <li>
          <p>
            <span class="code">inet:getopts/2</span> returned random values on Windows
            Vista.</p>
          <p>
            Own Id: OTP-7003</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    The emulator internal process lock implementation has
	    been rewritten and optimized. A slight risk of starvation
	    existed in the previous implementation. This risk has
	    also been eliminated in the new implementation.</p>
          <p>
	    Own Id: OTP-6500</p>
        </li>
        <li>
          <p>
	    Bitstrings (bit-level) binaries and binary comprehensions
	    are now part of the language. See the Reference Manual.</p>
          <p>
	    Own Id: OTP-6558</p>
        </li>
        <li>
          <p>
	    The windows version of erlang now has SMP support. The
	    SMP emulator is run by default on machines which shows
	    more than one virtual or physical processor.</p>
          <p>
	    Own Id: OTP-6560 Aux Id: OTP-6925 </p>
        </li>
        <li>
          <p>
	    The details of the compressed term format has been
	    documented in erl_ext_dist.txt. (Thanks to Daniel
	    Goertzen.)</p>
          <p>
	    Own Id: OTP-6755</p>
        </li>
        <li>
          <p>
	    The runtime system with SMP support is now started by
	    default if more than one logical processor are detected.
	    For more information, see the <span class="code">erl(3)</span>
	    documentation.</p>
          <p>
	    Own Id: OTP-6756</p>
        </li>
        <li>
          <p>
	    The external format for Erlang terms and the distribution
	    protocol are now documented in ERTS User's Guide.</p>
          <p>
	    Own Id: OTP-6779</p>
        </li>
        <li>
          <p>
	    New BIF's erlang:system_profile/1 and
	    erlang:system_profile/2. These BIF's controls concurrency
	    profiling options for processes, ports and schedulers.</p>
          <p>
	    Own Id: OTP-6783 Aux Id: OTP-6285 </p>
        </li>
        <li>
          <p>
	    The <span class="code">ErlDrvTermData</span> term types used by
	    <span class="code">driver_output_term()</span> and <span class="code">driver_send_term()</span>
	    have been extended with the term types
	    <span class="code">ERL_DRV_BUF2BINARY</span>, <span class="code">ERL_DRV_EXT2TERM</span>, and
	    <span class="code">ERL_DRV_UINT</span>. <span class="code">ERL_DRV_BUF2BINARY</span> is used
	    for passing and creating a binary,
	    <span class="code">ERL_DRV_EXT2TERM</span> is used for passing terms encoded
	    with the external term format, and <span class="code">ERL_DRV_UINT</span> is
	    used for passing unsigned integers.</p>
          <p>
	    Also the data types <span class="code">ErlDrvUInt</span> and
	    <span class="code">ErlDrvSInt</span> have been added which makes it more
	    obvious how arguments to term types are interpreted with
	    regards to width and signedness.</p>
          <p>
	    The incorrect data types <span class="code">ErlDriverTerm</span>,
	    <span class="code">ErlDriverBinary</span>, and <span class="code">ErlDriverPort</span> in the
	    <span class="code">erl_driver(3)</span> documentation have been replaced
	    with the correct data types <span class="code">ErlDrvTermData</span>,
	    <span class="code">ErlDrvBinary</span>, and <span class="code">ErlDrvPort</span>.</p>
          <p>
	    For more information see the <span class="code">erl_driver(3)</span>
	    documentation.</p>
          <p>
	    Own Id: OTP-6823</p>
        </li>
        <li>
          <p>
	    Miscellaneous improvements of the erts internal thread
	    library.</p>
          <p>
	    It now support optimized atomic operations and spin-locks
	    on windows.</p>
          <p>
	    Fall-backs based on mutexes and/or spin-locks for missing
	    optimized atomic operations, spin-locks, or rwlocks has
	    been implemented. This makes it possible to compile the
	    runtime system with SMP support on a lot more platforms.</p>
          <p>
	    Default stack size on OpenBSD has been increased to 256
	    kilo-words.</p>
          <p>
	    Own Id: OTP-6831 Aux Id: OTP-6560 </p>
        </li>
        <li>
	    <p>Many bit syntax operations, both construction and
	    matching, are faster. For further information, see the
	    Efficiency Guide.</p>
          <p>
	    Own Id: OTP-6838</p>
        </li>
        <li>
	    <p>Literal lists, tuples, and binaries are no longer
	    constructed at run-time as they used to be, but are
	    stored in a per-module constant pool. Literals that are
	    used more than once are stored only once.</p>
	    <p>This is not a change to the language, only in the
	    details of its implementation. Therefore, the
	    implications of this change is described in the
	    Efficiency Guide.</p>
	    <p>Example 1: In the expression <span class="code">element(BitNum-1,
	    {1,2,4,8,16,32,64,128})</span>, the tuple used to be
	    constructed every time the expression was executed, which
	    could be detrimental to performance in two ways if the
	    expression was executed in a loop: the time to build the
	    tuple itself and the time spent in garbage collections
	    because the heap filled up with garbage faster.</p>
	    <p>Example 2: Literal strings, such as <span class="code">"abc"</span>, used
	    to be stored in the compiled code compactly as a byte
	    string and expanded to a list at run-time. Now all
	    strings will be stored expanded to lists (such as
	    <span class="code">[$a,$b,$c]</span>) in the constant pool. That means that
	    the string will be faster to use at run-time, but that it
	    will require more space even when not used. If space is
	    an issue, you might want to use binary literals (that is,
	    <span class="code">&lt;&lt;"abc"&gt;&gt;</span>) instead of string literals for
	    infrequently used long strings (such as error
	    messages).</p>
          <p>
	    Own Id: OTP-6850</p>
        </li>
        <li>
	    <p>The Erlang driver API has been extended with a
	    portable POSIX thread like API for multi-threading. The
	    Erlang driver thread API provides:</p> <ul>
	    <li>Threads</li> <li>Mutexes</li> <li>Condition
	    variables</li> <li>Read/Write locks</li>
	    <li>Thread specific data</li> </ul> <p>For more
	    information see the <span class="code">erl_driver(3)</span>
	    documentation.</p>
          <p>
	    Own Id: OTP-6857</p>
        </li>
        <li>
          <p>
	    Recursive calls now usually consume less stack than in
	    R11B. See the Efficiency Guide.</p>
          <p>
	    Own Id: OTP-6862 Aux Id: seq10746 </p>
        </li>
        <li>
          <p>
	    The deprecated BIFs <span class="code">erlang:old_binary_to_term/1</span>
	    and <span class="code">erlang:info/1</span> have been removed.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-6876</p>
        </li>
        <li>
          <p>
	    Calls to driver call-backs triggered by external events
	    are now scheduled and interleaved with execution of
	    Erlang processes also on the runtime system without SMP
	    support.</p>
          <p>
	    Own Id: OTP-6878</p>
        </li>
        <li>
          <p>
	    Faster arithmetic of integers of more than 27 bits signed
	    (or 60 bits signed on an 64-bit CPU), and also faster
	    integer multiplication. (Thanks to Tony Rogvall.)</p>
          <p>
	    Own Id: OTP-6891</p>
        </li>
        <li>
	    <p>Significant improvements of the <span class="code">process_info</span>
	    BIFs:</p> <ul> <li> <span class="code">process_info/2</span> can now be
	    called with a list of items as second argument in order
	    to atomically retrieve information about multiple items.
	    </li> <li> <span class="code">process_info/[1,2]</span> has been
	    optimized in the runtime system with SMP support. The
	    whole scheduler could previously be blocked for a
	    significant period of time in <span class="code">process_info/[1,2]</span>
	    waiting for a lock on the process being inspected. The
	    Erlang process calling <span class="code">process_info/[1,2]</span> can
	    still be blocked for a significant period of time waiting
	    for the lock, but the scheduler will now be able to run
	    other processes while the process calling
	    <span class="code">process_info/[1,2]</span> waits for the lock. </li>
	    <li> <span class="code">process_info/2</span> now accept a few more items
	    than before. </li> <li> The documentation of
	    <span class="code">process_info/[1,2]</span> has been improved. </li>
	    </ul> <p>For more information see the <span class="code">erlang(3)</span>
	    documentation.</p>
          <p>
	    Own Id: OTP-6899</p>
        </li>
        <li>
          <p>
	    <span class="code">open_port({}, [])</span> could crash the emulator.
	    (Thanks to Matthew Dempsky.)</p>
          <p>
	    Own Id: OTP-6901</p>
        </li>
        <li>
	    <p>Two new guard BIFs have been introduced as a
	    recommended replacement for <span class="code">size/1</span>. (The
	    <span class="code">size/1</span> BIF will be removed no earlier than in
	    R14B.) The BIFs are <span class="code">tuple_size/1</span> to calculate the
	    size of a tuple and <span class="code">byte_size/1</span> to calculate the
	    number of bytes needed for the contents of the binary or
	    bitstring (rounded up to the nearest number of bytes if
	    necessary).</p>
	    <p>There is also a new <span class="code">bit_size/1</span> BIF that returns
	    the exact number of bits that a binary or bitstring
	    contains.</p>
          <p>
	    Own Id: OTP-6902</p>
        </li>
        <li>
	    <p>The <span class="code">ets:fixtable/2</span> function, which has been
	    deprecated for several releases, has been removed.</p>
	    <p>The <span class="code">ets:info/1</span> function has been reimplemented
	    as a BIF, which guarantees that information returned is
	    consistent.</p>
	    <p>The <span class="code">ets:info/2</span> function now fails with reason
	    <span class="code">badarg</span> if the second argument is invalid.
	    (Dialyzer can be used to find buggy code where the second
	    argument is misspelled.)</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-6906</p>
        </li>
        <li>
          <p>
	    As the linux kernel may generate a minor fault when
	    tracing with CPU timestamps, and there exists no patch to
	    the Linux kernel that fixes the problem, cpu timestamps
	    are disabled on Linux for now.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-6922</p>
        </li>
        <li>
	    <p>The functions io:columns/0, io:columns/1, io:rows/0
	    and io:rows/1 are added to allow the user to get
	    information about the terminal geometry. The shell takes
	    some advantage of this when formatting output. For
	    regular files and other io-devices where height and width
	    are not applicable, the functions return
	    {error,enotsup}.</p>
	    <p>Potential incompatibility: If one has written a custom
	    io-handler, the handler has to either return an error or
	    take care of io-requests regarding terminal height and
	    width. Usually that is no problem as io-handlers, as a
	    rule of thumb, should give an error reply when receiving
	    unknown io-requests, instead of crashing.</p>
          <p>
	    *** POTENTIAL INCOMPATIBILITY ***</p>
          <p>
	    Own Id: OTP-6933</p>
        </li>
        <li>
          <p>
	    <span class="code">driver_caller()</span> can now also be used from the
	    <span class="code">start</span> callback of a driver.</p>
          <p>
	    Own Id: OTP-6951</p>
        </li>
        <li>
          <p>
	    The emulator can now be compiled for 64bit intel, as well
	    as a 32bit universal binary on darwin/MacOSX 10.4 and
	    10.5.</p>
          <p>
	    Own Id: OTP-6961</p>
        </li>
        <li>
          <p>
	    If <span class="code">open_port</span> fails because all available ports are
	    already in use, it will now throw a <span class="code">system_limit</span>
	    exception instead of an <span class="code">enfile</span> exception.
	    (<span class="code">enfile</span> might still be thrown if the operating
	    system would return ENFILE.)</p>
          <p>
	    Own Id: OTP-6968</p>
        </li>
        <li>
          <p>
	    The <span class="code">spawn_monitor/1</span> and <span class="code">spawn_monitor/3</span> BIFs
	    are now auto-imported (i.e. they no longer need an
	    <span class="code">erlang:</span> prefix).</p>
          <p>
	    Own Id: OTP-6975</p>
        </li>
        <li>
          <p>
	    On Windows, the werl window now handles resize, so that
	    the whole window can be utilized. Text selection is also
	    updated to be line oriented instead of rectangle oriented
	    as in earlier versions.</p>
          <p>
	    Own Id: OTP-6994 Aux Id: OTP-6933 </p>
        </li>
        <li>
          <p>
	    Kqueue support (kernel-poll) has been enabled on FreeBSD.
	    The problem with kqueue not detecting writes on a pipe on
	    FreeBSD was actually not a kqueue issue, but a writev on
	    pipes issue. Neither poll(), nor select() detected the
	    write when the bug hit. NetBSD and DragonFlyBSD probably
	    have or have had the same bug. This bug should have been
	    fixed in FreeBSD 6.3 and FreeBSD 7.0 thanks to
	    Jean-Sebastien Pedron.</p>
          <p>
	    Own Id: OTP-7001</p>
        </li>
      </ul>
    




<h3><a name="id104822">1.33 
        Erts 5.5.5.5</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Hanging writes on temporarily unavailable NFS
	    filesystems could cause the execution of (not file
	    related) erlang code to get blocked even though I/O
	    threads were used. This is now corrected.</p>
          <p>
	    Own Id: OTP-6907 Aux Id: seq10771 </p>
        </li>
      </ul>
    



<h3><a name="id104854">1.34 
        Erts 5.5.5.4</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    Data passed to a driver via <span class="code">erlang:port_call</span> could
	    be corrupted when the runtime system with SMP support was
	    used. (Thanks to YAMASHINA Hio.)</p>
          <p>
	    Own Id: OTP-6879</p>
        </li>
        <li>
          <p>
	    In the SMP emulator, if several processes called
	    ets:update_counter/3 (even for different tables) when the
	    counter values exceeded 27 bits, the counter values could
	    be corrupted or the emulator could crash.</p>
          <p>
	    Own Id: OTP-6880 Aux Id: seq10760 </p>
        </li>
      </ul>
    




<h3><a name="id104901">1.35 
        Erts 5.5.5.3</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
	    <p>Creating a named table using <span class="code">ets:new/2</span> or
	    renaming a named table using <span class="code">ets:rename/2</span> could in
	    rare circumstances succeed, meaning that there would be
	    two or more tables with the same name. Now such call will
	    fail with a <span class="code">badarg</span> exception as it is supposed to
	    do.</p>
	    <p><span class="code">ets:delete/1</span> used on a named table now removes
	    the name immediately so that a new table with the same
	    name can be created.</p>
	    <p>Turning on call trace on the internal BIF that
	    implements <span class="code">ets:delete/1</span> would crash the
	    emulator.</p>
	    <p>SMP emulator only: Using <span class="code">ets:rename/2</span> on a
	    table that <span class="code">ets:safe_fixtable/2</span> has been used on
	    could cause an emulator crash or undefined behaviour
	    because of a missing lock.</p>
          <p>
	    Own Id: OTP-6872 Aux Id: seq10756, seq10757 </p>
        </li>
      </ul>
    



<h3><a name="id104971">1.36 
        Erts 5.5.5.2</a></h3>

    <h4>Known Bugs and Problems</h4>
      <ul>
        <li>
          <p>
	    ets:select/3 on ordered_set and with a chunksize a
	    multiple of 1000 gave all elements instead of just 1000.
	    Also ets:slot/2 on ordered set could give unexpected
	    results on SMP emulator. Both problems are corrected.</p>
          <p>
	    Own Id: OTP-6842</p>
        </li>
      </ul>
    



<h3><a name="id105003">1.37 
        Erts 5.5.5.1</a></h3>

    <h4>Fixed Bugs and Malfunctions</h4>
      <ul>
        <li>
          <p>
	    All exported functions in gzio.c have now been renamed to
	    avoid conflict with drivers that are indirectly linked
	    with an external zlib library.</p>
          <p>
	    Own Id: OTP-6816 Aux Id: OTP-6591 </p>
        </li>
        <li>
          <p>
	    Calling binary_to_term/1 with certain invalid binaries
	    would crash the emulator.</p>
          <p>
	    Own Id: OTP-6817</p>
        </li>
      </ul>
    


    <h4>Improvements and New Features</h4>
      <ul>
        <li>
          <p>
	    Restored speed of bit-syntax matching of 32 bits
	    integers.</p>
          <p>
	    Own Id: OTP-6789 Aux Id: seq10688 </p>
        </li>
      </ul>
    



  <h3><a name="id105071">1.38 
        Erts 5.5.5</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>The functions in gzio.c have been renamed to avoid
            conflict with drivers that indirectly linked with an
            external zlib library.</p>
          <p>Own Id: OTP-6591</p>
        </li>
        <li>
          <p>The emulator without SMP support dumped core if an
            async-thread finished a job after the emulator had begun
            writing an <span class="code">erl_crash.dump</span>. </p>
          <p>Own Id: OTP-6685</p>
        </li>
        <li>
          <p>In bit syntax matching, integer fields with greater
            size than 16Mb would fail to match. (Thanks to Bertil
            Karlsson and Francesco Pierfederici.)</p>
          <p>Matching out a 32-bit integer not aligned on a byte
            boundary from a binary could cause an heap overflow (and
            subsequent termination of the emulator).</p>
          <p>A module that contained bit syntax construction with a
            literal field size greater than 16Mb would fail to
            load.</p>
          <p>Several other similar bugs having to do with huge
            field sizes were eliminated.</p>
          <p>Attempting to construct a binary longer than 536870911
            bytes will now fail with a <span class="code">system_limit</span> exception
            (rather than fail in mysterious ways or construct an
            binary with incorrect contents). Similarily, attempting
            to match a binary longer than 536870911 bytes will now
            fail (instead of producing an incorrect result). This
            limitation has been documented in the Efficiency Guide.
            (The limit is in the 32-bit emulator; use the 64-bit
            emulator if you need to handle larger binaries than
            536870911.)</p>
          <p>Own Id: OTP-6686</p>
        </li>
        <li>
          <p>Bugs in rem and div of very large numbers are corrected.</p>
          <p>Own Id: OTP-6692</p>
        </li>
        <li>
          <p><span class="code">erlang:system_info({allocator, Alloc})</span> didn't
            allocate enough heap when a bignum was part of the result
            which could cause an emulator crash.</p>
          <p>Own Id: OTP-6693</p>
        </li>
        <li>
          <p>It was previously not possible to pass
            <span class="code">erts_alloc</span> the same configuration via the
            command-line, as used by default. </p>
          <p>A <span class="code">+M*</span> command-line argument that configure a
            size of some sort can now be passed a value that equals
            the size of the address space. The value used, in this
            case, will be <span class="code">"the size of the address space" - 1</span>.</p>
          <p>Own Id: OTP-6699</p>
        </li>
        <li>
          <p><span class="code">SysIOVec* driver_peekq(ErlDrvPort port, int *vlen)</span> did not update <span class="code">*vlen</span> if <span class="code">port</span> was
            invalid. <span class="code">*vlen</span> is now set to <span class="code">-1</span> if the
            <span class="code">port</span> is invalid.</p>
          <p>The <span class="code">efile</span> driver
            expects <span class="code">*vlen</span> to be updated also when the
            <span class="code">port</span> is invalid. This situation occurs seldom, but
            when the runtime system has async-threads enabled and
            ports are killed it can. When it occurred the runtime
            system crashed.</p>
          <p>Own Id: OTP-6729</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>For scripts written using <span class="code">escript</span>, there is a new
            function <span class="code">escript:script_name/0</span>, which can be used
            to retrieve the pathame of the script. The documentation
            has been clarified regarding pre-defined macros such as
            ?MODULE and the module name.</p>
          <p>Own Id: OTP-6593</p>
        </li>
        <li>
          <p>The section Guards in the chapter The Abstract Format
            of the ERTS User's Guide has been updated.</p>
          <p>Own Id: OTP-6600</p>
        </li>
        <li>
          <p>Corrected protocol layer flue for socket options
            SO_LINGER, SO_SNDBUF and SO_RCVBUF, for SCTP.</p>
          <p>Own Id: OTP-6625 Aux Id: OTP-6336 </p>
        </li>
        <li>
          <p>The behaviour of the inet option {active,once} on peer
            close is improved and documented.</p>
          <p>Own Id: OTP-6681</p>
        </li>
        <li>
          <p>The inet option send_timeout for connection oriented
            sockets is added to allow for timeouts in communicating
            send requests to the underlying TCP stack.</p>
          <p>Own Id: OTP-6684 Aux Id: seq10637 OTP-6681 </p>
        </li>
        <li>
          <p>The command line flag <span class="code">-args_file FileName</span>, and
            the environment variables <span class="code">ERL_AFLAGS</span>, and
            <span class="code">ERL_ZFLAGS</span> for the <span class="code">erl</span> command have been
            added. For more information see the <span class="code">erl(1)</span>
            documentation.</p>
          <p>Own Id: OTP-6697</p>
        </li>
        <li>
          <p>The <span class="code">is_constant/1</span> type test has been deprecated.
            <span class="code">is_constant/1</span> is improperly named and almost
            entirely undocumented.</p>
          <p>Own Id: OTP-6731</p>
        </li>
      </ul>
    
  

  <h3><a name="id105396">1.39 
        Erts 5.5.4.3</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p><span class="code">process_flag(trap_exit, Bad)</span> where <span class="code">Bad</span>
            was a term not equal to <span class="code">true</span> or <span class="code">false</span>,
            didn't fail with <span class="code">badarg</span> as it should; instead, the
            failure was silently ignored. This bug was introduced in
            <span class="code">erts-5.5.2</span>.</p>
          <p>Own Id: OTP-6627 Aux Id: OTP-6160 </p>
        </li>
        <li>
          <p>The minimum and default stack size for async-threads has
            been increased to 16 kilowords. This since the previous
            minimum and default stack size of 8 kilowords proved to
            be too small (introduced in <span class="code">erts-5.5.4.2</span>).</p>
          <p>Own Id: OTP-6628 Aux Id: OTP-6580, Seq10633 </p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>process_flag/2 accepts the new flag <span class="code">sensitive</span>.</p>
          <p>Own Id: OTP-6592 Aux Id: seq10555 </p>
        </li>
      </ul>
    
  

  <h3><a name="id105497">1.40 
        Erts 5.5.4.2</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>When a port steals control over a file descriptor from
            another port, the stealing port tests if the other port
            is alive. This in order to be able to give an accurate
            error message. In the runtime system with SMP support,
            this test was done without appropriate locks held. This
            could in worst case lead to an erroneous error message;
            therefore, this bug is to be considered harmless.</p>
          <p>Own Id: OTP-6602</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The default stack size for threads in the async-thread
            pool has been shrunk to 8 kilowords, i.e., 32 KB on
            32-bit architectures. This small default size has been
            chosen since the amount of async-threads might be quite
            large. The default stack size is enough for drivers
            delivered with Erlang/OTP, but might not be sufficiently
            large for other dynamically linked in drivers that use
            the <span class="code">driver_async()</span> functionality. A suggested
            stack size for threads in the async-thread pool can be
            configured via the <span class="code">+a</span> command line argument of
            <span class="code">erl(1)</span>.</p>
          <p>*** POTENTIAL INCOMPATIBILITY ***</p>
          <p>Own Id: OTP-6580</p>
        </li>
      </ul>
    
  

  <h3><a name="id105577">1.41 
        Erts 5.5.4.1</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Setting the time on the system while using heart on a
            linux machine where the emulator was built with
            clock_gettime support (default from Linux 2.6/erts-5.5.4
            and upwards), could make the heart command fire. This was
            due to bug in the heart executable which is now
            corrected.</p>
          <p>Own Id: OTP-6598 Aux Id: seq10614 </p>
        </li>
      </ul>
    
  

  <h3><a name="id105612">1.42 
        Erts 5.5.4</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Corrected misspelling of '<span class="code">-pz</span>' in the help text
            for <span class="code">erlc</span>. (Thanks to Ulf Wiger.)</p>
          <p>Own Id: OTP-6433</p>
        </li>
        <li>
          <p>The MD5 calculation of a BEAM file done by
            <span class="code">code:module_md5/1</span>, <span class="code">beam_lib:md5/1</span>, and by
            the compiler for the default value of the <span class="code">vsn</span>
            attribute have all been changed so that its result will
            be the same on all platforms; modules containing funs
            could get different MD5s on different platforms.</p>
          <p>Own Id: OTP-6459</p>
        </li>
        <li>
          <p>The emulator could dump core while writing an
            <span class="code">erl_crash.dump</span> file if there were funs with a
            large terms in its environment. Since there is no way to
            inspect a fun's environment in the crashdump_viewer
            application anyway, a variables in the environment are
            now set to [] before dumping the fun. (Thanks to
            Jean-Sebastien Pedron.)</p>
          <p>Own Id: OTP-6504</p>
        </li>
        <li>
          <p><span class="code">{Port, {exit_status, S}}</span> messages from ports
            opened with the <span class="code">exit_status</span> option could under
            rare circumstances be delayed. This bug was present on
            Erlang runtime systems without SMP support on all unix
            operating systems other than SunOS.</p>
          <p>Own Id: OTP-6528</p>
        </li>
        <li>
          <p>A bug in linuxthreads could cause the emulator to dump
            core when dlerror() was called before the first call to
            dlopen(). As a workaround the emulator always makes a
            call to dlopen() on initialization when linuxthreads is
            used as thread library.</p>
          <p>Own Id: OTP-6530</p>
        </li>
        <li>
          <p>file:sync/1 did not do anything on Windows. Now it calls
            the system function for flushing buffers
            (FlushFileBuffers()). (Thanks to Matthew Sackman.)</p>
          <p>Own Id: OTP-6531</p>
        </li>
        <li>
          <p><span class="code">open_port/2</span> could on the runtime system with SMP
            support fail with the wrong exit reason when a port
            couldn't be created. When this happened the exit reason
            was typically <span class="code">eintr</span>, or <span class="code">ebusy</span> instead of
            <span class="code">eagain</span>.</p>
          <p>Own Id: OTP-6536</p>
        </li>
        <li>
          <p>The file driver (efile_drv) did not flush data written
            using the option 'delayed_write' after the set timeout
            time, rather at the next file operation. This bug has now
            been corrected.</p>
          <p>Own Id: OTP-6538</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>An interface towards the SCTP Socket API Extensions
            has been implemented.It is an Open Source patch courtesy
            of Serge Aleynikov and Leonid Timochouk. The Erlang code
            parts has been adapted by the OTP team, changing the
            Erlang API somewhat.</p>
          <p>The Erlang interface consists of the module
            <span class="code">gen_sctp</span> and an include file
            <span class="code">-include_lib("kernel/include/inet_sctp.hrl").</span> for
            option record definitions. The <span class="code">gen_sctp</span> module is
            documented.</p>
          <p>The delivered Open Source patch, before the OTP team
            rewrites, was written according to
            http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13
            and was claimed to work fine, tested on Linux Fedora Core
            5.0 (kernel 2.6.15-2054 or later) and on Solaris 10 and
            11. The OTP team rewrites used the same standard document
            but might have accidentally broken some functionality. If
            so it will soon be patched to working state. The tricky
            parts in C and the general design has essentially not
            changed. During the rewrites the code was hand tested on
            SuSE Linux Enterprise Server 10, and briefly on Solaris
            10. Feedbach on code and docs is very much
            appreciated.</p>
          <p>The SCTP interface is in beta state. It has only been
            hand tested and has no automatic test suites in OPT
            meaning everything is most certainly not tested. Socket
            active mode is broken. IPv6 is not tested. The
            documentation has been reworked due to the API changes,
            but has not been proofread after this.</p>
          <p>Thank you from the OTP team to Serge Aleynikov and
            Leonid Timochouk for a valuable contribution. We hope we
            have not messed it up too much.</p>
          <p>Own Id: OTP-6336</p>
        </li>
        <li>
          <p>A <span class="code">{minor_version,Version}</span> option is now recognized
            by <span class="code">term_to_binary/2</span>. {minor_version,1} will cause
            floats to be encoded in an exact and more space-efficient
            way compared to the previous encoding.</p>
          <p>Own Id: OTP-6434</p>
        </li>
        <li>
          <p>There is a new <span class="code">escript</span> program that can be used
            for writing scripts in Erlang. Erlang scripts don't need
            to be compiled and any arguments can be passed to them
            without risk that they are interpreted by the Erlang
            system.</p>
          <p>Own Id: OTP-6505</p>
        </li>
        <li>
          <p>Setting and getting socket options in a "raw" fashion is
            now allowed. Using this feature will inevitably produce
            non portable code, but will allow setting ang getting
            arbitrary uncommon options on TCP stacks that do have
            them.</p>
          <p>Own Id: OTP-6519</p>
        </li>
        <li>
          <p>Miscellaneous signal handling improvements on the Erlang
            runtime system with SMP support.</p>
          <p>The fallback implementation of spin locks and atomic
            operations are now implemented using pthread spin locks
            when pthread spin locks are found on the system.</p>
          <p>The Erlang runtime system with SMP support can now run on
            Linux systems that has Linuxthreads instead of NPTL
            (Native POSIX Thread Library). Note that the SMP support
            hasn't been as thoroughly tested with Linuxthreads as
            with NPTL. A runtime system with SMP support will
            therefore not be built by default on Linux when NPTL
            isn't found. In order to force a build of the runtime
            system with SMP support, pass <span class="code">--enable-smp-support</span>
            to <span class="code">configure</span> when building OTP.</p>
          <p>Own Id: OTP-6525</p>
        </li>
      </ul>
    
  

  <h3><a name="id105927">1.43 
        Erts 5.5.3.1</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p><span class="code">erlang:system_flag(multi_scheduling, block)</span> could
            cause the emulator with SMP support to deadlock.</p>
          <p>Own Id: OTP-6431 Aux Id: OTP-6403 </p>
        </li>
        <li>
          <p>The runtime system with SMP support failed to call the
            driver timeout callback of ports in state closing. This
            could cause ports to fail flushing their I/O queues.</p>
          <p>Own Id: OTP-6432</p>
        </li>
        <li>
          <p>The <span class="code">{Port, closed}</span> message from a closed port
            could arrive at the port owner before <span class="code">Port</span> had
            been removed from the result of <span class="code">erlang:ports/0</span> in
            the runtime system with SMP support.</p>
          <p>Own Id: OTP-6437</p>
        </li>
        <li>
          <p>The async id of async jobs created via
            <span class="code">driver_async</span> wasn't created in a thread safe
            manner in the runtime system with SMP support. This could
            in worst case cause <span class="code">driver_async_cancel()</span> to
            cancel another async job than intended.</p>
          <p>Own Id: OTP-6438</p>
        </li>
        <li>
          <p>Under rare circumstances a terminating connection between
            two nodes could cause an instantaneous reconnect between
            the two nodes to fail on the runtime system with SMP
            support.</p>
          <p>Own Id: OTP-6447</p>
        </li>
        <li>
          <p>In the documentation of the driver entry field
            <span class="code">extended_marker</span> of erts version 5.5.3
            (<span class="code">driver_entry(3)</span>), the following is stated: "The
            following fields are ignored if this field is equal to
            <span class="code">0</span>". This is a documentation bug and has been
            changed to: "If this field is equal to <span class="code">0</span>, all the
            fields following this field also <strong>have</strong> to be
            <span class="code">0</span>, or <span class="code">NULL</span> in case it is a pointer field".</p>
          <p>The runtime check for detection of old incompatible
            drivers made when loading drivers has been improved. The
            emulator can, however, not make sure that a driver that
            doesn't use the extended driver interface isn't
            incompatible. Therefore, when loading a driver that
            doesn't use the extended driver interface, there is a
            risk that it will be loaded also when the driver is
            incompatible. When the driver use the extended driver
            interface, the emulator can verify that it isn't of an
            incompatible driver version. You are therefore advised to
            use the extended driver interface.</p>
          <p>For more information see the <span class="code">erl_driver(3)</span> and
            <span class="code">driver_entry(3)</span> documentation.</p>
          <p>Own Id: OTP-6452 Aux Id: OTP-6330 </p>
        </li>
        <li>
          <p>When terminating ports on the runtime system with SMP
            support, removal of links to processes was done without
            locking the link lock on processes. This could cause an
            emulator crash.</p>
          <p>Own Id: OTP-6475</p>
        </li>
        <li>
          <p>The emulator with SMP support could crash when a port
            flushed its I/O queue by calling <span class="code">driver_async()</span>
            from the timeout driver callback.</p>
          <p>Own Id: OTP-6479</p>
        </li>
        <li>
          <p>Large exit reasons could under rare circumstances cause
            the runtime system with SMP support to crash.</p>
          <p>Own Id: OTP-6521</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>Faster system calls for keeping the time accurate are
            used on newer Linux kernels, which can result in a
            significant speed-up of the emulator on those systems.</p>
          <p>Own Id: OTP-6430</p>
        </li>
        <li>
          <p>Added number of async threads and number of scheduler
            threads to the system information that can be retrieved
            via <span class="code">driver_system_info()</span>. For more information see
            the <span class="code">erl_driver(3)</span> documentation.</p>
          <p>Own Id: OTP-6440</p>
        </li>
        <li>
          <p>When <span class="code">SIGUSR1</span> is received by the runtime system
            with SMP support, the <span class="code">erl_crash.dump</span> is now
            written by a special thread, instead of as before
            directly from the signal handler.</p>
          <p>Own Id: OTP-6465</p>
        </li>
        <li>
          <p>term_to_binary/2 with compression is now faster.</p>
          <p></p>
          <p>term_to_binary/2 now accepts the option
            '<span class="code">{compressed,Level}</span>' for specifying the
            compression level. <span class="code">Level</span> must be in the range 0
            (no compression) through 9 (highest compression level).
            Default is 6.</p>
          <p>Future compatibility bugfix: binary_to_term/1 did not
            handle the <span class="code">Uniq</span> and <span class="code">Index</span> fields
            correctly.</p>
          <p>Own Id: OTP-6494</p>
        </li>
        <li>
          <p>Removed unnecessary reallocation when initializing
            kernel-poll set.</p>
          <p>Own Id: OTP-6516</p>
        </li>
      </ul>
    
  

  <h3><a name="id106249">1.44 
        Erts 5.5.3</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Node and fun table entries could under rare circumstances
            be deallocated multiple times on the emulator with SMP
            support.</p>
          <p>Own Id: OTP-6369</p>
        </li>
        <li>
          <p>epoll_wait() can repeat entries for the same file
            descriptor in the result array. This could cause the
            ready_input, ready_output, or event callbacks of a driver
            to unintentionally be called multiple times. We have only
            noted repeated entries when an error condition has
            occurred on the file descriptor. In this case, the
            repeated entries should normally not be a problem for the
            driver since it should detect the error and de-select the
            file descriptor. Therefore this bug should be considered
            harmless. The emulator now coalesce repeated entries into
            one.</p>
          <p>You are only affected by this bug if you are using
            erts-5.5.2.* and the kernel-poll feature on linux.</p>
          <p>Own Id: OTP-6376 Aux Id: OTP-6222 </p>
        </li>
        <li>
          <p>If a process that was waiting in gen_tcp:accept/1 was
            killed, calling gen_tcp:accept/1 again on the same listen
            socket would fail with '<span class="code">{error,einval}</span>'.</p>
          <p>Own Id: OTP-6381 Aux Id: seq10535 </p>
        </li>
        <li>
          <p>The emulator failed to start on Solaris 10 when
            kernel-poll support was enabled and the maximum number of
            filedescriptors configured was less than or equal to 256.</p>
          <p>Own Id: OTP-6384 Aux Id: OTP-6222 </p>
        </li>
        <li>
          <p>The R10B compiler could generate unsafe
            <span class="code">bs_save/bs_restore</span> instructions that could cause
            memory corruption. (The R11B compiler does not have that
            problem.) The erlang emulator will now refuse to load
            R10B-compiled modules that contain such unsafe
            <span class="code">bs_save/bs_restore</span> instructions. In addition, the
            beam_validator module in the compiler will also reject
            such instructions (in case it is used to validate R10B
            code). (Thanks to Matthew Reilly.)</p>
          <p>Own Id: OTP-6386</p>
        </li>
        <li>
          <p>Process and port timers could fail to work properly on
            the runtime system with SMP support. Many thanks to
            Dmitriy Kargapolov and Serge Aleynikov who tracked down
            this bug.</p>
          <p>Own Id: OTP-6387</p>
        </li>
        <li>
          <p>Bit syntax code compiled by an R10B compiler that matched
            out a floating point number would not properly check that
            the floating point number was valid; if the float was,
            for instance, NaN the emulator could crash.</p>
          <p>Own Id: OTP-6395</p>
        </li>
        <li>
          <p>statistics(runtime) on Windows used to return the elapsed
            system time for the process, instead of the user time.
            Corrected. (Thanks to Robert Virding.)</p>
          <p>Own Id: OTP-6407</p>
        </li>
        <li>
          <p>A loadable driver (loaded by erl_ddll) which used
            driver_async() would cause the emulator to crash. (Thanks
            to Dmitriy Kargapolov.)</p>
          <p>Own Id: OTP-6410</p>
        </li>
        <li>
          <p>Under rare circumstances the emulator on unix platforms
            could fail to terminate the Erlang port corresponding to
            a port program opened with the <span class="code">exit_status</span> option.</p>
          <p>Own Id: OTP-6411</p>
        </li>
        <li>
          <p>A link removed via <span class="code">unlink/1</span> could under rare
            circumstances transfer exit signals for a short period of
            time after the call to <span class="code">unlink/1</span> had returned when
            the runtime system with SMP support was used.</p>
          <p>Own Id: OTP-6425 Aux Id: OTP-6160 </p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>In the runtime system with SMP support, ports are now
            being scheduled on the scheduler threads interleaved with
            processes instead of being run in a separate I/O thread.</p>
          <p>Own Id: OTP-6262</p>
        </li>
        <li>
          <p>More interfaces are added in erl_ddll, to support
            different usage scenarios.</p>
          <p>Own Id: OTP-6307 Aux Id: OTP-6234 </p>
        </li>
        <li>
          <p>In the runtime system with SMP support, the global
            I/O lock has been replaced with a more fine grained port
            locking scheme. Port locking is either done on driver
            level, i.e., all ports executing the same driver share a
            lock, or on port level, i.e., each port has its own lock.
            Currently the inet driver, the efile driver, and the
            spawn driver use port level locking and all other
            statically linked in drivers use driver level locking. By
            default dynamically linked in drivers will use locking on
            driver level. For more information on how to enable port
            level locking see the <span class="code">erl_driver(3)</span> and the
            <span class="code">driver_entry(3)</span> man pages. </p>
          <p>As of erts
            version 5.5.3 the driver interface has been extended. The
            extended interface introduce version management, the
            possibility to pass capability flags to the runtime
            system at driver initialization, and some new driver API
            functions. For example, the <span class="code">driver_system_info()</span>
            function which can be used to determine if the driver is
            run in a runtime system with SMP support or not. The
            extended interface doesn't have to be used, <strong>but</strong>
            dynamically linked in driver <strong>have</strong> to be
            recompiled. For information see the <span class="code">erl_driver(3)</span>
            and the <span class="code">driver_entry(3)</span> man pages. </p>
          <p><strong>NOTE:</strong> Dynamically linked in drivers
            <strong>have</strong> to be recompiled. </p>
          <p>*** POTENTIAL INCOMPATIBILITY ***</p>
          <p>Own Id: OTP-6330 Aux Id: OTP-6262 </p>
        </li>
        <li>
          <p>A test and debug feature which modifies the timing of the
            runtime system has been added. For more information, see
            documentation of the <span class="code">+T&lt;Level&gt;</span> command line
            argument of <span class="code">erl(1)</span>.</p>
          <p>Own Id: OTP-6382</p>
        </li>
        <li>
          <p>The version of zlib (http://zlib.net) linked into
            run-time system has been updated to version 1.2.3.</p>
          <p>Own Id: OTP-6394</p>
        </li>
        <li>
          <p>The <span class="code">erlc</span> program now passes on the <span class="code">-smp</span>
            and <span class="code">-hybrid</span> options to the Erlang emulator it
            starts. This is mainly useful for compiling native code,
            because native code must be compiled with same type of
            run-time system as in which it will be run.</p>
          <p>If the <span class="code">-s</span> option is given, <span class="code">erlc</span> now
            prints a warning that it is deprecated and that it will
            be removed in R12B.</p>
          <p>Own Id: OTP-6398</p>
        </li>
        <li>
          <p>The <span class="code">schedulers</span> option of
            <span class="code">erlang:system_flag/2</span> has been removed, i.e., the
            number of scheduler threads cannot be changed after
            emulator boot time any more.</p>
          <p>A <span class="code">multi_scheduling</span> option has been added to
            <span class="code">erlang:system_flag/2</span>. This option can be used for
            blocking and unblocking multi-scheduling. For more
            information see the <span class="code">erlang(3)</span> documentation.</p>
          <p>Own Id: OTP-6403</p>
        </li>
        <li>
          <p>A port program that had been started with the
            <span class="code">exit_status</span> option and closed one of the pipes
            used for communication with the emulator caused the
            emulator to continuously poll for termination of the port
            program. This only became a problem when the emulator
            didn't have other things to do and the port program
            closed a pipe much earlier than it terminated. When the
            emulator had other things to do, such as running Erlang
            processes, the emulator polled for termination in between
            scheduling of processes.</p>
          <p>Now the emulator doesn't poll for termination of the port
            program at all; instead, it waits for the child signal
            from the terminated port program to arrive and then
            schedules the Erlang port for termination.</p>
          <p>The termination of any port programs have also been
            optimized. Previously the termination of any port program
            did always cause a scan of a table of the size equal to
            maximum number of file descriptors. If the maximum number
            of file descriptors was large, this scan could be quite
            expensive. Now the search have been reduced to the set of
            ports started with the <span class="code">exit_status</span> option.</p>
          <p>Note, all of the above only applies to Erlang emulators
            on Unix platforms.</p>
          <p>Own Id: OTP-6412 Aux Id: seq10194 </p>
        </li>
        <li>
          <p>* BEAM: added support for floating-point exceptions on
            FreeBSD (32-bit x86)</p>
          <p>* SMP: made locking procedures work even when native
            lock operations aren't implemented</p>
          <p>* SMP: improved timing accuracy in the timer thread
            (if enabled)</p>
          <p>Own Id: OTP-6424</p>
        </li>
      </ul>
    
  

  <h3><a name="id106711">1.45 
        Erts 5.5.2.2</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>A bug in the kernel poll implementation could cause the
            emulator to omit polling for events on file descriptors.
            The bug was only present when using the kernel poll
            implementation based on epoll or kqueue. This bug was
            introduced in erts-5.5.2.</p>
          <p>Own Id: OTP-6344 Aux Id: OTP-6222 </p>
        </li>
      </ul>
    
  

  <h3><a name="id106746">1.46 
        Erts 5.5.2.1</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>The run_erl program now acquires its pseudo-ttys using
            openpty(3), so that it will work on newer Linux
            distributions that don't have the traditional pseudo-tty
            devices in the file system. On platforms that don't have
            openpty(3), run_erl will still search for pseudo-tty
            devices in the file system.</p>
          <p>The run_erl program will now wait using waitpid(3) to
            prevent the program it spawned to become defunct. run_erl
            will also terminate after a delay of 5 seconds (to allow
            any pending output to be written to the log file) if the
            spawned program terminates even if some child of it still
            holds stdin and/or stdout open.</p>
          <p>Own Id: OTP-6225 Aux Id: seq10500 </p>
        </li>
        <li>
          <p>A bug in ordered_set ETS datatyp caused ets:select (and
            match) to return faulty results when the table contained
            process id's from another node.</p>
          <p>Own Id: OTP-6338</p>
        </li>
      </ul>
    
  

  <h3><a name="id106800">1.47 
        Erts 5.5.2</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>erlc: A typo in the help text for '-pa path' was
            corrected.</p>
          <p>Own Id: OTP-6218</p>
        </li>
        <li>
          <p>Failure in port command/control driver callbacks could
            crash the non-SMP emulator. This bug was introduced in
            the 5.5 version of erts.</p>
          <p>Own Id: OTP-6224</p>
        </li>
        <li>
          <p>Erroneous "<span class="code">Input driver gone away without deselecting!</span>" error reports could sometimes occur
            when a driver instance terminated in the ready_output()
            callback of the driver. This bug was only present in
            emulators that used poll(). Note, that this bug was
            harmless, the only effect it had was the erroneous error
            report.</p>
          <p>Own Id: OTP-6229 Aux Id: OTP-3993, Seq5266, Seq7247,
            OTP-4307 </p>
        </li>
        <li>
          <p>The emulator could cause a type assertion failure while
            writing an erl_crash.dump, causing the erl_crash.dump to
            be terminated and a core dump generated.</p>
          <p>Own Id: OTP-6235 Aux Id: seq10444 </p>
        </li>
        <li>
          <p>The registered name of a process is now the last
            observable resource removed before links and monitors are
            triggered when a process terminates.</p>
          <p>Previously ets tables were removed after the registered
            name. This could cause problems on the runtime system
            with SMP support for code that expected that ets tables
            owned by a specific process had been removed if the name
            of the process had been removed.</p>
          <p>Own Id: OTP-6237</p>
        </li>
        <li>
          <p>Failure to fork() a new (os) process could cause the
            emulator to deadlock. This bug affect all emulators with
            SMP support, and emulators with async thread support on
            SunOS.</p>
          <p>Own Id: OTP-6241 Aux Id: OTP-3906 </p>
        </li>
        <li>
          <p>Fprof traces could become truncated for the SMP emulator.
            This bug has now been corrected.</p>
          <p>Own Id: OTP-6246</p>
        </li>
        <li>
          <p>The undocumented functions inet:getiflist/0,1
            inet:ifget/2,3 and inet:getif/1 were completely broken on
            Windows. That has been fixed.</p>
          <p>Own Id: OTP-6255</p>
        </li>
        <li>
          <p>Behavior in case of disappeared nodes when using the
            dist_auto_connect once got changed in R11B-1. The
            timeouts regarding normal distributed operations is now
            reverted to the old (pre R11B-1).</p>
          <p>Own Id: OTP-6258 Aux Id: OTP-6200, seq10449 </p>
        </li>
        <li>
          <p>The bsl and bsr operators could cause the emulator to
            crash if given invalid arguments. (Thanks to datacompboy
            and Per Gustafsson.)</p>
          <p>Own Id: OTP-6259</p>
        </li>
        <li>
          <p>driver_cancel_timer() could under certain circumstances
            fail to cancel the timer on the runtime system with SMP
            support.</p>
          <p>Own Id: OTP-6261</p>
        </li>
        <li>
          <p>A call to erlang:system_info(info) could deadlock the
            runtime system with SMP support.</p>
          <p>Own Id: OTP-6268</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>Exit signals are now truly asynchronous in the runtime
            system with SMP support. This simplifies locking in bifs
            a lot, and makes process termination cheaper.</p>
          <p>Own Id: OTP-6160</p>
        </li>
        <li>
          <p>When tracing on the runtime system with SMP support it
            can be difficult to know when a trace has been delivered
            to the tracer. A new built in function
            <span class="code">erlang:trace_delivered/1</span> has been introduced in
            order to make it easier to know when the trace has been
            delivered. See the erlang(3) man page for more
            information.</p>
          <p>Own Id: OTP-6205 Aux Id: OTP-6269 </p>
        </li>
        <li>
          <p>Kernel poll support can now be combined with SMP support.
            Currently the following kernel poll versions exist:
            <span class="code">/dev/poll</span>, <span class="code">epoll</span>, and <span class="code">kqueue</span>. Linux
            <span class="code">kpoll</span> has been replaced with <span class="code">epoll</span>. Some
            time in the future there will also be a kernel poll
            version using Solaris event ports.</p>
          <p>The "check io" implementation for unix has been
            completely rewritten. The current kernel poll
            implementation reduce the amount of system calls needed
            compared to the old kernel poll implementation.</p>
          <p>When <span class="code">epoll</span> or <span class="code">kqueue</span> is used either
            <span class="code">poll</span> or <span class="code">select</span> is used as fallback.
            Previously only <span class="code">poll</span> could be used as fallback.
            Since <span class="code">select</span> now can be used as fallback, kernel
            poll support is now also available on newer MacOSX. Note
            however, when <span class="code">select</span> is used as fallback, the
            maximum number of file descriptors is limited to
            <span class="code">FD_SETSIZE</span>. </p>
          <p>Kernel poll support is now enabled by default if
            <span class="code">/dev/poll</span>, <span class="code">epoll</span>, or <span class="code">kqueue</span> is found
            when building OTP, i.e. you do not have to pass the
            <span class="code">--enable-kernel-poll</span> argument to <span class="code">configure</span>.
            As before, kernel poll is disabled by default in the
            runtime system. In order to enable it, pass the
            <span class="code">+Ktrue</span> command line argument to <span class="code">erl</span>.</p>
          <p>Note: <span class="code">configure</span> will refuse to enable kernel poll
            support on FreeBSD since <span class="code">kqueue</span> have problems with
            (at least) pipes on all version of FreeBSD that we have
            tested.</p>
          <p>Own Id: OTP-6222 Aux Id: seq10380 </p>
        </li>
        <li>
          <p>The <span class="code">erl_ddll</span> module and the code in the emulator
            have been completely rewritten; several bugs were fixed.</p>
          <p>Own Id: OTP-6234</p>
        </li>
        <li>
          <p>The SMP emulator now avoids locking for the following
            operations (thus making them as fast as in the UP
            emulator): <span class="code">atom_to_list/1</span>, atom comparison, atom
            hashing, <span class="code">erlang:apply/3</span>.</p>
          <p>Own Id: OTP-6252</p>
        </li>
        <li>
          <p>There are new BIFs <span class="code">erlang:spawn_monitor/1,3</span>,
            and the new option <span class="code">monitor</span> for
            <span class="code">spawn_opt/2,3,4,5</span>.</p>
          <p>The <span class="code">observer_backend</span> module has been updated to
            handle the new BIFs.</p>
          <p>Own Id: OTP-6281</p>
        </li>
      </ul>
    
  

  <h3><a name="id107210">1.48 
        Erts 5.5.1.1</a></h3>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>There is now an option read_packets for UDP sockets that
            sets the maximum number of UDP packets that will be read
            for each invocation of the socket driver.</p>
          <p>Own Id: OTP-6249 Aux Id: seq10452 </p>
        </li>
      </ul>
    
  

  <h3><a name="id107244">1.49 
        Erts 5.5.1</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Complex pattern matching of strings would fail in the 64
            bits emulator because of a bug in the loader. (Thanks to
            Igor Goryachev.)</p>
          <p>Own Id: OTP-6142</p>
        </li>
        <li>
          <p><span class="code">-134217728 div 134217728</span> and <span class="code">-134217728 rem 134217728</span> would be calculated incorrectly.
            <span class="code">abs(-2147483648)</span> could in unlucky circumstances
            cause a heap overflow, as could size(Binary) when size of
            the binary was larger than 128Mb.</p>
          <p>Own Id: OTP-6154</p>
        </li>
        <li>
          <p>erlang:display/1 displayed erroneous values for negative
            integers.</p>
          <p>Big integers (both positive and negative) were previously
            displayed in hexadecimal form while small integers were
            displayed in decimal form. All integers are now displayed
            in decimal form.</p>
          <p>NOTE: erlang:display/1 should only be used for debugging.</p>
          <p>Own Id: OTP-6156</p>
        </li>
        <li>
          <p>A call to erlang:trace/3 with erroneous flags caused the
            SMP emulator to deadlock instead of exiting the calling
            process with badarg.</p>
          <p>Own Id: OTP-6175</p>
        </li>
        <li>
          <p>A bug causing the emulator to hang when exiting a process
            that is exception traced has been fixed.</p>
          <p>Own Id: OTP-6180</p>
        </li>
        <li>
          <p>ets:rename/1 could deadlock, or crash the SMP emulator
            when the table wasn't a named table.</p>
          <p>ets:next/2, and ets:prev/2 could return erroneous results
            on the SMP emulator.</p>
          <p>Own Id: OTP-6198 Aux Id: seq10392, seq10415 </p>
        </li>
        <li>
          <p>A memory allocation bug could cause the SMP emulator to
            crash when a process had executed a <span class="code">receive after</span>
            with a larger timeout than 10 minutes.</p>
          <p>Own Id: OTP-6199</p>
        </li>
        <li>
          <p>The runtime system with SMP support did not slowly adjust
            its view of time when the system time suddenly changed.</p>
          <p>Timeouts could sometimes timeout too early on the runtime
            system with SMP support.</p>
          <p>Own Id: OTP-6202</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The smp runtime system now automatically detects the
            number of logical processors on MacOSX (darwin) and
            OpenBSD.</p>
          <p>The smp runtime system is now built by default on MacOSX
            (darwin) on x86.</p>
          <p>Own Id: OTP-6119</p>
        </li>
        <li>
          <p>The <span class="code">-smp</span> command line argument now take the
            following options: <span class="code">enable</span>, <span class="code">auto</span>, or
            <span class="code">disable</span>.</p>
          <p>Especially the <span class="code">-smpauto</span> argument is useful since
            it starts the Erlang runtime system with SMP support if
            it is available and more than one logical processor are
            detected; otherwise, it starts the Erlang runtime system
            without SMP support. For more information see the
            <span class="code">erl(1)</span> man page.</p>
          <p>Own Id: OTP-6126</p>
        </li>
        <li>
          <p>Increased the reduction cost for sending messages in the
            SMP emulator so it behaves more like the non-SMP
            emulator.</p>
          <p>Own Id: OTP-6196</p>
        </li>
        <li>
          <p>A port running a dynamically linked-in driver that exits
            due to the driver being unloaded now exits with exit
            reason <span class="code">driver_unloaded</span>. Previously the port exited
            with exit reason <span class="code">-1</span>.</p>
          <p>*** POTENTIAL INCOMPATIBILITY ***</p>
          <p>Own Id: OTP-6204</p>
        </li>
        <li>
          <p>Changed name of the <span class="code">erlang:system_info/1</span> argument
            <span class="code">scheduler</span> to <span class="code">scheduler_id</span>. This since the
            <span class="code">scheduler</span> argument so easily could be mixed up
            with the <span class="code">schedulers</span> argument (both returning
            integers).</p>
          <p>*** POTENTIAL INCOMPATIBILITY ***</p>
          <p>Own Id: OTP-6208</p>
        </li>
        <li>
          <p>The changes below were made by Mikael Pettersson, HiPE.</p>
          <p>HiPE runtime system:</p>
          <p>Reduce overheads in the HiPE runtime system's BIF glue
            code.</p>
          <p>Fix bug when exceptions are thrown from BEAM to HiPE.</p>
          <p>Support SPARC on Linux.</p>
          <p>Support x86 on FreeBSD.</p>
          <p>Floating-point exceptions:</p>
          <p>Reduce overheads in checking results of floating-point
            operations.</p>
          <p>Minor bug fix in SSE2 floating-point exception
            handling.</p>
          <p>Support SSE2 floating-point exceptions on 32-bit x86
            machines.</p>
          <p>Make FP exceptions work in the SMP runtime system on
            FreeBSD/x86.</p>
          <p>Support floating-point exceptions on SPARCs running
            Linux.</p>
          <p>Runtime system:</p>
          <p>Minor scheduler optimisation in the non-SMP runtime
            system.</p>
          <p>Substantial reduction of I/O thread overheads in the
            SMP runtime system if the separate timer thread is used.
            (In R11B-1, the separate timer thread is not used.)</p>
          <p>Own Id: OTP-6211</p>
        </li>
      </ul>
    
  

  <h3><a name="id107605">1.50 
        ERTS 5.5</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Previously <span class="code">unlink/1</span> and <span class="code">erlang:demonitor/2</span>
            behaved completely asynchronous. This had one undesirable
            effect, though. You could never know when you were
            guaranteed <strong>not</strong> to be affected by a link that you
            had unlinked or a monitor that you had demonitored.</p>
          <p>The new behavior of <span class="code">unlink/1</span> and
            <span class="code">erlang:demonitor/2</span> can be viewed as two operations
            performed atomically. Asynchronously send an unlink
            signal or a demonitor signal, and ignore any future
            results of the link or monitor.</p>
          <p><strong>NOTE</strong>: This change can cause some obscure code
            to fail which previously did not. For example, the
            following code might hang:</p>
          <div class="example"><pre>
            Mon = erlang:monitor(process, Pid),
            %% ...
            exit(Pid, bang),
            erlang:demonitor(Mon),
            receive
                {'DOWN', Mon , process, Pid, _} -&gt; ok
            %% We were previously guaranteed to get a down message
            %% (since we exited the process ourself), so we could
            %% in this case leave out:
            %% after 0 -&gt; ok
            end,
          </pre></div>
          <p>*** POTENTIAL INCOMPATIBILITY ***</p>
          <p>Own Id: OTP-5772</p>
        </li>
        <li>
          <p>Two bugs fixed: If the environment variable <span class="code">ERL_FLAGS</span>
            was set, its contents would be appended to the end of the
            command line even if the command line had an <span class="code">-extra</span>
            options. Changed to place the options from <span class="code">ERL_FLAGS</span>
            just before <span class="code">-extra</span>. Also, the <span class="code">-smp</span> and
            <span class="code">-hybrid</span> flags no longer have any effect if placed
            after <span class="code">-extra</span>.</p>
          <p>Own Id: OTP-6054</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The documentation for writing drivers in the ERTS User's
            Guide has been expanded and updated.</p>
          <p>Own Id: OTP-5192</p>
        </li>
        <li>
          <p>The <span class="code">andalso</span> and <span class="code">orelse</span> operators are
            now allowed to be used in guards. That also applies to
            match specifications.</p>
          <p>Own Id: OTP-5894 Aux Id: OTP-5149 </p>
        </li>
        <li>
          <p>There is a new trace match spec function
            <span class="code">{exception_trace}</span> and a corresponding trace
            message <span class="code">exception_from</span> that can be used to trace
            on any exit from a function, both normal function return
            and exception return. See the documentation for
            details.</p>
          <p>The <span class="code">return_to</span> trace message is now also
            generated when the execution returns to a function due to
            catching an exception.</p>
          <p>Own Id: OTP-5956</p>
        </li>
        <li>
          <p>Erlang runtime system with SMP (symmetric multi processing)
            support.</p>
          <p>The runtime system with SMP support is in this release
            focused on stability and there are a number of steps
            with optimizations to follow before it will take 
            full advantage of multi processor systems.
            The released system is however truly multi threaded
            and you will notice increased performance
            for many applications already.
            We recommend that you evaluate your application on  
            the SMP version of the runtime system and wait for some
            more optimizations before you use it in a real product. 
            You will then discover if there are any problems in 
            your application that needs to be fixed in order for 
            it to work properly in a multi threaded environment. 
            More optimized versions of the runtime system
            with SMP support will be included in the R11B
            maintenance releases.</p>
          <p>The SMP enabled runtime system will be started if
            the <span class="code">-smp</span> command line argument is passed to
            the <span class="code">erl</span> command. In order to make use of more than
            one processor core, multiple scheduler threads are used. By
            default, the number of scheduler threads will equal
            the number of processor cores. The number of scheduler
            threads can be set with the <span class="code">+S</span> command line argument.
            For more information see the <span class="code">erl(1)</span> man page.</p>
          <p>A runtime system with SMP support is by default built on
            the following platforms if posix threads, and a gcc
            compiler of at least version 2.95 is found:</p>
          <ul>
            <li>
              <p>Linux with at least kernel version 2.6 and the Native
                POSIX Thread Library on x86, x86_64, and 32-bits
                PowerPC.</p>
            </li>
            <li>
              <p>Solaris of at least version 8 on 32-bits SPARC-V9.</p>
            </li>
            <li>
              <p>MacOSX of at least version 10.4 (Darwin 8.0) on
                32-bits PowerPC.</p>
            </li>
          </ul>
          <p>The runtime system with SMP support is known <strong>not</strong>
            to build on:</p>
          <ul>
            <li>
              <p>Windows.</p>
            </li>
            <li>
              <p>Linux with kernel versions less than 2.4, or without
                the Native POSIX Thread Library.</p>
            </li>
            <li>
              <p>Other hardware platforms than x86, x86_64, 32-bits
                SPARC-V9 and 32-bits PowerPC.</p>
            </li>
          </ul>
          <p>Windows will be supported in a future release.</p>
          <p>The runtime system with SMP support might build on other
            operating systems in combination with supported hardware.
            In order to force a build of a runtime system with SMP
            support, pass the <span class="code">--enable-smp-support</span> command line
            argument to configure. Note, however, that it is not enough
            that it builds. The underlying thread library and operating
            system has to provide SMP support as well. If the thread
            library does not distribute scheduler threads over multiple
            processor cores then the runtime system will only seemingly
            provide SMP support. If the runtime system is not built by
            default on a specific platform, we have <strong>not</strong> tested
            it on that platform.</p>
          <p><strong>NOTE</strong>: The design of SMP support for drivers is
            ongoing. There will probably be incompatible driver
            changes (only affecting drivers run on the runtime system
            with SMP support) released as patches for R11B.</p>
          <p><strong>Potential incompatibility</strong>: Previously, specific
            driver call-backs were always called from the same thread.
            This is <strong>not</strong> true in the runtime system with SMP
            support. Calls to call-backs will be made from different
            threads, e.g., two consecutive calls to exactly the same
            call-back can be made from two different threads. This
            will in <strong>most</strong> cases not be a problem. All calls
            to call-backs are synchronized, i.e., only one call-back
            will be called at a time.</p>
          <p>In the future the default behavior will <strong>probably</strong>
            be the following: Calls to call-backs will, as now, be
            made from different threads. Calls to call-backs in the
            same driver <strong>instance</strong> will be synchronized. It
            will probably be possible to configure so that all calls
            to call-backs in all driver instances of a specific
            driver type will be synchronized. It may be possible to
            configure so that all calls to call-backs of a driver
            instance or a of a specific driver type will be made from
            the same thread.</p>
          <p>Parallelism in the Erlang code executed is a necessity
            for the Erlang runtime system to be able to take
            advantage of multi-core or multi-processor hardware.
            There need to be at least as many Erlang processes
            runnable as processor cores for the Erlang runtime system
            to be able to take advantage of all processor cores.</p>
          <p>An Erlang runtime system with SMP support with only one
            Erlang process runnable all the time will almost always be
            slower than the same Erlang runtime system without SMP
            support. This is due to thread synchronization overhead.</p>
          <p>Known major bottleneck in the Erlang runtime system:</p>
          <ul>
            <li>
              <p>Currently the I/O system uses one "big lock", i.e. only
                one thread can do I/O at a time (with the exception of
                async threads and threads created by users own linked-in
                drivers). This is high on the list of things to
                optimize. Note, code that does not do I/O can be executed
                at the same time as one thread does I/O.</p>
            </li>
          </ul>
          <p>Some pitfalls which might cause Erlang programs that work on
            the non-SMP runtime system to fail on the SMP runtime
            system:</p>
          <ul>
            <li>
              <p>A newly spawned process will often begin executing
                immediately. Code that expects that the parent process
                will be able to execute for a while before the child
                process begins executing is likely to fail.</p>
            </li>
            <li>
              <p>High priority processes could previously provide
                mutual exclusion (bad programming style) by preventing
                normal and low priority processes from being run. High
                priority processes cannot be used this way to provide
                mutual exclusion.</p>
            </li>
            <li>
              <p><span class="code">erlang:yield()</span> could be used to provide some
                kind of temporary mutual exclusion (also bad programming
                style). <span class="code">erlang:yield()</span> cannot be used to provide
                any kind of mutual exclusion.</p>
            </li>
            <li>
              <p>Obscure pitfall, only if a process being traced also
                sends normal messages to the tracer:<br>
                  The order between trace messages and normal
                messages is undefined. I.e. the order between normal
                messages sent from a tracee to a tracer and the trace
                messages generated from the same tracee to the same
                tracer is undefined. The internal order of normal
                messages and the internal order of trace messages will,
                of course, be preserved as before.</p>
            </li>
          </ul>
          <p>The kernel poll feature is currently not supported by
            the runtime system with SMP support. It will probably be
            supported in a future release.</p>
          <p>*** POTENTIAL INCOMPATIBILITY ***</p>
          <p>Own Id: OTP-6006 Aux Id: OTP-6095 </p>
        </li>
        <li>
          <p>Linked-in driver modifications.</p>
          <ul>
            <li>
              <p>Linked-in drivers must be recompiled.</p>
            </li>
            <li>
              <p>The <span class="code">refc</span> field in the <span class="code">ErlDrvBinary</span> type
                has been removed. The reference count can be accessed
                via API functions. For more information see
                the <span class="code">erl_driver(1)</span> man page.</p>
            </li>
          </ul>
          <p>*** POTENTIAL INCOMPATIBILITY ***</p>
          <p>Own Id: OTP-6095 Aux Id: OTP-6006 </p>
        </li>
      </ul>
    
  

  <h3><a name="id108128">1.51 
        ERTS 5.4.13</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Large files (more than 2 GBytes) are now handled on
            Solaris 8.</p>
          <p>Own Id: OTP-5849 Aux Id: seq10157 </p>
        </li>
        <li>
          <p>A failing bit syntax construction could fail with the
            PREVIOUS exception reason that had occurred in the process
            (instead of with <span class="code">badarg</span>).</p>
          <p>Own Id: OTP-5911</p>
        </li>
        <li>
          <p>When building OTP, the Kernel application was built in
            both the primary and secondary bootstrap steps, which
            would cause problems if OTP including its bootstrap is
            checked into a version control system (such as CVS).
            (Thanks to Sebastian Strollo.)</p>
          <p>Own Id: OTP-5921</p>
        </li>
        <li>
          <p><span class="code">binary_to_term(&lt;&lt;131,109,255,255,255,255)</span> and
            similar expressions used to crash the emulator instead of
            causing a <span class="code">badarg</span> exception. (Thanks to Matthias
            Lang.)</p>
          <p>Own Id: OTP-5933</p>
        </li>
        <li>
          <p><span class="code">erlang:hibernate/3</span> could sometimes crash the emulator
            when no heap was needed.</p>
          <p>Own Id: OTP-5940</p>
        </li>
        <li>
          <p>Execution of match specs could under rare circumstances
            cause the emulator to dump core.</p>
          <p>Execution of match specs could cause memory leaks in the
            hybrid emulator.</p>
          <p>Own Id: OTP-5955</p>
        </li>
        <li>
          <p>A bug in <span class="code">erlang:trace_info/2</span> when getting info for a
            function in a deleted module resulting in an emulator
            crash, has been corrected.</p>
          <p>Own Id: OTP-5957</p>
        </li>
        <li>
          <p>Different (and old) <span class="code">config.guess</span> files in the
            ERTS and Erl_Interface applications would cause build
            problems on the new Intel-based iMacs.
            (Thanks to Sebastion Strollo.)</p>
          <p>Own Id: OTP-5967</p>
        </li>
        <li>
          <p>pthread header and library mismatch on Linux systems (at
            least some SuSE and Debian) with both NPTL and
            Linuxthreads libraries installed.</p>
          <p>Own Id: OTP-5981</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The driver_set_timer did not change the previous timeout
            if called a second time. Now it works as specified,
            changing the timeout.</p>
          <p>Own Id: OTP-5942</p>
        </li>
        <li>
          <p>The undocumented <span class="code">{packet,http}</span> option (for the
            <span class="code">gen_tcp</span> module) did not not work correctly when
            there were multiple continuation lines. (Thanks to Per
            Hedeland.)</p>
          <p>Own Id: OTP-5945</p>
        </li>
        <li>
          <p>The setuid_socket_wrap program was corrected to work for
            C compilers that treat the <span class="code">char</span> type as unsigned.
            (Thanks to Magnus Henoch.)</p>
          <p>Own Id: OTP-5946</p>
        </li>
      </ul>
    
  

  <h3><a name="id108346">1.52 
        ERTS 5.4.12</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Fixed a minor build problem on Windows.</p>
          <p>Own Id: OTP-5819 Aux Id: OTP-5382 OTP-5540 OTP-5577 </p>
        </li>
        <li>
          <p>The <span class="code">delay_send</span> option for <span class="code">gen_tcp</span> was
            broken on Windows.</p>
          <p>Own Id: OTP-5822</p>
        </li>
        <li>
          <p>If there were user-defined variables in the boot
            script, and their values were not provided using the
            <span class="code">-boot_var</span> option, the emulator would refuse to
            start with a confusing error message. Corrected to show a
            clear, understandable message.</p>
          <p>The <span class="code">prim_file</span> module was modified to not depend
            on the <span class="code">lists</span> module, to make it possible to start
            the emulator using a user-defined loader. (Thanks to
            Martin Bjorklund.)</p>
          <p>Own Id: OTP-5828 Aux Id: seq10151 </p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The HiPE compiler identifies more leaf functions,
            giving slightly faster code.</p>
          <p>Corrected problems in HiPE's coalescing register
            allocating that would cause it to fail when compiling
            very large functions (e.g. some of parse modules in the
            Megaco application).</p>
          <p>Own Id: OTP-5853</p>
        </li>
      </ul>
    
  

  <h3><a name="id108457">1.53 
        ERTS 5.4.11</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Timers could sometimes timeout too early. This bug has
            now been fixed.</p>
          <p>Automatic cancellation of timers created by
            <span class="code">erlang:send_after(Time,pid(),Msg)</span> and
            <span class="code">erlang:start_timer(Time,pid(),Msg)</span> has been
            introduced. Timers created with the receiver specified by a
            pid, will automatically be cancelled when the receiver
            exits. For more information see the <span class="code">erlang(3)</span> man
            page.</p>
          <p>In order to be able to maintain a larger amount of timers
            without increasing the maintenance cost, the internal
            timer wheel and bif timer table have been enlarged.</p>
          <p>Also a number of minor bif timer optimizations have been
            implemented.</p>
          <p>Own Id: OTP-5795 Aux Id: OTP-5090, seq8913, seq10139,
            OTP-5782 </p>
        </li>
        <li>
          <p><span class="code">erlang:monitor(process,Pid)</span> hanged if <span class="code">Pid</span>
            referred to a process on a non-existing node with the same
            nodename as the nodename of node on which the call was made.
            This bug has now been fixed.</p>
          <p>Own Id: OTP-5827</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>By setting Unix environment variables, the priority for
            the emulator can be lowered when it is writing crash
            dumps and the time allowed for finishing writing a crash
            dump can be set to a certain number of seconds. See the
            documentation for <span class="code">erl</span> in the ERTS application.
            (Also, a few other previously undocumented environment
            variables are now documented.)</p>
          <p>Own Id: OTP-5818</p>
        </li>
        <li>
          <p>Documentation improvements:</p>
          <p>- documentation for <span class="code">erlang:link/1</span> corrected</p>
          <p>- command line flag <span class="code">-code_path_cache</span> added</p>
          <p>- <span class="code">erl</span> command line flags clarifications</p>
          <p>- <span class="code">net_kernel(3)</span> clarifications</p>
          <p>Own Id: OTP-5847</p>
        </li>
      </ul>
    
  

  <h3><a name="id108609">1.54 
        ERTS 5.4.10</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>-D_GNU_SOURCE is now always passed on the compile command
            line on linux. This in order to ensure that all included
            system headers see _GNU_SOURCE defined.</p>
          <p>_GNU_SOURCE is now also defined on linux in configure
            when looking for features.</p>
          <p>Some minor (harmless) configure bugs were also fixed.</p>
          <p>Own Id: OTP-5749</p>
        </li>
        <li>
          <p>Some compiler warnings and Dialyzer warnings were
            eliminated in the Tools application.</p>
          <p>When tracing to a port (which <span class="code">fprof</span> does),
            there could be fake schedule out/schedule in messages
            sent for a process that had exited.</p>
          <p>Own Id: OTP-5757</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The BIFs <span class="code">iolist_size/1</span> and <span class="code">iolist_to_binary/1</span>
            has been added.</p>
          <p>The BIF <span class="code">list_to_existing_atom/1</span> has been added.</p>
          <p>Minor bug fix: The exception reason could be changed
            to <span class="code">error</span> inside nested try/catch constructs if the
            <span class="code">erlang:raise/3</span> BIF was called with an empty
            stacktrace. (Calling <span class="code">erlang:raise/3</span> with an empty
            stacktrace is NOT recommended.)</p>
          <p>Minor bugfix: On Windows, <span class="code">file:open/2</span> will now
            return the documented error reason <span class="code">{error,eisdir}</span>
            if the filename refers to a directory (it used to return
            <span class="code">{error,eacces}</span>).</p>
          <p>The message in the documentation for
            <span class="code">erlang:system_monitor/2</span>, description of
            <span class="code">busy_dist_port</span>, was corrected.</p>
          <p>Own Id: OTP-5709 Aux Id: seq10100 </p>
        </li>
        <li>
          <p>The previously undocumented and UNSUPPORTED <span class="code">zlib</span>
            module has been updated in an incompatible way and many
            bugs have been corrected. It is now also documented.</p>
          <p>*** POTENTIAL INCOMPATIBILITY ***</p>
          <p>Own Id: OTP-5715</p>
        </li>
        <li>
          <p>New socket options <span class="code">priority</span> and <span class="code">tos</span> for
            platforms that support them (currently only Linux).</p>
          <p>Own Id: OTP-5756</p>
        </li>
        <li>
          <p>Only the emulator is now linked with termcap library in
            order to decrease library dependencies for other otp
            programs.</p>
          <p>Own Id: OTP-5758</p>
        </li>
      </ul>
    
  

  <h3><a name="id108807">1.55 
        ERTS 5.4.9.2</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>The native resolver has gotten an control API for
            extended debugging and soft restart. It is:
            <span class="code">inet_gethost_native:control(Control)</span><br><span class="code">Control = {debug_level,Level} | soft_restart</span><br><span class="code">Level = integer() in the range 0-4</span>.</p>
          <p>Own Id: OTP-5751 Aux Id: EABln25013 </p>
        </li>
      </ul>
    
  

  <h3><a name="id108851">1.56 
        ERTS 5.4.9.1</a></h3>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>On VxWorks, epmd did not handle file descriptors with
            higher numbers than 63. Also, if epmd should get a file
            descriptor with a number &gt;= FD_SETSIZE, it will close a
            the file descriptor and write a message to the log
            (instead of mysteriously fail); the Erlang node that
            tried to register will fail with a duplicate_name error
            (unfortunately, epmd has no way to indicate to the Erlang
            node why the register attempt failed).</p>
          <p>Own Id: OTP-5716 Aux Id: seq10070 </p>
        </li>
      </ul>
    
  

  <h3><a name="id108888">1.57 
        ERTS 5.4.9</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Timezone data is now initialized better. (was a problem
            at least on NetBSD 2.0.2) Thanks to Rich Neswold.</p>
          <p>Own Id: OTP-5621</p>
        </li>
        <li>
          <p>The hybrid-heap emulator ('erl -hybrid') is much more
            stable. We have corrected all known bugs that caused it
            to dump core while running our test suites.</p>
          <p>Own Id: OTP-5634</p>
        </li>
        <li>
          <p>Fixed rare memory leaks in <span class="code">erlang:demonitor/1</span> when
            distributed monitors were removed.</p>
          <p>Own Id: OTP-5692</p>
        </li>
        <li>
          <p>Processes were sometimes unnecessarily garbage collected
            when terminating. These unnecessary garbage collections
            have now been eliminated.</p>
          <p>Own Id: OTP-5693</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The <span class="code">c:i/0</span> function will now run in a paged mode if
            there are more than 100 processes in the system. (Thanks
            to Ulf Wiger.)</p>
          <p><span class="code">erlang:system_info(process_count)</span> has
            been optimized and does now return exactly the same value
            as <span class="code">length(processes())</span>. Previously
            <span class="code">erlang:system_info(process_count)</span> did not include
            exiting processes which are included in
            <span class="code">length(processes())</span>.</p>
          <p>The <span class="code">+P</span> flag for <span class="code">erl</span>, which sets the maximum
            number of processes allowed to exist at the same, no longer
            accepts values higher than 134217727. (You will still
            probably run out of memory before you'll be able to reach
            that limit.)</p>
          <p>Own Id: OTP-5645 Aux Id: seq9984 </p>
        </li>
        <li>
          <p>The term-building driver functions
            <span class="code">driver_output_term()</span> and <span class="code">driver_send_term()</span>
            have been updated:</p>
          <p>The ERL_DRV_FLOAT type has been added.</p>
          <p>For the ERL_DRV_BINARY type, the length and offset are
            now validated against the length of the driver binary.</p>
          <p>The ERL_DRV_PID type is now implemented (it was
            documented, but not implemented).</p>
          <p>Own Id: OTP-5674</p>
        </li>
      </ul>
    
  

  <h3><a name="id109055">1.58 
        ERTS 5.4.8</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p><span class="code">ets:delete/1</span> now allows other Erlang process to run
            when a large table is being deleted.</p>
          <p>Own Id: OTP-5572</p>
        </li>
        <li>
          <p>A bug regarding tcp sockets which results in hanging
            <span class="code">gen_tcp:send/2</span> has been corrected. To encounter
            this bug you needed one process that read from a socket,
            one that wrote more date than the reader read out so the
            sender got suspended, and then the reader closed the
            socket. (Reported and diagnosed by Alexey Shchepin.)</p>
          <p>Corrected a bug in the (undocumented and unsupported)
            option <span class="code">{packet,http}</span> for <span class="code">gen_tcp.</span>
            (Thanks to Claes Wikstrom and Luke Gorrie.)</p>
          <p>Updated the documentation regarding the second argument to
            <span class="code">gen_tcp:recv/2</span>, the <span class="code">Length</span> to receive.</p>
          <p>Own Id: OTP-5582 Aux Id: seq9839 </p>
        </li>
        <li>
          <p>Erlang/OTP will now build on Mac OS X 10.4 "Tiger" (the
            problem was that 10.4 has a partially implemented poll()
            function that can't handle devices). Also, on Mac OS X
            10.3 "Panther", Erlang/OTP will now use select() instead
            of poll() (because poll() on Mac OS X 10.3 is implemented
            using select()).</p>
          <p>Own Id: OTP-5595</p>
        </li>
        <li>
          <p>A bug in the file driver when opening a file in
            compressed mode, and the returned allocated pointer from
            the compressing library was in very high memory (&gt;= 2GB),
            causing e.g. <span class="code">file:read/2</span> to return
            <span class="code">{error,ebadf}</span>, has been corrected.</p>
          <p>Own Id: OTP-5618</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The new fun <span class="code">M:F/A</span> construct creates a fun that
            refers to the latest version of <span class="code">M:F/A.</span> This syntax is
            meant to replace tuple funs <span class="code">{M,F}</span> which have many
            problems.</p>
          <p>The new type test <span class="code">is_function(Fun,A)</span> (which may be
            used in guards) test whether <span class="code">Fun</span> is a fun that can be
            applied with <span class="code">A</span> arguments. (Currently, <span class="code">Fun</span>
            can also be a tuple fun.)</p>
          <p>Own Id: OTP-5584</p>
        </li>
        <li>
          <p>In the HiPE application, there's a new experimental
            register allocator (optimistic coalescing), and the
            linear scan register allocator is now also available on
            ppc. Plus lots of cleanups.</p>
          <p>Minor hybrid heap corrections.</p>
          <p>The maximum size of a heap used to be artificially
            limited so that the size of a heap would fit in 28 bits;
            that limitation could cause the emulator to terminate in
            a garbage collection even if there still was available
            memory. Now the largest heap size for a 32 bit CPU is
            1,699,221,830 bytes. (Thanks to Jesper Wilhelmsson.)</p>
          <p>Also removed the undocumented <span class="code">+H</span> emulator option.</p>
          <p>Own Id: OTP-5596</p>
        </li>
      </ul>
    
  

  <h3><a name="id109254">1.59 
        ERTS 5.4.7</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p><span class="code">to_erl</span> could close unexpectedly on Linux systems.
            Also, output from the emulator could be lost. Corrected.</p>
          <p>Own Id: OTP-5561</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The <span class="code">cpu_timestamp</span> option for <span class="code">erlang:trace/3</span>
            is now also supported on Linux.</p>
          <p>Own Id: OTP-5532 Aux Id: seq9813 </p>
        </li>
        <li>
          <p>The last known <span class="code">werl</span> window size/position is now saved
            correctly when <span class="code">werl</span> is stopped with the window
            minimized. A problem with the placement not being saved if
            the emulator is halted or stopped from the JCL menu has also
            been fixed.</p>
          <p>Own Id: OTP-5544 Aux Id: OTP-5522 </p>
        </li>
      </ul>
    
  

  <h3><a name="id109343">1.60 
        ERTS 5.4.6</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Some math libraries do not always throw floating-point
            exceptions on errors. In order to be able to use these
            libraries, floating-point errors are now more thoroughly
            checked.</p>
          <p>Misc floating-point fixes for Linux and MacOSX.</p>
          <p>Own Id: OTP-5467</p>
        </li>
        <li>
          <p>An internal buffer was sometimes not cleared which caused
            garbage to appear in error messages sent to the error
            logger.</p>
          <p><span class="code">errno</span> was sometimes clobbered which caused erroneous
            error reports about <span class="code">poll()</span> errors.</p>
          <p>Only emulators on unix platforms were affected by these
            bugs.</p>
          <p>Own Id: OTP-5492</p>
        </li>
        <li>
          <p>The ethread library now works on OpenBSD.</p>
          <p>Own Id: OTP-5515</p>
        </li>
        <li>
          <p>Corrected a bug in the (undocumented and unsupported)
            option <span class="code">{packet,http}</span> for <span class="code">gen_tcp</span>.
            (Thanks to Claes Wikstrom and Luke Gorrie.)</p>
          <p>Own Id: OTP-5519</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p><span class="code">binary_to_term/1</span> could cause the emulator to crash
            when given invalid pids or funs.</p>
          <p>Own Id: OTP-5484 Aux Id: seq9801 </p>
        </li>
        <li>
          <p>Some more stability problems were fixed in the
            hybrid-heap emulator.</p>
          <p>Own Id: OTP-5489</p>
        </li>
        <li>
          <p>After <span class="code">werl</span> was closed with the window minimized, it
            was not possible to restart <span class="code">werl</span> with an open
            window. A temporary solution has so far been implemented
            that restores the initial window settings every time
            <span class="code">werl</span> is started.</p>
          <p>Own Id: OTP-5522</p>
        </li>
      </ul>
    
  

  <h3><a name="id109502">1.61 
        ERTS 5.4.5</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>If a process had node links (created by
            <span class="code">monitor_node/2</span>), executing
            <span class="code">process_info(Pid,memory)</span> for that process would
            crash the emulator.</p>
          <p>Own Id: OTP-5420</p>
        </li>
        <li>
          <p>Minor corrections to the help text printed by <span class="code">erlc -help</span>. The documentation for <span class="code">erlc</span> was also
            slightly updated.</p>
          <p>Own Id: OTP-5428</p>
        </li>
        <li>
          <p>32-bit words were used for offsets in the garbage
            collector. This caused the emulator to crash on 64-bit
            machines when heaps were moved more than 4 GB during
            garbage collection.</p>
          <p>Own Id: OTP-5430</p>
        </li>
        <li>
          <p><span class="code">is_boolean(42.5)</span> failed to load if optimization was
            explicitly turned off.</p>
          <p>Own Id: OTP-5448</p>
        </li>
        <li>
          <p>If there was a call to <span class="code">Module:foo/X</span> from any loaded
            module, the returned by <span class="code">M:module_info(exports)</span> would
            always include <span class="code">{foo,X}</span> (even though
            <span class="code">Module:foo/X</span> if was not defined).</p>
          <p>Own Id: OTP-5450 Aux Id: seq9722 </p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The <span class="code">c</span> option for the <span class="code">+B</span> flag has been
            introduced which makes it possible to use Ctrl-C
            (Ctrl-Break on Windows) to interrupt the shell process
            rather than to invoke the emulator break handler. All new
            <span class="code">+B</span> options are also supported on Windows
            (<span class="code">werl</span>) as of now. Furthermore, Ctrl-C on Windows has
            now been reserved for copying text (what Ctrl-Ins was used
            for previously). Ctrl-Break should be used for break
            handling. Lastly, the documentation of the system flags has
            been updated.</p>
          <p>Own Id: OTP-5388</p>
        </li>
      </ul>
    
  

  <h3><a name="id109660">1.62 
        ERTS 5.4.4</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>The function <span class="code">erlang:float/1</span> can now be used in
            match specifications and is recognized by
            <span class="code">dbg:fun2ms/1</span> and <span class="code">ets:fun2ms/1</span>. This
            addition is part of the work to "harmonize" match
            specification guards with Erlang guards.</p>
          <p>Own Id: OTP-5297 Aux Id: OTP-4927 </p>
        </li>
        <li>
          <p>The <span class="code">register/2</span> BIF would return <span class="code">true</span> even if
            the second argument was not a pid for living process.
            Corrected to cause an exception.</p>
          <p>Own Id: OTP-5324 Aux Id: seq9698 </p>
        </li>
        <li>
          <p>In the 'bag' type of ets tables, elements having the same
            key were supposed to be order in insertion order. The
            would be wrong if a rehash occurred.</p>
          <p>Own Id: OTP-5340 Aux Id: seq9704 </p>
        </li>
        <li>
          <p>Linked in drivers in the Crypto and Asn1 applications
            are now compiled with the <span class="code">-D_THREAD_SAFE</span> and
            <span class="code">-D_REENTRANT</span> switches on unix when the emulator has
            thread support enabled.</p>
          <p>Linked in drivers on MacOSX are not compiled with the
            undocumented <span class="code">-lbundle1.o</span> switch anymore. Thanks to
            Sean Hinde who sent us a patch.</p>
          <p>Linked in driver in Crypto, and port programs in SSL, now
            compiles on OSF1.</p>
          <p>Minor makefile improvements in Runtime_Tools.</p>
          <p>Own Id: OTP-5346</p>
        </li>
        <li>
          <p>Fixed a bug in the hybrid heap in distributed send
            operations.</p>
          <p>Own Id: OTP-5361</p>
        </li>
        <li>
          <p>A BIF <span class="code">erlang:raise/3</span> has been added. See the manual
            for details. It is intended for internal system programming
            only, advanced error handling.</p>
          <p>Own Id: OTP-5376 Aux Id: OTP-5257 </p>
        </li>
        <li>
          <p>Mikael Pettersson (HiPE) corrected a few bugs in the
            emulator that caused problems when compiled with the
            experimental gcc-4.0.0.</p>
          <p>Own Id: OTP-5386</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>Minor update of the internal documentation of
            the <span class="code">epmd</span> protocol.</p>
          <p>The listen port of <span class="code">epmd</span> has now been registered at
            IANA:
            <span class="bold_code"><a href="http://www.iana.org/assignments/port-numbers">http://www.iana.org/assignments/port-numbers</a></span>.</p>
          <p>Own Id: OTP-5234</p>
        </li>
        <li>
          <p><span class="code">run_erl.c</span> now works on Mac OS X and FreeBSD.</p>
          <p>Own Id: OTP-5384</p>
        </li>
        <li>
          <p>A few bugs were corrected in the HiPE application.</p>
          <p>Own Id: OTP-5385</p>
        </li>
      </ul>
    
  

  <h3><a name="id109882">1.63 
        ERTS 5.4.3</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>Font and color preferences for <span class="code">werl.exe</span> now can be
            saved even after the first time you run <span class="code">werl.exe</span>.
            The window position and size is also saved. Patch from
            James Hague who did all the hard work.</p>
          <p>Own Id: OTP-5250</p>
        </li>
        <li>
          <p>OTP archive libraries, e.g. the <span class="code">erl_interface</span>
            library, on MacOSX could not be used without first
            rerunning <span class="code">ranlib</span> on them. This bug has now been
            fixed.</p>
          <p>Own Id: OTP-5274</p>
        </li>
        <li>
          <p>Bugs in <span class="code">erlang:hash/2</span> and <span class="code">erlang:phash/2</span> on
            64-bit platforms have been fixed.</p>
          <p>Own Id: OTP-5292</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>Corrected a crash in the 64-bits emulator.</p>
          <p>Corrected a problem in the hybrid heap emulator.</p>
          <p>In the chapter about the abstract format in the ERTS User's
            Guide, updated the last section about how the abstract
            format is stored in BEAM files.</p>
          <p>Own Id: OTP-5262</p>
        </li>
        <li>
          <p>The maximum number of concurrent threads in the internal
            ethread thread package has been limited to 2048.</p>
          <p>Own Id: OTP-5280</p>
        </li>
      </ul>
    
  

  <h3><a name="id110008">1.64 
        ERTS 5.4.2.1</a></h3>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>If Erlang/OTP was installed in a short directory name,
            such as <span class="code">C:\Program\erl5.4.2</span>, the emulator would not
            start.</p>
          <p>Own Id: OTP-5254</p>
        </li>
      </ul>
    
  

  <h3><a name="id110045">1.65 
        ERTS 5.4.2</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>If one used <span class="code">select/3</span> and <span class="code">select/1</span> on a
            non-fixed ETS table and deleted objects simultaneously,
            the emulator could crash. Note that the result of such
            simultaneous operations on tables that are not in a fixed
            state is still undefined, but the emulator crash is,
            needless to say, fixed.</p>
          <p>Own Id: OTP-5209 Aux Id: seq9198 </p>
        </li>
        <li>
          <p>Arithmetic with big numbers could crash the emulator.</p>
          <p>The HiPE native code compiler and run-time code in the
            emulator has been updated. (Note: Native code is still
            not supported.)</p>
          <p>Eliminated a few bugs that could crash the hybrid emulator
            (which is not supported).</p>
          <p>Own Id: OTP-5233 Aux Id: seq9587 </p>
        </li>
      </ul>
    
  

  <h3><a name="id110108">1.66 
        ERTS 5.4.1</a></h3>
    

    <h4>Fixed Bugs and Malfunctions</h4>
      
      <ul>
        <li>
          <p>The ethread library was unnecessarily rebuilt multiple
            times during the build process, also a debug version of
            the library was build during the install phase. These
            unnecessary builds have now been removed. Note, the
            content of the installed Erlang/OTP system is not
            effected at all by this change.</p>
          <p>Own Id: OTP-5203</p>
        </li>
        <li>
          <p>The emulator could fail to clear the memory segment
            cache. This could potentially cause memory allocation to
            unnecessarily fail when memory usage was close to its
            maximum. This bug has now been fixed.</p>
          <p>Own Id: OTP-5211</p>
        </li>
        <li>
          <p>std_alloc (std short for standard) was sometimes called
            def_alloc (def short for default). std_alloc is now
            everywhere referred to as std_alloc.</p>
          <p>Own Id: OTP-5216</p>
        </li>
        <li>
          <p>A documentation bug has been corrected in
            the <span class="code">erts_alloc(3)</span> documentation. It was stated that
            some of the memory allocators present were by default
            disabled. This is true for Erlang/OTP R9C, but is not true
            for Erlang/OTP R10B. In R10B all memory allocators present
            are enabled by default.</p>
          <p>Own Id: OTP-5217</p>
        </li>
      </ul>
    

    <h4>Improvements and New Features</h4>
      
      <ul>
        <li>
          <p>The emulator now close all open files and sockets
            immediately after receiving an USR1 signal. This causes
            the emulator to unregister at <span class="code">epmd</span> as early as
            possible.</p>
          <p>Own Id: OTP-5221 Aux Id: OTP-4985, seq9514 </p>
        </li>
        <li>
          <p>Try/catch support in the emulator slightly updated.</p>
          <p>Own Id: OTP-5229</p>
        </li>
      </ul>
    
  
</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2011 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div></body>
</html>
